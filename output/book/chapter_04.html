<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>What Are We Doing with All These Tests?</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<script>console.log('hi');
var httpRequest = new XMLHttpRequest();
httpRequest.onreadystatechange = function() {
  if (httpRequest.readyState === XMLHttpRequest.DONE) {
    if (httpRequest.status === 200) {
      document.getElementById('header').innerHTML += httpRequest.responseText;
      console.log('ajax loaded');
    } 
  }
};
httpRequest.open('GET', 'toc.html');
httpRequest.send();
</script></head>
<body class="article toc2 toc-left">
<div id="buy_the_book" style="position: absolute; top: 0; right: 0; z-index:100">
  <a href="/pages/book.html">
    <img src="images/buy_the_book.svg" alt="buy the book ribbon">
  </a>
</div>
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="chapter-4">What Are We Doing with All These Tests?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we&#8217;ve seen the basics of TDD in action, it&#8217;s time to pause
and talk about why we&#8217;re doing it.</p>
</div>
<div class="paragraph">
<p>
I&#8217;m imagining several of you, dear readers, have been holding back
some seething frustration&#8212;&#8203;perhaps some of you have done a bit of unit
testing before, and perhaps some of you are just in a hurry. You&#8217;ve been
biting back questions like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Aren&#8217;t all these tests a bit excessive?</p>
</li>
<li>
<p>Surely some of them are redundant? There&#8217;s duplication between
the functional tests and the unit tests.</p>
</li>
<li>
<p>I mean, what are you doing importing <code>django.core.urlresolvers</code> in your
unit tests?  Isn&#8217;t that testing Django, i.e., testing third-party code? I
thought that was a no-no?</p>
</li>
<li>
<p>Those unit tests seemed way too trivial&#8212;&#8203;testing one line of declaration,
and a one-line function that returns a constant! Isn&#8217;t that just a waste of
time? Shouldn&#8217;t we save our tests for more complex things?</p>
</li>
<li>
<p>What about all those tiny changes during the unit-test/code cycle?  Surely we
could have just skipped to the end? I mean, <code>home_page = None</code>!? Really?</p>
</li>
<li>
<p>You&#8217;re not telling me you <em>actually</em> code like this in real life?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ah, young grasshopper. I too was once full of questions like these.  But only
because they&#8217;re perfectly good questions.  In fact, I still ask myself
questions like these, all the time. Does all this stuff really have value? Is
this a bit of a cargo cult?</p>
</div>
<div class="sect2">
<h3 id="_programming_is_like_pulling_a_bucket_of_water_up_from_a_well">Programming Is like Pulling a Bucket of Water up from a Well</h3>
<div class="paragraph">
<p>
Ultimately, programming is hard.  Often, we are smart, so we succeed.  TDD is
there to help us out when we&#8217;re not so smart.  Kent Beck (who basically
invented TDD) uses the metaphor of lifting a bucket of water out of a well
with a rope:  when the well isn&#8217;t too deep, and the bucket isn&#8217;t very full,
it&#8217;s easy. And even lifting a full bucket is pretty easy at first.  But after a
while, you&#8217;re going to get tired. TDD is like having a ratchet that lets you
save your progress, take a break, and make sure you never slip backwards.  That
way you don&#8217;t have to be smart <em>all</em> the time.</p>
</div>
<div id="figure4-1" class="imageblock" style="float: right">
<div class="content">
<img src="images/twdp_0401.png" alt="Test ALL the things">
</div>
<div class="title">Figure 1. Test ALL the things (original illustration source: <a href="http://bit.ly/1iXxdYp">Allie Brosh, Hyperbole and a Half</a>)</div>
</div>
<div class="paragraph">
<p>OK, perhaps <em>in general</em>, you&#8217;re prepared to concede that TDD is a good
idea, but maybe you still think I&#8217;m overdoing it?  Testing the tiniest thing,
and taking ridiculously many small steps?</p>
</div>
<div class="paragraph">
<p>TDD is a <em>discipline</em>, and that means it&#8217;s not something that comes naturally;
because many of the payoffs aren&#8217;t immediate but only come in the longer term,
you have to force yourself to do it in the moment. That&#8217;s what the image of the
Testing Goat is supposed to illustrate&#8212;&#8203;you need to be a bit bloody-minded
about it.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">On the Merits of Trivial Tests for Trivial Functions</div>
<div class="paragraph">
<p>In the short term it may feel a bit silly to write tests for simple
functions and constants.

It&#8217;s perfectly possible to imagine still doing
&#8220;mostly&#8221; TDD, but following more relaxed rules where you don&#8217;t unit test
<em>absolutely</em> everything.  But in this book my aim is to demonstrate full,
rigorous TDD. Like a kata in a martial art, the idea is to learn the motions
in a controlled context, when there is no adversity, so that the techiques
are part of your muscle memory. It seems trivial now, because we&#8217;ve started
with a very simple example. The problem comes when your application gets
complex&#8212;&#8203;that&#8217;s when you really need your tests.  And the danger is that
complexity tends to sneak up on you, gradually.  You may not notice it
happening, but quite soon you&#8217;re a boiled frog.</p>
</div>
<div class="paragraph">
<p>There are two other things to say in favour of tiny, simple tests for simple
functions:</p>
</div>
<div class="paragraph">
<p>Firstly, if they&#8217;re really trivial tests, then they won&#8217;t take you that long to
write them. So stop moaning and just write them already.</p>
</div>
<div class="paragraph">
<p>Secondly, it&#8217;s always good to have a placeholder.  Having a test <em>there</em> for a
simple function means it&#8217;s that much less of a psychological barrier to
overcome when the simple function gets a tiny bit more complex&#8212;&#8203;perhaps it
grows an <code>if</code>. Then a few weeks later it grows a <code>for</code> loop. Before you know
it, it&#8217;s a recursive metaclass-based polymorphic tree parser factory.  But
because it&#8217;s had tests from the very beginning, adding a new test each time has
felt quite natural, and it&#8217;s well tested.  The alternative involves trying to
decide when a function becomes &#8220;complicated enough&#8221; which is highly
subjective, but worse, because there&#8217;s no placeholder, it seems like that
much more effort, and you&#8217;re tempted each time to put it off a little longer,
and pretty soon&#8212;&#8203;frog soup!</p>
</div>
<div class="paragraph">
<p>Instead of trying to figure out some hand-wavy subjective rules for when
you should write tests, and when you can get away with not bothering, I suggest
following the discipline for now&#8212;&#8203;like any discipline, you have to take the
time to learn the rules before you can break them.

</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, back to our onions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_selenium_to_test_user_interactions">Using Selenium to Test User Interactions</h3>
<div class="paragraph">
<p>

Where were we at the end of the last chapter? Let&#8217;s rerun the test and find
out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python functional_tests.py</strong>
F
======================================================================
FAIL: test_can_start_a_list_and_retrieve_it_later (__main__.NewVisitorTest)
 ---------------------------------------------------------------------
Traceback (most recent call last):
  File "functional_tests.py", line 20, in
test_can_start_a_list_and_retrieve_it_later
    self.fail('Finish the test!')
AssertionError: Finish the test!

 ---------------------------------------------------------------------
Ran 1 test in 1.609s

FAILED (failures=1)</pre>
</div>
</div>
<div class="paragraph">
<p>Did you try it, and get an error saying <em>Problem loading page</em> or
<em>Unable to connect</em>?  So did I. It&#8217;s because we forgot to spin up the dev
server first using <code>manage.py runserver</code>.  Do that, and you&#8217;ll get the failure
message we&#8217;re after.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
One of the great things about TDD is that you never have to worry about
forgetting what to do next&#8212;&#8203;just rerun your tests and they will tell
you what you need to work on.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>&#8220;Finish the test&#8221;, it says, so let&#8217;s do just that!  Open up
<em>functional_tests.py</em> and we&#8217;ll extend our FT:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">selenium</span> <span class="keyword">import</span> <span class="include">webdriver</span>
<span class="keyword">from</span> <span class="include">selenium.webdriver.common.keys</span> <span class="keyword">import</span> <span class="include">Keys</span>
<span class="keyword">import</span> <span class="include">unittest</span>

<span class="keyword">class</span> <span class="class">NewVisitorTest</span>(unittest.TestCase):

    <span class="keyword">def</span> <span class="function">setUp</span>(<span class="predefined-constant">self</span>):
        <span class="predefined-constant">self</span>.browser = webdriver.Firefox()
        <span class="predefined-constant">self</span>.browser.implicitly_wait(<span class="integer">3</span>)

    <span class="keyword">def</span> <span class="function">tearDown</span>(<span class="predefined-constant">self</span>):
        <span class="predefined-constant">self</span>.browser.quit()

    <span class="keyword">def</span> <span class="function">test_can_start_a_list_and_retrieve_it_later</span>(<span class="predefined-constant">self</span>):
        <span class="comment"># Edith has heard about a cool new online to-do app. She goes</span>
        <span class="comment"># to check out its homepage</span>
        <span class="predefined-constant">self</span>.browser.get(<span class="string"><span class="delimiter">'</span><span class="content">http://localhost:8000</span><span class="delimiter">'</span></span>)

        <span class="comment"># She notices the page title and header mention to-do lists</span>
        <span class="predefined-constant">self</span>.assertIn(<span class="string"><span class="delimiter">'</span><span class="content">To-Do</span><span class="delimiter">'</span></span>, <span class="predefined-constant">self</span>.browser.title)
        header_text = <span class="predefined-constant">self</span>.browser.find_element_by_tag_name(<span class="string"><span class="delimiter">'</span><span class="content">h1</span><span class="delimiter">'</span></span>).text
        <span class="predefined-constant">self</span>.assertIn(<span class="string"><span class="delimiter">'</span><span class="content">To-Do</span><span class="delimiter">'</span></span>, header_text)

        <span class="comment"># She is invited to enter a to-do item straight away</span>
        inputbox = <span class="predefined-constant">self</span>.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_new_item</span><span class="delimiter">'</span></span>)
        <span class="predefined-constant">self</span>.assertEqual(
            inputbox.get_attribute(<span class="string"><span class="delimiter">'</span><span class="content">placeholder</span><span class="delimiter">'</span></span>),
            <span class="string"><span class="delimiter">'</span><span class="content">Enter a to-do item</span><span class="delimiter">'</span></span>
        )

        <span class="comment"># She types "Buy peacock feathers" into a text box (Edith's hobby</span>
        <span class="comment"># is tying fly-fishing lures)</span>
        inputbox.send_keys(<span class="string"><span class="delimiter">'</span><span class="content">Buy peacock feathers</span><span class="delimiter">'</span></span>)

        <span class="comment"># When she hits enter, the page updates, and now the page lists</span>
        <span class="comment"># "1: Buy peacock feathers" as an item in a to-do list table</span>
        inputbox.send_keys(Keys.ENTER)

        table = <span class="predefined-constant">self</span>.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_list_table</span><span class="delimiter">'</span></span>)
        rows = table.find_elements_by_tag_name(<span class="string"><span class="delimiter">'</span><span class="content">tr</span><span class="delimiter">'</span></span>)
        <span class="predefined-constant">self</span>.assertTrue(
            <span class="predefined">any</span>(row.text == <span class="string"><span class="delimiter">'</span><span class="content">1: Buy peacock feathers</span><span class="delimiter">'</span></span> <span class="keyword">for</span> row <span class="keyword">in</span> rows)
        )

        <span class="comment"># There is still a text box inviting her to add another item. She</span>
        <span class="comment"># enters "Use peacock feathers to make a fly" (Edith is very</span>
        <span class="comment"># methodical)</span>
        <span class="predefined-constant">self</span>.fail(<span class="string"><span class="delimiter">'</span><span class="content">Finish the test!</span><span class="delimiter">'</span></span>)

        <span class="comment"># The page updates again, and now shows both items on her list</span>
        [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re using several of the methods that Selenium provides to examine web
pages: <code>find_element_by_tag_name</code>, <code>find_element_by_id</code>, and
<code>find_element<strong>s</strong>_by_tag_name</code> (notice the extra <code>s</code>, which means it will
return several elements rather than just one).  We also use <code>send_keys</code>,
which is Selenium&#8217;s way of typing into input elements. You&#8217;ll also see the
<code>Keys</code> class (don&#8217;t forget to import it), which lets us send special keys
like Enter, but also modifiers like Ctrl.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Watch out for the difference between the Selenium <code>find_element_by...</code>
and <code>find_elements_by...</code> functions.  One returns an element, and raises
an exception if it can&#8217;t find it, whereas the other returns a list, which
may be empty.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>
Also, just look at that <code>any</code> function. It&#8217;s a little-known Python built-in.
I don&#8217;t even need to explain it, do I? Python is such a joy.</p>
</div>
<div class="paragraph">
<p>

Although, if you&#8217;re one of my readers who doesn&#8217;t know Python, what&#8217;s happening
inside the <code>any</code> is a <em>generator expression</em>, which is like a <em>list
comprehension</em> but awesomer. You need to read up on this. If you Google it,
you&#8217;ll find <a href="http://bit.ly/1iXxD18">Guido himself explaining it nicely</a>.
Come back and tell me that&#8217;s not pure joy!</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see how it gets on:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python functional_tests.py</strong>
[...]
selenium.common.exceptions.NoSuchElementException: Message: Unable to locate
element: {"method":"tag name","selector":"h1"}
Stacktrace:
[...]</pre>
</div>
</div>
<div class="paragraph">
<p>Decoding that, the test is saying it can&#8217;t find an <code>&lt;h1&gt;</code> element on the page.
Let&#8217;s see what we can do to add that to the HTML of our home page.</p>
</div>
<div class="paragraph">
<p>Big changes to a functional test are usually a good thing to commit on their
own. I failed to do so in my first draft, and I regretted it later when I
changed my mind and had the change mixed up with a bunch of others.  The more
atomic your commits, the better:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git diff</strong>  # should show changes to functional_tests.py
$ <strong>git commit -am "Functional test now checks we can input a to-do item"</strong></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_don_t_test_constants_rule_and_templates_to_the_rescue">The &#8220;Don&#8217;t Test Constants&#8221; Rule, and Templates to the Rescue</h3>
<div class="paragraph">
<p>
Let&#8217;s take a look at our unit tests, <em>lists/tests.py</em>.  Currently we&#8217;re looking
for specific HTML strings, but that&#8217;s not a particularly efficient way of
testing HTML.  In general, one of the rules of unit testing is <em>Don&#8217;t test
constants</em>, and testing HTML as text is a lot like testing a constant.</p>
</div>
<div class="paragraph">
<p>In other words, if you have some code that says:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">wibble = <span class="integer">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s not much point in a test that says:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">myprogram</span> <span class="keyword">import</span> <span class="include">wibble</span>
<span class="keyword">assert</span> wibble == <span class="integer">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unit tests are really about testing logic, flow control, and configuration.
Making assertions about exactly what sequence of characters we have in our HTML
strings isn&#8217;t doing that.</p>
</div>
<div class="paragraph">
<p>What&#8217;s more, mangling raw strings in Python really isn&#8217;t a great way of dealing
with HTML.  There&#8217;s a much better solution, which is to use templates.  Quite
apart from anything else, if we can keep HTML to one side in a file whose name
ends in <em>.html</em>, we&#8217;ll get better syntax highlighting! There are lots of Python
templating frameworks out there, and Django has its own which works very well.
Let&#8217;s use that.

</p>
</div>
<div class="sect3">
<h4 id="_refactoring_to_use_a_template">Refactoring to Use a Template</h4>
<div class="paragraph">
<p>

What we want to do now is make our view function return exactly the same HTML,
but just using a different process. That&#8217;s a refactor&#8212;&#8203;when we try to
improve the code <em>without changing its functionality</em>.</p>
</div>
<div class="paragraph">
<p>That last bit is really important. If you try and add new functionality at the
same time as refactoring, you&#8217;re much more likely to run into trouble.
Refactoring is actually a whole discipline in itself, and it even has a
reference book: Martin Fowler&#8217;s <a href="http://refactoring.com/">Refactoring</a>.</p>
</div>
<div class="paragraph">
<p>The first rule is that you can&#8217;t refactor without tests.  Thankfully, we&#8217;re doing
TDD, so we&#8217;re way ahead of the game.  Let&#8217;s check our tests pass; they will
be what makes sure that our refactoring is behaviour preserving:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python manage.py test</strong>
[...]
OK</pre>
</div>
</div>
<div class="paragraph">
<p>Great! We&#8217;ll start by taking our HTML string and putting it into its own file.
Create a directory called <em>lists/templates</em> to keep templates in, and then open
a file at <em>lists/templates/home.html</em>, to which we&#8217;ll transfer our
HTML:<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup></p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/home.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html&gt;</span>
    <span class="tag">&lt;title&gt;</span>To-Do lists<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mmmh, syntax-highlighted&#8230;&#8203;much nicer! Now to change our view function:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.shortcuts</span> <span class="keyword">import</span> <span class="include">render</span>

<span class="keyword">def</span> <span class="function">home_page</span>(request):
    <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of building our own <code>HttpResponse</code>, we now use the Django <code>render</code>
function.  It takes the request as its first parameter (for reasons we&#8217;ll go
into later) and the name of the template to render.  Django will automatically
search folders called <em>templates</em> inside any of your apps' directories.  Then
it builds an <code>HttpResponse</code> for you, based on the content of the template.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Templates are a very powerful feature of Django&#8217;s, and their main
strength consists of substituting Python variables into HTML text. We&#8217;re
not using this feature yet, but we will in future chapters.  That&#8217;s
why we use <code>render</code> and (later) <code>render_to_</code> <code>string</code> rather than, say, manually
reading the file from disk with the built-in <code>open</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s see if it works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python manage.py test</strong>
[...]
======================================================================
ERROR: test_home_page_returns_correct_html (lists.tests.HomePageTest)<i class="conum" data-value="2"></i><b>(2)</b>
 ---------------------------------------------------------------------
Traceback (most recent call last):
  File "/.../superlists/lists/tests.py", line 17, in
test_home_page_returns_correct_html
    response = home_page(request)<i class="conum" data-value="3"></i><b>(3)</b>
  File "/.../superlists/lists/views.py", line 5, in home_page
    return render(request, 'home.html')<i class="conum" data-value="4"></i><b>(4)</b>
  File "/usr/local/lib/python3.5/dist-packages/django/shortcuts.py", line 48,
in render
    return HttpResponse(loader.render_to_string(*args, **kwargs),
  File "/usr/local/lib/python3.5/dist-packages/django/template/loader.py", line
170, in render_to_string
    t = get_template(template_name, dirs)
  File "/usr/local/lib/python3.5/dist-packages/django/template/loader.py", line
144, in get_template
    template, origin = find_template(template_name, dirs)
  File "/usr/local/lib/python3.5/dist-packages/django/template/loader.py", line
136, in find_template
    raise TemplateDoesNotExist(name)
django.template.base.TemplateDoesNotExist: home.html<i class="conum" data-value="1"></i><b>(1)</b>

 ---------------------------------------------------------------------
Ran 2 tests in 0.004s</pre>
</div>
</div>
<div class="paragraph">
<p>Another chance to analyse a traceback:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We start with the error: it can&#8217;t find the template.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Then we double-check what test is failing: sure enough, it&#8217;s our test
of the view HTML.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Then we find the line in our tests that caused the failure: it&#8217;s when
we call the <code>home_page</code> function.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Finally, we look for the part of our own application code that caused the
failure: it&#8217;s when we try and call <code>render</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So why can&#8217;t Django find the template?  It&#8217;s right where it&#8217;s supposed to be,
in the <em>lists/templates</em> folder.</p>
</div>
<div class="paragraph">
<p>The thing is that we haven&#8217;t yet <em>officially</em> registered our lists app with
Django. Unfortunately, just running the <code>startapp</code> command and
having what is obviously an app in your project folder isn&#8217;t quite enough.  You
have to tell Django that you <em>really</em> mean it, and add it to <em>settings.py</em> as
well. Belt and braces. Open it up and look for a variable called
<code>INSTALLED_APPS</code>, to which we&#8217;ll add <code>lists</code>:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">superlists/settings.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment"># Application definition</span>

INSTALLED_APPS = [
    <span class="string"><span class="delimiter">'</span><span class="content">django.contrib.admin</span><span class="delimiter">'</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">django.contrib.auth</span><span class="delimiter">'</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">django.contrib.contenttypes</span><span class="delimiter">'</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">django.contrib.sessions</span><span class="delimiter">'</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">django.contrib.messages</span><span class="delimiter">'</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">django.contrib.staticfiles</span><span class="delimiter">'</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">lists</span><span class="delimiter">'</span></span>,
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see there&#8217;s lots of apps already in there by default.  We just need to
add ours, <code>lists</code>, to the bottom of the list.  Don&#8217;t forget the trailing comma&#8212;&#8203;it may not be required, but one day you&#8217;ll be really annoyed when you forget
it and Python concatenates two strings on different lines&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Now we can try running the tests again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python manage.py test</strong>
    [...]
    self.assertTrue(html.endswith('&lt;/html&gt;'))
AssertionError: False is not true</pre>
</div>
</div>
<div class="paragraph">
<p>Darn, not quite.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Depending on whether your text editor insists on adding newlines to the
      end of files, you may not even see this error.  If so, you can safely
      ignore the next bit, and skip straight to where you can see the listing
      says OK.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>But it did get further!  It seems it&#8217;s managed to find our template, but
the last of the three assertions is failing. Apparently there&#8217;s something wrong
at the end of the output. I had to do a little <code>print(repr(html))</code>
to debug this, but it turns out that the switch to templates has introduced an
additional newline (<code>\n</code>) at the end. We can get them to pass like this:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="predefined-constant">self</span>.assertTrue(html.strip().endswith(<span class="string"><span class="delimiter">'</span><span class="content">&lt;/html&gt;</span><span class="delimiter">'</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s a tiny bit of a cheat, but whitespace at the end of an HTML file really
shouldn&#8217;t matter to us. Let&#8217;s try running the tests again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python manage.py test</strong>
[...]
OK</pre>
</div>
</div>
<div class="paragraph">
<p>Our refactor of the code is now complete, and the tests mean we&#8217;re happy that
behaviour is preserved. Now we can change the tests so that they&#8217;re no longer
testing constants; instead, they should just check that we&#8217;re rendering the
right template.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_django_test_client">The Django Test Client</h4>
<div class="paragraph">
<p>One way we could test this is to manually render the template ourselves in the
test, and then compare that to what the view returns.  Django has a function
called <code>render_to_string</code> which will let us do that:</p>
</div>
<div class="listingblock sourcecode skipme">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.template.loader</span> <span class="keyword">import</span> <span class="include">render_to_string</span>
[...]

    <span class="keyword">def</span> <span class="function">test_home_page_returns_correct_html</span>(<span class="predefined-constant">self</span>):
        request = HttpRequest()
        response = home_page(request)
        html = response.content.decode(<span class="string"><span class="delimiter">'</span><span class="content">utf8</span><span class="delimiter">'</span></span>)
        expected_html = render_to_string(<span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>)
        <span class="predefined-constant">self</span>.assertEqual(html, expected_html)</code></pre>
</div>
</div>
<div class="paragraph">
<p>
But that&#8217;s a bit of an unwieldy way of testing that we use the right template.
And all this faffing about with <code>.decode()</code>, and <code>.strip()</code> is distracting.
Instead, Django gives us a tool called the Django Test Client, which has
built-in ways of checking what templates are used.  Here&#8217;s how it looks:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">def</span> <span class="function">test_home_page_returns_correct_html</span>(<span class="predefined-constant">self</span>):
        response = <span class="predefined-constant">self</span>.client.get(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)  <i class="conum" data-value="1"></i><b>(1)</b>

        html = response.content.decode(<span class="string"><span class="delimiter">'</span><span class="content">utf8</span><span class="delimiter">'</span></span>)  <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="predefined-constant">self</span>.assertTrue(html.startswith(<span class="string"><span class="delimiter">'</span><span class="content">&lt;html&gt;</span><span class="delimiter">'</span></span>))
        <span class="predefined-constant">self</span>.assertIn(<span class="string"><span class="delimiter">'</span><span class="content">&lt;title&gt;To-Do lists&lt;/title&gt;</span><span class="delimiter">'</span></span>, html)
        <span class="predefined-constant">self</span>.assertTrue(html.strip().endswith(<span class="string"><span class="delimiter">'</span><span class="content">&lt;/html&gt;</span><span class="delimiter">'</span></span>))

        <span class="predefined-constant">self</span>.assertTemplateUsed(response, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>)  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instead of manually creating an <code>HttpRequest</code> object and calling the view
function directly, we call <code>self.client.get</code>, passing it the URL we want
to test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We&#8217;ll leave the old tests there for now, just to make sure everything is
working the way we think it is.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>.assertTemplateUsed</code> is the test method that the django <code>TestCase</code> class
provides us.  It lets us check what template was used to render a response
(NB - it will only work for responses that were retrieved by the Test
Client.)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And that test will still pass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Ran 2 tests in 0.016s

OK</pre>
</div>
</div>
<div class="paragraph">
<p>Just because I&#8217;m always suspicious of a test I haven&#8217;t seen fail, let&#8217;s
deliberately break it.</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">        <span class="predefined-constant">self</span>.assertTemplateUsed(response, <span class="string"><span class="delimiter">'</span><span class="content">wrong.html</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That way we&#8217;ll also learn what its error messages look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: False is not true : Template 'wrong.html' was not a template
used to render the response. Actual template(s) used: home.html</pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s very helpful!  Let&#8217;s change the assert back to the right thing.  While
we&#8217;re at it, we can delete our old assertions.  And we can also delete the
old <code>test_root_url_resolves</code> test, because that&#8217;s tested implicitly by the
Django test client.  We&#8217;ve combined two long-winded tests into one!</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py (ch04l010)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.test</span> <span class="keyword">import</span> <span class="include">TestCase</span>

<span class="keyword">class</span> <span class="class">HomePageTest</span>(TestCase):

    <span class="keyword">def</span> <span class="function">test_uses_home_template</span>(<span class="predefined-constant">self</span>):
        response = <span class="predefined-constant">self</span>.client.get(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)
        <span class="predefined-constant">self</span>.assertTemplateUsed(response, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main point, though, is that instead of testing constants we&#8217;re testing our
implementation.
Great!<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</sup></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Why didn&#8217;t we just use the Django Test Client all along?</div>
<div class="paragraph">
<p>You may be asking yourself "why didn&#8217;t we just use the Django Test Client from
the very beginning?".  In real life, that&#8217;s what I would do.  But I wanted to
show you the "manual" way of doing it first for a couple of reasons.  Firstly
because it allowed me to introduce concepts one by one, and keep the learning
curve as shallow as possible.  Secondly, because you may not always be using
Django to build your apps, and testing tools may not always be available&#8212;&#8203;but
calling functions directly and examining their responses is always possible!</p>
</div>
<div class="paragraph">
<p>I should also mention that some people really don&#8217;t like the Django test
client.  They say it does too much magic, and involves too much of the stack to
be used in a real "unit" test&#8212;&#8203;you end up writing what are more properly called
integrated tests.  They also complain that it is relatively slow (and
relatively is measured in milliseconds here). We&#8217;ll explore this argument
further in <a href="/book/chapter_19.html">a later chapter</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_refactoring">On Refactoring</h3>
<div class="paragraph">
<p>
That was an absolutely trivial example of refactoring. But, as Kent Beck puts
it in <a href="#tddbe"><em>Test-Driven Development: By Example</em></a>, "Am I recommending that
you actually work this way? No. I&#8217;m recommending that you be <em>able</em> to work
this way."</p>
</div>
<div class="paragraph">
<p>In fact, as I was writing this my first instinct was to dive in and change the
test first&#8212;&#8203;make it use the <code>assertTemplateUsed</code> function straight away,
delete the three superfluous assertions, leaving just a check of the contents
against the expected render, and then go ahead and make the code change.  But
notice how that actually would have left space for me to break things: I could
have defined the template as containing <em>any</em> arbitrary string, instead of
the string with the right <code>&lt;html&gt;</code> and <code>&lt;title&gt;</code> tags.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When refactoring, work on either the code or the tests, but not both at
     once.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>
There&#8217;s always a tendency to skip ahead a couple of steps, to make a couple of
tweaks to the behaviour while you&#8217;re refactoring, but pretty soon you&#8217;ve got
changes to half a dozen different files, you&#8217;ve totally lost track of where you
are, and nothing works any more.  If you don&#8217;t want to end up like
<a href="http://bit.ly/1iXyRt4">Refactoring Cat</a> (<a href="#RefactoringCat">Refactoring Cat&#8212;&#8203;be sure to look up the full animated GIF (source: 4GIFs.com)</a>), stick to small
steps; keep refactoring and functionality changes entirely separate.</p>
</div>
<div id="RefactoringCat" class="imageblock">
<div class="content">
<img src="images/twdp_0402.png" alt="An adventurous cat, trying to refactor its way out of a slippery bathtub">
</div>
<div class="title">Figure 2. Refactoring Cat&#8212;&#8203;be sure to look up the full animated GIF (source: 4GIFs.com)</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We&#8217;ll come across &#8220;Refactoring Cat&#8221; again during this book,
    as an example of what happens when we get carried away and want to change
    too many things at once. Think of it as the little cartoon demon
    counterpart to the Testing Goat, popping up over your other shoulder and
    giving you bad advice&#8230;&#8203;
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s a good idea to do a commit after any refactoring:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git status</strong> # see tests.py, views.py, settings.py, + new templates folder
$ <strong>git add .</strong>  # will also add the untracked templates folder
$ <strong>git diff --staged</strong> # review the changes we're about to commit
$ <strong>git commit -m "Refactor home page view to use a template"</strong></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
</div>
<div class="sect2">
<h3 id="_a_little_more_of_our_front_page">A Little More of Our Front Page</h3>
<div class="paragraph">
<p>In the meantime, our functional test is still failing.  Let&#8217;s now make an
actual code change to get it passing.  Because our HTML is now in a template,
we can feel free to make changes to it, without needing to write any extra unit
tests.  We wanted an <code>&lt;h1&gt;</code>:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/home.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>To-Do lists<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h1&gt;</span>Your To-Do list<span class="tag">&lt;/h1&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s see if our functional test likes it a little better:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>selenium.common.exceptions.NoSuchElementException: Message: Unable to locate
element: {"method":"id","selector":"id_new_item"}</pre>
</div>
</div>
<div class="paragraph">
<p>OK&#8230;&#8203;</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/home.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">    [...]
        <span class="tag">&lt;h1&gt;</span>Your To-Do list<span class="tag">&lt;/h1&gt;</span>
        <span class="tag">&lt;input</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">id_new_item</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
    [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now?</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: '' != 'Enter a to-do item'</pre>
</div>
</div>
<div class="paragraph">
<p>We add our placeholder text&#8230;&#8203;</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/home.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">    <span class="tag">&lt;input</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">id_new_item</span><span class="delimiter">"</span></span> <span class="attribute-name">placeholder</span>=<span class="string"><span class="delimiter">"</span><span class="content">Enter a to-do item</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which gives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>selenium.common.exceptions.NoSuchElementException: Message: Unable to locate
element: {"method":"id","selector":"id_list_table"}</pre>
</div>
</div>
<div class="paragraph">
<p>So we can go ahead and put the table onto the page. At this stage it&#8217;ll just be
empty&#8230;&#8203;</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/home.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">    <span class="tag">&lt;input</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">id_new_item</span><span class="delimiter">"</span></span> <span class="attribute-name">placeholder</span>=<span class="string"><span class="delimiter">"</span><span class="content">Enter a to-do item</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">id_list_table</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;/table&gt;</span>
<span class="tag">&lt;/body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now what does the FT say?</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  File "functional_tests.py", line 42, in
test_can_start_a_list_and_retrieve_it_later
    any(row.text == '1: Buy peacock feathers' for row in rows)
AssertionError: False is not true</pre>
</div>
</div>
<div class="paragraph">
<p>

Slightly cryptic. We can use the line number to track it down, and it turns out
it&#8217;s that <code>any</code> function I was so smug about earlier&#8212;&#8203;or, more precisely, the
<code>assertTrue</code>, which doesn&#8217;t have a very explicit failure message.  We can pass
a custom error message as an argument to most <code>assertX</code> methods in <code>unittest</code>:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="predefined-constant">self</span>.assertTrue(
        <span class="predefined">any</span>(row.text == <span class="string"><span class="delimiter">'</span><span class="content">1: Buy peacock feathers</span><span class="delimiter">'</span></span> <span class="keyword">for</span> row <span class="keyword">in</span> rows),
        <span class="string"><span class="delimiter">"</span><span class="content">New to-do item did not appear in table</span><span class="delimiter">"</span></span>
    )</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run the FT again, you should see our message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: False is not true : New to-do item did not appear in table</pre>
</div>
</div>
<div class="paragraph">
<p>
But now, to get this to pass, we will need to actually process the user&#8217;s
form submission.  And that&#8217;s a topic for the next chapter.</p>
</div>
<div class="paragraph">
<p>For now let&#8217;s do a commit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git diff</strong>
$ <strong>git commit -am "Front page HTML now generated from a template"</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Thanks to a bit of refactoring, we&#8217;ve got our view set up to render a template,
we&#8217;ve stopped testing constants, and we&#8217;re now well placed to start processing
user input.</p>
</div>
</div>
<div class="sect2">
<h3 id="_recap_the_tdd_process">Recap: The TDD Process</h3>
<div class="paragraph">
<p>
We&#8217;ve now seen all the main aspects of the TDD process, in practice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Functional tests</p>
</li>
<li>
<p>Unit tests</p>
</li>
<li>
<p>The unit-test/code cycle</p>
</li>
<li>
<p>Refactoring</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s time for a little recap, and perhaps even some flowcharts.  Forgive me,
years misspent as a management consultant have ruined me. On the plus side,
it will feature recursion.</p>
</div>
<div class="paragraph">
<p>What is the overall TDD process? See <a href="#simple-TDD-diagram">Overall TDD process</a>.</p>
</div>
<div id="simple-TDD-diagram" class="imageblock">
<div class="content">
<img src="images/twdp_0403.png" alt="A flowchart showing tests, coding and refactoring">
</div>
<div class="title">Figure 3. Overall TDD process</div>
</div>
<div class="paragraph">
<p>We write a test. We run the test and see it fail.  We write some minimal code
to get it a little further.  We rerun the test and repeat until it passes.
Then, optionally, we might refactor our code, using our tests to make sure we
don&#8217;t break anything.</p>
</div>
<div class="paragraph">
<p>

But how does this apply when we have functional tests <em>and</em> unit tests?  Well,
you can think of the functional test as being a high-level view of the cycle,
where "writing the code" to get the functional tests to pass actually involves
using another, smaller TDD cycle which uses unit tests. See
<a href="#Double-Loop-TDD-diagram">The TDD process with functional and unit tests</a>.</p>
</div>
<div id="Double-Loop-TDD-diagram" class="imageblock">
<div class="content">
<img src="images/twdp_0404.png" alt="A flowchart showing functional tests as the overall cycle, and unit tests helping to code">
</div>
<div class="title">Figure 4. The TDD process with functional and unit tests</div>
</div>
<div class="paragraph">
<p>We write a functional test and see it fail.  Then, the process of "writing
code" to get it to pass is a mini-TDD cycle of its own:  we write one or more
unit tests, and go into the unit-test/code cycle until the unit tests pass.
Then, we go back to our FT to check that it gets a little further, and we
can write a bit more of our application&#8212;&#8203;using more unit tests, and so on.</p>
</div>
<div class="paragraph">
<p>What about refactoring, in the context of functional tests?  Well, that means
we use the functional test to check that we&#8217;ve preserved the behaviour of
our application, but we can change or add and remove unit tests, and use
a unit test cycle to actually change the implementation.</p>
</div>
<div class="paragraph">
<p>The functional tests are the ultimate judge of whether your application works
or not.  The unit tests are a tool to help you along the way.</p>
</div>
<div class="paragraph">
<p>This way of looking at things is sometimes called "Double-Loop TDD". One of my
eminent tech reviewers, Emily Bache, wrote <a href="http://bit.ly/1iXzoLR">a blog post</a>
on the topic, which I recommend for a different perspective.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll explore all of the different parts of this workflow in more detail
over the coming chapters.
</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">How to "Check" Your Code, or Skip Ahead (If You Must)</div>
<div class="paragraph">
<p>All of the code examples I&#8217;ve used in the book are available in
<a href="https://github.com/hjwp/book-example/">my repo</a> on GitHub.  So, if you ever want
to compare your code against mine, you can take a look at it there.</p>
</div>
<div class="paragraph">
<p>Each chapter has its own branch following the convention <code>chapter_XX</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Chapter 3: <a href="https://github.com/hjwp/book-example/tree/chapter_03" class="bare">https://github.com/hjwp/book-example/tree/chapter_03</a></p>
</li>
<li>
<p>Chapter 4: <a href="https://github.com/hjwp/book-example/tree/chapter_04" class="bare">https://github.com/hjwp/book-example/tree/chapter_04</a></p>
</li>
<li>
<p>Chapter 5: <a href="https://github.com/hjwp/book-example/tree/chapter_05" class="bare">https://github.com/hjwp/book-example/tree/chapter_05</a></p>
</li>
<li>
<p>Etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Be aware that each branch contains all of the commits for that chapter,
so its state represents the code at the <em>end</em> of the chapter.</p>
</div>
<div class="paragraph">
<p><strong>Using Git to check your progress</strong></p>
</div>
<div class="paragraph">
<p>If you feel like developing your Git-Fu a little further, you can add
my repo as a <em>remote</em>:</p>
</div>
<div class="listingblock skipme">
<div class="content">
<pre>git remote add harry https://github.com/hjwp/book-example.git
git fetch harry</pre>
</div>
</div>
<div class="paragraph">
<p>And then, to check your difference from the <em>end</em> of <a href="/book/chapter_04.html">What Are We Doing with All These Tests?</a>:</p>
</div>
<div class="listingblock skipme">
<div class="content">
<pre>git diff harry/chapter_04</pre>
</div>
</div>
<div class="paragraph">
<p>Git can handle multiple remotes, so you can still do this even if you&#8217;re
already pushing your code up to GitHub or Bitbucket.</p>
</div>
<div class="paragraph">
<p>Be aware that the precise order of, say, methods in a class may differ
between your version and mine.  It may make diffs hard to read.</p>
</div>
<div class="paragraph">
<p><strong>Downloading a ZIP file for a chapter</strong></p>
</div>
<div class="paragraph">
<p>If, for whatever reason, you want to "start from scratch" for a chapter, or
skip ahead,<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</sup>
and/or you&#8217;re just not comfortable with Git, you can download a version of my
code as a ZIP file, from URLs following this pattern:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/hjwp/book-example/archive/chapter_05.zip" class="bare">https://github.com/hjwp/book-example/archive/chapter_05.zip</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/hjwp/book-example/archive/chapter_06.zip" class="bare">https://github.com/hjwp/book-example/archive/chapter_06.zip</a></p>
</div>
<div class="paragraph">
<p><strong>Don&#8217;t let it become a crutch!</strong></p>
</div>
<div class="paragraph">
<p>Try not to sneak a peak at the answers unless you&#8217;re really, really stuck.
Like I said at the beginning of the last chapter, there&#8217;s a lot of value in
debugging errors all by yourself, and in real life, there&#8217;s no "harrys repo" to
check against and find all the answers.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. Some people like to use another subfolder named after the app (i.e., <em>lists/templates/lists</em>) and then refer to the template as <em>lists/home.html</em>.  This is called "template namespacing". I figured it was overcomplicated for this small project, but it may be worth it on larger projects.  There&#8217;s more in the <a href="http://bit.ly/1iXxWZL">Django tutorial</a>.
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. Are you unable to move on because you&#8217;re wondering what those <em>ch04l0xx</em> things are, next to some of the code listings?  They refer to specific <a href="https://github.com/hjwp/book-example/commits/chapter_04">commits</a> in the book&#8217;s example repo.  It&#8217;s all to do with my book&#8217;s own <a href="https://github.com/hjwp/Book-TDD-Web-Dev-Python/tree/master/tests">tests</a>.  You know, the tests for the tests in the book about testing. They have tests of their own, naturally.
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. I don&#8217;t recommend skipping ahead. I haven&#8217;t designed the chapters to stand on their own; each relies on the previous ones, so it may be more confusing than anything else&#8230;&#8203;
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-01-05 14:14:36 GMT
</div>
</div>
<div class="comments" style="padding: 20px">
  <h3>Comments</h3>
  <div id="disqus_thread"></div>

  <script type="text/javascript">
var disqus_shortname = 'obeythetestinggoat';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
  </script>

  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
<html><head><script>   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)   })(window,document,'script','//www.google-analytics.com/analytics.js','ga');    ga('create', 'UA-40928035-1', 'obeythetestinggoat.com');   ga('send', 'pageview');  </script>
</head></html></body>
</html>