<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>Saving User Input</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="buy_the_book" style="position: absolute; top: 0; right: 0; z-index:100">
  <a href="/pages/book.html">
    <img src="images/buy_the_book.svg" alt="buy the book ribbon">
  </a>
</div>
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="/book/praise.harry.html">Praise for <em>Test-Driven Development with Python</em></a></li>
<li><a href="/book/preface.html">Preface</a>
<ul class="sectlevel2">
<li><a href="/book/preface.html#_why_i_wrote_a_book_about_test_driven_development">Why I Wrote a Book About Test-Driven Development</a></li>
<li><a href="/book/preface.html#_aims_of_this_book">Aims of This Book</a></li>
<li><a href="/book/preface.html#_outline">Outline</a></li>
<li><a href="/book/preface.html#_conventions_used_in_this_book">Conventions Used in This Book</a></li>
<li><a href="/book/preface.html#_using_code_examples">Using Code Examples</a></li>
<li><a href="/book/preface.html#_safari_books_online">Safari&#174; Books Online</a></li>
<li><a href="/book/preface.html#_contacting_o_reilly">Contacting O&#8217;Reilly</a></li>
</ul>
</li>
<li><a href="/book/pre-requisite-installations.html">Prerequisites and Assumptions</a>
<ul class="sectlevel2">
<li><a href="/book/pre-requisite-installations.html#_python_3_and_programming">Python 3 and Programming</a></li>
<li><a href="/book/pre-requisite-installations.html#_how_html_works">How HTML Works</a></li>
<li><a href="/book/pre-requisite-installations.html#_javascript">JavaScript</a></li>
<li><a href="/book/pre-requisite-installations.html#_required_software_installations">Required Software Installations</a></li>
</ul>
</li>
<li><a href="/book/video_plug.html">Companion Video</a></li>
<li><a href="/book/acknowledgments.html">Acknowledgments</a></li>
<li><a href="/book/part1.harry.html">The Basics of TDD and Django</a>
<ul class="sectlevel1">
<li><a href="/book/chapter_01.html">1. Getting Django Set Up Using a <span class="keep-together">Functional Test</span></a>
<ul class="sectlevel2">
<li><a href="/book/chapter_01.html#_obey_the_testing_goat_do_nothing_until_you_have_a_test">1.1. Obey the Testing Goat! Do Nothing Until You Have a Test</a></li>
<li><a href="/book/chapter_01.html#_getting_django_up_and_running">1.2. Getting Django Up and Running</a></li>
<li><a href="/book/chapter_01.html#_starting_a_git_repository">1.3. Starting a Git Repository</a></li>
</ul>
</li>
<li><a href="/book/chapter_02.html">2. Extending Our Functional Test Using the unittest Module</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_02.html#_using_a_functional_test_to_scope_out_a_minimum_viable_app">2.1. Using a Functional Test to Scope Out a Minimum Viable App</a></li>
<li><a href="/book/chapter_02.html#_the_python_standard_library_s_unittest_module">2.2. The Python Standard Library&#8217;s unittest Module</a></li>
<li><a href="/book/chapter_02.html#_implicit_waits">2.3. Implicit waits</a></li>
<li><a href="/book/chapter_02.html#_commit">2.4. Commit</a></li>
</ul>
</li>
<li><a href="/book/chapter_03.html">3. Testing a Simple Home Page with Unit Tests</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_03.html#_our_first_django_app_and_our_first_unit_test">3.1. Our First Django App, and Our First Unit Test</a></li>
<li><a href="/book/chapter_03.html#_unit_tests_and_how_they_differ_from_functional_tests">3.2. Unit Tests, and How They Differ from Functional Tests</a></li>
<li><a href="/book/chapter_03.html#_unit_testing_in_django">3.3. Unit Testing in Django</a></li>
<li><a href="/book/chapter_03.html#_django_s_mvc_urls_and_view_functions">3.4. Django&#8217;s MVC, URLs, and View Functions</a></li>
<li><a href="/book/chapter_03.html#_at_last_we_actually_write_some_application_code">3.5. At Last! We Actually Write Some Application Code!</a></li>
<li><a href="/book/chapter_03.html#_urls_py">3.6. urls.py</a></li>
<li><a href="/book/chapter_03.html#_unit_testing_a_view">3.7. Unit Testing a View</a></li>
</ul>
</li>
<li><a href="/book/chapter_04.html">4. What Are We Doing with All These Tests?</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_04.html#_programming_is_like_pulling_a_bucket_of_water_up_from_a_well">4.1. Programming Is like Pulling a Bucket of Water up from a Well</a></li>
<li><a href="/book/chapter_04.html#_using_selenium_to_test_user_interactions">4.2. Using Selenium to Test User Interactions</a></li>
<li><a href="/book/chapter_04.html#_the_don_t_test_constants_rule_and_templates_to_the_rescue">4.3. The &#8220;Don&#8217;t Test Constants&#8221; Rule, and Templates to the Rescue</a></li>
<li><a href="/book/chapter_04.html#_on_refactoring">4.4. On Refactoring</a></li>
<li><a href="/book/chapter_04.html#_a_little_more_of_our_front_page">4.5. A Little More of Our Front Page</a></li>
<li><a href="/book/chapter_04.html#_recap_the_tdd_process">4.6. Recap: The TDD Process</a></li>
</ul>
</li>
<li><a href="/book/chapter_05.html">5. Saving User Input</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_05.html#_wiring_up_our_form_to_send_a_post_request">5.1. Wiring Up Our Form to Send a POST Request</a></li>
<li><a href="/book/chapter_05.html#_processing_a_post_request_on_the_server">5.2. Processing a POST Request on the Server</a></li>
<li><a href="/book/chapter_05.html#_passing_python_variables_to_be_rendered_in_the_template">5.3. Passing Python Variables to Be Rendered in the Template</a></li>
<li><a href="/book/chapter_05.html#_three_strikes_and_refactor">5.4. Three Strikes and Refactor</a></li>
<li><a href="/book/chapter_05.html#_the_django_orm_and_our_first_model">5.5. The Django ORM and Our First Model</a></li>
<li><a href="/book/chapter_05.html#_saving_the_post_to_the_database">5.6. Saving the POST to the Database</a></li>
<li><a href="/book/chapter_05.html#_redirect_after_a_post">5.7. Redirect After a POST</a></li>
<li><a href="/book/chapter_05.html#_rendering_items_in_the_template">5.8. Rendering Items in the Template</a></li>
<li><a href="/book/chapter_05.html#_creating_our_production_database_with_migrate">5.9. Creating Our Production Database with migrate</a></li>
</ul>
</li>
<li><a href="/book/chapter_06.html">6. Getting to the Minimum Viable Site</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_06.html#_ensuring_test_isolation_in_functional_tests">6.1. Ensuring Test Isolation in Functional Tests</a></li>
<li><a href="/book/chapter_06.html#_small_design_when_necessary">6.2. Small Design When Necessary</a></li>
<li><a href="/book/chapter_06.html#_implementing_the_new_design_using_tdd">6.3. Implementing the New Design Using TDD</a></li>
<li><a href="/book/chapter_06.html#_iterating_towards_the_new_design">6.4. Iterating Towards the New Design</a></li>
<li><a href="/book/chapter_06.html#_testing_views_templates_and_urls_together_with_the_django_test_client">6.5. Testing Views, Templates, and URLs Together with the Django Test Client</a></li>
<li><a href="/book/chapter_06.html#_another_url_and_view_for_adding_list_items">6.6. Another URL and View for Adding List Items</a></li>
<li><a href="/book/chapter_06.html#_adjusting_our_models">6.7. Adjusting Our Models</a></li>
<li><a href="/book/chapter_06.html#_each_list_should_have_its_own_url">6.8. Each List Should Have Its Own URL</a></li>
<li><a href="/book/chapter_06.html#_one_more_view_to_handle_adding_items_to_an_existing_list">6.9. One More View to Handle Adding Items to an Existing List</a></li>
<li><a href="/book/chapter_06.html#_a_final_refactor_using_url_includes">6.10. A Final Refactor Using URL includes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/book/part2.harry.html">Web Development Sine Qua Nons</a>
<ul class="sectlevel1">
<li><a href="/book/chapter_07.html">7. Prettification: Layout and Styling, <span class="keep-together">and What to Test About It</span></a>
<ul class="sectlevel2">
<li><a href="/book/chapter_07.html#_what_to_functionally_test_about_layout_and_style">7.1. What to Functionally Test About Layout and Style</a></li>
<li><a href="/book/chapter_07.html#_prettification_using_a_css_framework">7.2. Prettification: Using a CSS Framework</a></li>
<li><a href="/book/chapter_07.html#_django_template_inheritance">7.3. Django Template Inheritance</a></li>
<li><a href="/book/chapter_07.html#_integrating_bootstrap">7.4. Integrating Bootstrap</a></li>
<li><a href="/book/chapter_07.html#_static_files_in_django">7.5. Static Files in Django</a></li>
<li><a href="/book/chapter_07.html#_using_bootstrap_components_to_improve_the_look_of_the_site">7.6. Using Bootstrap Components to Improve the Look of the Site</a></li>
<li><a href="/book/chapter_07.html#_using_our_own_css">7.7. Using Our Own CSS</a></li>
<li><a href="/book/chapter_07.html#_what_we_glossed_over_collectstatic_and_other_static_directories">7.8. What We Glossed Over: collectstatic and Other Static Directories</a></li>
<li><a href="/book/chapter_13.html#_a_few_things_that_didn_t_make_it">7.9. A Few Things That Didn&#8217;t Make It</a></li>
</ul>
</li>
<li><a href="/book/chapter_08.html">8. Testing Deployment Using a Staging Site</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_08.html#_tdd_and_the_danger_areas_of_deployment">8.1. TDD and the Danger Areas of Deployment</a></li>
<li><a href="/book/chapter_08.html#_as_always_start_with_a_test">8.2. As Always, Start with a Test</a></li>
<li><a href="/book/chapter_08.html#_getting_a_domain_name">8.3. Getting a Domain Name</a></li>
<li><a href="/book/chapter_08.html#_manually_provisioning_a_server_to_host_our_site">8.4. Manually Provisioning a Server to Host Our Site</a></li>
<li><a href="/book/chapter_08.html#_deploying_our_code_manually">8.5. Deploying Our Code Manually</a></li>
<li><a href="/book/chapter_08.html#_getting_to_a_production_ready_deployment">8.6. Getting to a Production-Ready Deployment</a></li>
<li><a href="/book/chapter_08.html#_automating">8.7. Automating</a></li>
</ul>
</li>
<li><a href="/book/chapter_09.html">9. Automating Deployment with Fabric</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_09.html#_breakdown_of_a_fabric_script_for_our_deployment">9.1. Breakdown of a Fabric Script for Our Deployment</a></li>
<li><a href="/book/chapter_09.html#_trying_it_out">9.2. Trying It Out</a></li>
<li><a href="/book/chapter_09.html#_git_tag_the_release">9.3. Git Tag the Release</a></li>
<li><a href="/book/chapter_09.html#_further_reading">9.4. Further Reading</a></li>
</ul>
</li>
<li><a href="/book/chapter_10.html">10. Input Validation and Test Organisation</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_10.html#_validation_ft_preventing_blank_items">10.1. Validation FT: Preventing Blank Items</a></li>
<li><a href="/book/chapter_10.html#_using_model_layer_validation">10.2. Using Model-Layer Validation</a></li>
<li><a href="/book/chapter_10.html#_surfacing_model_validation_errors_in_the_view">10.3. Surfacing Model Validation Errors in the View</a></li>
<li><a href="/book/chapter_10.html#_django_pattern_processing_post_requests_in_the_same_view_as_renders_the_form">10.4. Django Pattern: Processing POST Requests in the Same View as Renders the Form</a></li>
<li><a href="/book/chapter_10.html#_refactor_removing_hardcoded_urls">10.5. Refactor: Removing Hardcoded URLs</a></li>
</ul>
</li>
<li><a href="/book/chapter_11.html">11. A Simple Form</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_11.html#_moving_validation_logic_into_a_form">11.1. Moving Validation Logic into a Form</a></li>
<li><a href="/book/chapter_11.html#_using_the_form_in_our_views">11.2. Using the Form in Our Views</a></li>
<li><a href="/book/chapter_11.html#_using_the_form_in_a_view_that_takes_post_requests">11.3. Using the Form in a View That Takes POST Requests</a></li>
<li><a href="/book/chapter_11.html#_using_the_form_in_the_other_view">11.4. Using the Form in the Other View</a></li>
<li><a href="/book/chapter_11.html#_using_the_form_s_own_save_method">11.5. Using the Form&#8217;s Own Save Method</a></li>
</ul>
</li>
<li><a href="/book/chapter_12.html">12. More Advanced Forms</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_12.html#_another_ft_for_duplicate_items">12.1. Another FT for Duplicate Items</a></li>
<li><a href="/book/chapter_12.html#_experimenting_with_duplicate_item_validation_at_the_views_layer">12.2. Experimenting with Duplicate Item Validation at the Views Layer</a></li>
<li><a href="/book/chapter_12.html#_a_more_complex_form_to_handle_uniqueness_validation">12.3. A More Complex Form to Handle Uniqueness Validation</a></li>
<li><a href="/book/chapter_12.html#_using_the_existing_list_item_form_in_the_list_view">12.4. Using the Existing List Item Form in the List View</a></li>
</ul>
</li>
<li><a href="#_dipping_our_toes_very_tentatively_span_class_keep_together_into_javascript_span">13. Dipping Our Toes, Very Tentatively, <span class="keep-together">into JavaScript</span></a>
<ul class="sectlevel2">
<li><a href="/book/chapter_13.html#_starting_with_an_ft">13.1. Starting with an FT</a></li>
<li><a href="/book/chapter_13.html#_setting_up_a_basic_javascript_test_runner">13.2. Setting Up a Basic JavaScript Test Runner</a></li>
<li><a href="/book/chapter_13.html#_using_jquery_and_the_fixtures_div">13.3. Using jQuery and the Fixtures Div</a></li>
<li><a href="/book/chapter_13.html#_building_a_javascript_unit_test_for_our_desired_functionality">13.4. Building a JavaScript Unit Test for Our Desired Functionality</a></li>
<li><a href="/book/chapter_13.html#_javascript_testing_in_the_tdd_cycle">13.5. Javascript Testing in the TDD Cycle</a></li>
<li><a href="/book/chapter_13.html#_columbo_says_onload_boilerplate_and_namespacing">13.6. Columbo Says: Onload Boilerplate and Namespacing</a></li>
<li><a href="#_a_few_things_that_didn_t_make_it_2">13.7. A Few Things That Didn&#8217;t Make It</a></li>
</ul>
</li>
<li><a href="/book/chapter_14.html">14. Deploying Our New Code</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_14.html#_staging_deploy">14.1. Staging Deploy</a></li>
<li><a href="/book/chapter_14.html#_live_deploy">14.2. Live Deploy</a></li>
<li><a href="/book/chapter_14.html#_what_to_do_if_you_see_a_database_error">14.3. What to Do If You See a Database Error</a></li>
<li><a href="/book/chapter_14.html#_wrap_up_git_tag_the_new_release">14.4. Wrap-Up: git tag the New Release</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/book/part3.harry.html">More Advanced Topics</a>
<ul class="sectlevel1">
<li><a href="/book/chapter_15.html">15. User Authentication, Spiking and De-Spiking</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_15.html#_passwordless_auth">15.1. Passwordless Auth</a></li>
<li><a href="/book/chapter_15.html#_exploratory_coding_aka_spiking">15.2. Exploratory Coding, aka "Spiking"</a></li>
<li><a href="/book/chapter_15.html#_de_spiking">15.3. De-spiking</a></li>
<li><a href="/book/chapter_15.html#_a_minimal_custom_user_model">15.4. A Minimal Custom User Model</a></li>
<li><a href="/book/chapter_15.html#_a_token_model_to_link_emails_with_a_unique_id">15.5. A Token model to link emails with a unique id</a></li>
</ul>
</li>
<li><a href="/book/chapter_16.html">16. Testing external dependencies using mocks</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_16.html#_before_we_start_getting_the_basic_plumbing_in">16.1. Before we start: getting the basic plumbing in</a></li>
<li><a href="/book/chapter_16.html#_mocking_manually_aka_monkey_patching">16.2. Mocking manually, aka monkey-patching</a></li>
<li><a href="/book/chapter_16.html#_the_python_mock_library">16.3. The Python Mock Library</a></li>
<li><a href="/book/chapter_16.html#_de_spiking_our_custom_authentication_backend">16.4. De-spiking Our Custom Authentication Backend</a></li>
<li><a href="/book/chapter_16.html#_using_our_auth_backend_in_the_login_view">16.5. Using our auth backend in the login view</a></li>
<li><a href="/book/chapter_16.html#_the_moment_of_truth_will_the_ft_pass">16.6. The Moment of Truth:  Will the FT Pass?</a></li>
<li><a href="/book/chapter_16.html#_finishing_off_our_ft_testing_logout">16.7. Finishing Off Our FT, Testing Logout</a></li>
<li><a href="/book/chapter_16.html#_old_content_we_might_want_to_re_use">16.8. Old content we might want to re-use</a></li>
</ul>
</li>
<li><a href="/book/chapter_17.html">17. Test Fixtures, Logging, and <span class="keep-together">Server-Side Debugging</span></a>
<ul class="sectlevel2">
<li><a href="/book/chapter_17.html#_skipping_the_login_process_by_pre_creating_a_session">17.1. Skipping the Login Process by Pre-creating a Session</a></li>
<li><a href="/book/chapter_17.html#_the_proof_is_in_the_pudding_using_staging_to_catch_final_bugs">17.2. The Proof Is in the Pudding: Using Staging to Catch Final Bugs</a></li>
<li><a href="/book/chapter_17.html#_managing_the_test_database_on_staging">17.3. Managing the Test Database on Staging</a></li>
<li><a href="/book/chapter_17.html#_baking_in_our_logging_code">17.4. Baking In Our Logging Code</a></li>
<li><a href="/book/chapter_17.html#_wrap_up">17.5. Wrap-Up</a></li>
</ul>
</li>
<li><a href="/book/chapter_18.html">18. Finishing "My Lists": Outside-In TDD</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_18.html#_the_alternative_inside_out">18.1. The Alternative: "Inside Out"</a></li>
<li><a href="/book/chapter_18.html#_why_prefer_outside_in">18.2. Why Prefer "Outside-In"?</a></li>
<li><a href="/book/chapter_18.html#_the_ft_for_my_lists">18.3. The FT for "My Lists"</a></li>
<li><a href="/book/chapter_18.html#_the_outside_layer_presentation_and_templates">18.4. The Outside Layer: Presentation and Templates</a></li>
<li><a href="/book/chapter_18.html#_moving_down_one_layer_to_view_functions_the_controller">18.5. Moving Down One Layer to View Functions (the Controller)</a></li>
<li><a href="/book/chapter_18.html#_another_pass_outside_in">18.6. Another Pass, Outside-In</a></li>
<li><a href="/book/chapter_18.html#_the_next_requirement_from_the_views_layer_new_lists_should_record_owner">18.7. The Next "Requirement" from the Views Layer: New Lists Should Record Owner</a></li>
<li><a href="/book/chapter_18.html#_moving_down_to_the_model_layer">18.8. Moving Down to the Model Layer</a></li>
</ul>
</li>
<li><a href="/book/chapter_19.html">19. Test Isolation, and "Listening to Your Tests"</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_19.html#_revisiting_our_decision_point_the_views_layer_depends_on_unwritten_models_code">19.1. Revisiting Our Decision Point: The Views Layer Depends on Unwritten Models Code</a></li>
<li><a href="/book/chapter_19.html#_a_first_attempt_at_using_mocks_for_isolation">19.2. A First Attempt at Using Mocks for Isolation</a></li>
<li><a href="/book/chapter_19.html#_listen_to_your_tests_ugly_tests_signal_a_need_to_refactor">19.3. Listen to Your Tests: Ugly Tests Signal a Need to Refactor</a></li>
<li><a href="/book/chapter_19.html#_rewriting_our_tests_for_the_view_to_be_fully_isolated">19.4. Rewriting Our Tests for the View to Be Fully Isolated</a></li>
<li><a href="/book/chapter_19.html#_moving_down_to_the_forms_layer">19.5. Moving Down to the Forms Layer</a></li>
<li><a href="/book/chapter_19.html#_finally_moving_down_to_the_models_layer">19.6. Finally, Moving Down to the Models Layer</a></li>
<li><a href="/book/chapter_19.html#_the_moment_of_truth_and_the_risks_of_mocking">19.7. The Moment of Truth (and the Risks of Mocking)</a></li>
<li><a href="/book/chapter_19.html#_thinking_of_interactions_between_layers_as_contracts">19.8. Thinking of Interactions Between Layers as "Contracts"</a></li>
<li><a href="/book/chapter_19.html#_one_more_test">19.9. One More Test</a></li>
<li><a href="/book/chapter_19.html#_tidy_up_what_to_keep_from_our_integrated_test_suite">19.10. Tidy Up: What to Keep from Our Integrated Test Suite</a></li>
<li><a href="/book/chapter_19.html#_conclusions_when_to_write_isolated_versus_integrated_tests">19.11. Conclusions: When to Write Isolated Versus Integrated Tests</a></li>
</ul>
</li>
<li><a href="/book/chapter_20.html">20. Continuous Integration (CI)</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_20.html#_installing_jenkins">20.1. Installing Jenkins</a></li>
<li><a href="/book/chapter_20.html#_setting_up_our_project">20.2. Setting Up Our Project</a></li>
<li><a href="/book/chapter_20.html#_first_build">20.3. First Build!</a></li>
<li><a href="/book/chapter_20.html#_setting_up_a_virtual_display_so_the_fts_can_run_headless">20.4. Setting Up a Virtual Display so the FTs Can Run Headless</a></li>
<li><a href="/book/chapter_20.html#_taking_screenshots">20.5. Taking Screenshots</a></li>
<li><a href="/book/chapter_20.html#_a_common_selenium_problem_race_conditions">20.6. A Common Selenium Problem: Race Conditions</a></li>
<li><a href="/book/chapter_20.html#_running_our_qunit_javascript_tests_in_jenkins_with_phantomjs">20.7. Running Our QUnit JavaScript Tests in Jenkins with PhantomJS</a></li>
<li><a href="/book/chapter_20.html#_more_things_to_do_with_a_ci_server">20.8. More Things to Do with a CI Server</a></li>
</ul>
</li>
<li><a href="/book/chapter_21.html">21. The Token Social Bit, the Page Pattern, and an Exercise for the Reader</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_21.html#_an_ft_with_multiple_users_and_addcleanup">21.1. An FT with Multiple Users, and addCleanup</a></li>
<li><a href="/book/chapter_21.html#_implementing_the_selenium_interact_wait_pattern">21.2. Implementing the Selenium Interact/Wait Pattern</a></li>
<li><a href="/book/chapter_21.html#_the_page_pattern">21.3. The Page Pattern</a></li>
<li><a href="/book/chapter_21.html#_extend_the_ft_to_a_second_user_and_the_my_lists_page">21.4. Extend the FT to a Second User, and the "My Lists" Page</a></li>
<li><a href="/book/chapter_21.html#_an_exercise_for_the_reader">21.5. An Exercise for the Reader</a></li>
</ul>
</li>
<li><a href="/book/chapter_22.html">22. Fast Tests, Slow Tests, and Hot Lava</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_22.html#_thesis_unit_tests_are_superfast_and_good_besides_that">22.1. Thesis: Unit Tests Are Superfast and Good Besides That</a></li>
<li><a href="/book/chapter_22.html#_the_problems_with_pure_unit_tests">22.2. The Problems with "Pure" Unit Tests</a></li>
<li><a href="/book/chapter_22.html#_synthesis_what_do_we_want_from_our_tests_anyway">22.3. Synthesis: What Do We Want from Our Tests, Anyway?</a></li>
<li><a href="/book/chapter_22.html#_architectural_solutions">22.4. Architectural Solutions</a></li>
<li><a href="/book/chapter_22.html#_conclusion">22.5. Conclusion</a></li>
</ul>
</li>
<li><a href="/book/epilogue.html">23. Obey the Testing Goat!</a>
<ul class="sectlevel2">
<li><a href="/book/epilogue.html#_testing_is_hard">23.1. Testing Is Hard</a></li>
<li><a href="/book/epilogue.html#_remember_to_tip_the_bar_staff">23.2. Remember to Tip the Bar Staff</a></li>
<li><a href="/book/epilogue.html#_don_t_be_a_stranger">23.3. Don&#8217;t Be a Stranger!</a></li>
</ul>
</li>
<li><a href="/book/appendix_I_PythonAnywhere.html">Appendix A: PythonAnywhere</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_I_PythonAnywhere.html#_starting_a_virtualenv">A.1. Starting a virtualenv</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_running_firefox_selenium_sessions_with_xvfb">A.2. Running Firefox Selenium Sessions with Xvfb</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_setting_up_django_as_a_pythonanywhere_web_app">A.3. Setting Up Django as a PythonAnywhere Web App</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_cleaning_up_tmp">A.4. Cleaning Up /tmp</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_screenshots">A.5. Screenshots</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_the_deployment_chapter">A.6. The Deployment Chapter</a></li>
</ul>
</li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html">Appendix B: Django Class-Based Views</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_class_based_generic_views">B.1. Class-Based Generic Views</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_the_home_page_as_a_formview">B.2. The Home Page as a FormView</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_using_form_valid_to_customise_a_createview">B.3. Using form_valid to Customise a CreateView</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_a_more_complex_view_to_handle_both_viewing_and_adding_to_a_list">B.4. A More Complex View to Handle Both Viewing and Adding to a List</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_compare_old_and_new">B.5. Compare Old and New</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_best_practices_for_unit_testing_cbgvs">B.6. Best Practices for Unit Testing CBGVs?</a></li>
</ul>
</li>
<li><a href="/book/appendix_III_provisioning_with_ansible.html">Appendix C: Provisioning with Ansible</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_III_provisioning_with_ansible.html#_installing_system_packages_and_nginx">C.1. Installing System Packages and Nginx</a></li>
<li><a href="/book/appendix_III_provisioning_with_ansible.html#_configuring_gunicorn_and_using_handlers_to_restart_services">C.2. Configuring Gunicorn, and Using Handlers to Restart Services</a></li>
<li><a href="/book/appendix_III_provisioning_with_ansible.html#_what_to_do_next">C.3. What to Do Next</a></li>
</ul>
</li>
<li><a href="/book/appendix_IV_testing_migrations.html">Appendix D: Testing Database Migrations</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_IV_testing_migrations.html#_an_attempted_deploy_to_staging">D.1. An Attempted Deploy to Staging</a></li>
<li><a href="/book/appendix_IV_testing_migrations.html#_running_a_test_migration_locally">D.2. Running a Test Migration Locally</a></li>
<li><a href="/book/appendix_IV_testing_migrations.html#_inserting_a_data_migration">D.3. Inserting a Data Migration</a></li>
<li><a href="/book/appendix_IV_testing_migrations.html#_testing_the_new_migrations_together">D.4. Testing the New Migrations Together</a></li>
<li><a href="/book/appendix_IV_testing_migrations.html#_conclusions">D.5. Conclusions</a></li>
</ul>
</li>
<li><a href="/book/appendix_bdd_tools.html">Appendix E: Behaviour-Driven Development (BDD)</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_bdd_tools.html#_what_is_bdd">E.1. What is BDD?</a></li>
<li><a href="/book/appendix_bdd_tools.html#_basic_housekeeping">E.2. Basic Housekeeping</a></li>
<li><a href="/book/appendix_bdd_tools.html#_writing_an_ft_as_a_feature_using_gherkin_syntax">E.3. Writing an FT as a "Feature" using Gherkin Syntax</a></li>
<li><a href="/book/appendix_bdd_tools.html#_coding_the_step_functions">E.4. Coding the Step Functions</a></li>
<li><a href="/book/appendix_bdd_tools.html#_first_step_definition">E.5. First Step Definition</a></li>
<li><a href="/book/appendix_bdd_tools.html#_setup_and_teardown_equivalents_in_environment_py">E.6. setUp and tearDown Equivalents in environment.py</a></li>
<li><a href="/book/appendix_bdd_tools.html#_another_run">E.7. Another Run</a></li>
<li><a href="/book/appendix_bdd_tools.html#_capturing_parameters_in_steps">E.8. Capturing Parameters in Steps</a></li>
<li><a href="/book/appendix_bdd_tools.html#_comparing_the_inline_style_ft">E.9. Comparing the Inline-Style FT</a></li>
<li><a href="/book/appendix_bdd_tools.html#_bdd_encourages_structured_test_code">E.10. BDD Encourages Structured Test Code</a></li>
<li><a href="/book/appendix_bdd_tools.html#_the_page_pattern_as_an_alternative">E.11. The Page Pattern as an Alternative</a></li>
<li><a href="/book/appendix_bdd_tools.html#_bdd_might_be_less_expressive_than_inline_comments">E.12. BDD Might Be Less Expressive than Inline Comments</a></li>
<li><a href="/book/appendix_bdd_tools.html#_will_nonprogrammers_write_tests">E.13. Will Nonprogrammers Write Tests?</a></li>
<li><a href="/book/appendix_bdd_tools.html#_some_tentative_conclusions">E.14. Some Tentative Conclusions</a></li>
</ul>
</li>
<li><a href="/book/appendix_VI_cheat_sheet.html">Appendix F: Cheat Sheet</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_VI_cheat_sheet.html#_initial_project_setup">F.1. Initial Project Setup</a></li>
<li><a href="/book/appendix_VI_cheat_sheet.html#_the_basic_tdd_workflow">F.2. The Basic TDD Workflow</a></li>
<li><a href="/book/appendix_VI_cheat_sheet.html#_moving_beyond_dev_only_testing">F.3. Moving Beyond dev-only Testing</a></li>
<li><a href="/book/appendix_VI_cheat_sheet.html#_general_testing_best_practices">F.4. General Testing Best Practices</a></li>
<li><a href="/book/appendix_VI_cheat_sheet.html#_selenium_functional_testing_best_practices">F.5. Selenium/Functional Testing Best Practices</a></li>
<li><a href="/book/appendix_VI_cheat_sheet.html#_outside_in_test_isolation_versus_integrated_tests_and_mocking">F.6. Outside-In, Test Isolation Versus Integrated Tests, and Mocking</a></li>
</ul>
</li>
<li><a href="/book/appendix_V_what_to_do_next.html">Appendix G: What to Do Next</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_V_what_to_do_next.html#_notifications_both_on_the_site_and_by_email">G.1. Notifications&#8212;&#8203;Both on the Site and by Email</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_switch_to_postgres">G.2. Switch to Postgres</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_run_your_tests_against_different_browsers">G.3. Run Your Tests Against Different Browsers</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_404_and_500_tests">G.4. 404 and 500 Tests</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_the_django_admin_site">G.5. The Django Admin Site</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_write_some_security_tests">G.6. Write Some Security Tests</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_test_for_graceful_degradation">G.7. Test for Graceful Degradation</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_caching_and_performance_testing">G.8. Caching and Performance Testing</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_javascript_mvc_frameworks">G.9. JavaScript MVC Frameworks</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_async_and_websockets">G.10. Async and Websockets</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_switch_to_using_py_test">G.11. Switch to Using py.test</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_check_out_coverage_py">G.12. Check out coverage.py</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_client_side_encryption">G.13. Client-Side Encryption</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_your_suggestion_here">G.14. Your Suggestion Here</a></li>
</ul>
</li>
<li><a href="/book/bibliography.html">Appendix H: Bibliography</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="chapter-5">Saving User Input</h2>
<div class="sectionbody">
<div class="paragraph">
<p>
We want to take the to-do item input from the user and send it to the server,
so that we can save it somehow and display it back to her later.</p>
</div>
<div class="paragraph">
<p>As I started writing this chapter, I immediately skipped to what I thought was
the right design: multiple models for lists and list items, a bunch of
different URLs for adding new lists and items, three new view functions, and about
half a dozen new unit tests for all of the above. But I stopped myself.
Although I was pretty sure I was smart enough to handle all those problems at
once, the point of TDD is to allow you to do one thing at a time, when you
need to.  So I decided to be deliberately short-sighted, and at any given
moment only do what was necessary to get the functional tests a little further.</p>
</div>
<div class="paragraph">
<p>It&#8217;s a demonstration of how TDD can support an iterative style of development&#8212;&#8203;it may not be the quickest route, but you do get there in the end.  There&#8217;s
a neat side benefit, which is that it allows me to introduce new concepts like
models, dealing with POST requests, Django template tags, and so on <em>one at a
time</em> rather than having to dump them on you all at once.</p>
</div>
<div class="paragraph">
<p>None of this says that you <em>shouldn&#8217;t</em> try and think ahead, and be clever.  In
the next chapter we&#8217;ll use a bit more design and up-front thinking, and show
how that fits in with TDD. But for now let&#8217;s plough on mindlessly and just do
what the tests tell us to.</p>
</div>
<div class="sect2">
<h3 id="_wiring_up_our_form_to_send_a_post_request">Wiring Up Our Form to Send a POST Request</h3>
<div class="paragraph">
<p>
At the end of the last chapter, the tests were telling us we weren&#8217;t able to
save the user&#8217;s input. For now, we&#8217;ll use a standard HTML POST request.  A
little boring, but also nice and easy to deliver&#8212;&#8203;we can use all sorts of sexy
HTML5 and JavaScript later in the book.</p>
</div>
<div class="paragraph">
<p>To get our browser to send a POST request, we need to do two things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Give the <code>&lt;input&gt;</code> element a <code>name=</code> attribute</p>
</li>
<li>
<p>Wrap it in a <code>&lt;form&gt;</code> tag with <code>method="POST"</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Let&#8217;s adjust our template at <em>lists/templates/home.html</em>:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/home.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;h1&gt;</span>Your To-Do list<span class="tag">&lt;/h1&gt;</span>
<span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">"</span><span class="content">POST</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">item_text</span><span class="delimiter">"</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">id_new_item</span><span class="delimiter">"</span></span> <span class="attribute-name">placeholder</span>=<span class="string"><span class="delimiter">"</span><span class="content">Enter a to-do item</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/form&gt;</span>

<span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">id_list_table</span><span class="delimiter">"</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, running our FTs gives us a slightly cryptic, unexpected error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 functional_tests.py</strong>
[...]
Traceback (most recent call last):
  File "functional_tests.py", line 39, in
test_can_start_a_list_and_retrieve_it_later
    table = self.browser.find_element_by_id('id_list_table')
[...]
selenium.common.exceptions.NoSuchElementException: Message: Unable to locate
element: {"method":"id","selector":"id_list_table"}</pre>
</div>
</div>
<div class="paragraph">
<p>
When a functional test fails with an unexpected failure, there are several
things we can do to debug them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add <code>print</code> statements, to show, e.g., what the current page text is.</p>
</li>
<li>
<p>Improve the <em>error message</em> to show more info about the current state.</p>
</li>
<li>
<p>Manually visit the site yourself.</p>
</li>
<li>
<p>Use <code>time.sleep</code> to pause the test during execution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>
We&#8217;ll look at all of these over the course of this book, but the <code>time.sleep</code>
option is one I find myself using very often.  Let&#8217;s try it now.  We add
the sleep just before the error occurs:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="comment"># When she hits enter, the page updates, and now the page lists</span>
    <span class="comment"># "1: Buy peacock feathers" as an item in a to-do list table</span>
    inputbox.send_keys(Keys.ENTER)

    <span class="keyword">import</span> <span class="include">time</span>
    time.sleep(<span class="integer">10</span>)
    table = <span class="predefined-constant">self</span>.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_list_table</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending on how fast Selenium runs on your PC, you may have caught a glimpse
of this already, but when we run the functional tests again, we&#8217;ve got time to
see what&#8217;s going on:  you should see a page that looks like
<a href="#csrf_error_screenshot">Django DEBUG page showing CSRF error</a>, with lots of Django debug information.</p>
</div>
<div id="csrf_error_screenshot" class="imageblock">
<div class="content">
<img src="images/twdp_0501.png" alt="Django DEBUG page showing CSRF error">
</div>
<div class="title">Figure 1. Django DEBUG page showing CSRF error</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Security: Surprisingly Fun!</div>
<div class="paragraph">
<p>If you&#8217;ve never heard of a <em>Cross-Site Request Forgery</em> exploit, why not look
it up now? Like all security exploits, it&#8217;s entertaining to read about, being
an ingenious use of a system in unexpected ways&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>When I went back to university to get my Computer Science degree, I signed up
for the Security module out of a sense of duty:  <em>Oh well, it&#8217;ll probably be
very dry and boring, but I suppose I&#8217;d better take it</em>.  It turned out to be
one of the most fascinating modules of the whole course&#8212;&#8203;absolutely full of
the joy of hacking, of the particular mindset it takes to think about how
systems can be used in unintended ways.</p>
</div>
<div class="paragraph">
<p>I want to recommend the textbook for my course, Ross Anderson&#8217;s
<a href="#seceng">Security Engineering</a>. It&#8217;s quite light on pure crypto, but it&#8217;s
absolutely full of interesting discussions of unexpected topics like
lock-picking, forging bank notes, inkjet printer cartridge economics, and
spoofing South African Air Force jets with replay attacks.  It&#8217;s a huge tome,
about three inches thick, and I promise you it&#8217;s an absolute page-turner.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>



Django&#8217;s CSRF protection involves placing a little auto-generated token into
each generated form, to be able to identify POST requests as having come from
the original site.  So far our template has been pure HTML, and in this step we
make the first use of Django&#8217;s template magic. To add the CSRF token we
use a <em>template tag</em>, which has the curly-bracket/percent syntax,
<code>{% ... %}</code>&#8212;famous for being the world&#8217;s most annoying two-key touch-typing
combination:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/home.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">"</span><span class="content">POST</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">item_text</span><span class="delimiter">"</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">id_new_item</span><span class="delimiter">"</span></span> <span class="attribute-name">placeholder</span>=<span class="string"><span class="delimiter">"</span><span class="content">Enter a to-do item</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
    {% csrf_token %}
<span class="tag">&lt;/form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Django will substitute that during rendering with an <code>&lt;input type="hidden"&gt;</code>
containing the CSRF token. Rerunning the functional test will now give us an
expected failure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: False is not true : New to-do item did not appear in table</pre>
</div>
</div>
<div class="paragraph">
<p>Since our <code>time.sleep</code> is still there, the test will pause on the final
screen, showing us that the new item text disappears after the form is
submitted, and the page refreshes to show an empty form again.  That&#8217;s because
we haven&#8217;t wired up our server to deal with the POST request yet&#8212;&#8203;it just
ignores it and displays the normal home page.
</p>
</div>
<div class="paragraph">
<p>We can remove the <code>time.sleep</code> now though:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="comment"># "1: Buy peacock feathers" as an item in a to-do list table</span>
    inputbox.send_keys(Keys.ENTER)

    table = <span class="predefined-constant">self</span>.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_list_table</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processing_a_post_request_on_the_server">Processing a POST Request on the Server</h3>
<div class="paragraph">
<p>
Because we haven&#8217;t specified an <code>action=</code> attribute in the form, it is
submitting back to the same URL it was rendered from by default (i.e., <code>/</code>),
which is dealt with by our <code>home_page</code> function. Let&#8217;s adapt the view to be
able to deal with a POST request.</p>
</div>
<div class="paragraph">
<p>That means a new unit test for the <code>home_page</code> view. Open up <em>lists/tests.py</em>,
and add a new method to <code>HomePageTest</code>. I copied the previous method,
then adapted it to add our POST request and check that the returned
HTML will have the new item text in it:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py (ch05l005)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">test_home_page_returns_correct_html</span>(<span class="predefined-constant">self</span>):
    [...]


<span class="keyword">def</span> <span class="function">test_home_page_can_save_a_POST_request</span>(<span class="predefined-constant">self</span>):
    request = HttpRequest()
    request.method = <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>
    request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>

    response = home_page(request)

    <span class="predefined-constant">self</span>.assertIn(<span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>, response.content.decode())</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Are you wondering about the line spacing in the test? I&#8217;m grouping
      together three lines at the beginning which set up the test, one line in
      the middle which actually calls the function under test, and the
      assertions at the end. This isn&#8217;t obligatory, but it does help see the
      structure of the test. Setup, Exercise, Assert is the typical structure
      for a unit test.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can see that we&#8217;re using a couple of special attributes of the
<code>HttpRequest</code>: <code>.method</code> and <code>.POST</code> (they&#8217;re fairly self-explanatory,
although now might be a good time for a peek at the Django
<a href="https://docs.djangoproject.com/en/1.8/ref/request-response/">request and
response documentation</a>). Then we check that the text from our POST request
ends up in the rendered HTML. That gives us our expected fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test</strong>
[...]
AssertionError: 'A new list item' not found in '&lt;html&gt; [...]</pre>
</div>
</div>
<div class="paragraph">
<p>We can get the test to pass by adding an <code>if</code> and providing a different code
path for POST requests. In typical TDD style, we start with a deliberately
silly return value:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.http</span> <span class="keyword">import</span> <span class="include">HttpResponse</span>
<span class="keyword">from</span> <span class="include">django.shortcuts</span> <span class="keyword">import</span> <span class="include">render</span>

<span class="keyword">def</span> <span class="function">home_page</span>(request):
    <span class="keyword">if</span> request.method == <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>:
        <span class="keyword">return</span> HttpResponse(request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>])
    <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That gets our unit tests passing, but it&#8217;s not really what we want.  What we
really want to do is add the POST submission to the table in the home page
template.</p>
</div>
</div>
<div class="sect2">
<h3 id="_passing_python_variables_to_be_rendered_in_the_template">Passing Python Variables to Be Rendered in the Template</h3>
<div class="paragraph">
<p>
We&#8217;ve already had a hint of it, and now it&#8217;s time to start to get to know the real
power of the Django template syntax, which is to pass variables from our Python
view code into HTML templates.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by seeing how the template syntax lets us include a Python object
in our template. The notation is <code>{{ ... }}</code>, which displays the object as a
string:</p>
</div>
<div class="listingblock sourcecode small-code">
<div class="title">lists/templates/home.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;h1&gt;</span>Your To-Do list<span class="tag">&lt;/h1&gt;</span>
    <span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">"</span><span class="content">POST</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">item_text</span><span class="delimiter">"</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">id_new_item</span><span class="delimiter">"</span></span> <span class="attribute-name">placeholder</span>=<span class="string"><span class="delimiter">"</span><span class="content">Enter a to-do item</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
        {% csrf_token %}
    <span class="tag">&lt;/form&gt;</span>

    <span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">id_list_table</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;tr&gt;</span><span class="tag">&lt;td&gt;</span>{{ new_item_text }}<span class="tag">&lt;/td&gt;</span><span class="tag">&lt;/tr&gt;</span>
    <span class="tag">&lt;/table&gt;</span>
<span class="tag">&lt;/body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>How can we test that our view is passing in the correct value for
<code>new_item_text</code>? How do we pass a variable to a template?  We can find out by
actually doing it in the unit test&#8212;&#8203;we&#8217;ve already used the <code>render_to_string</code>
function in a previous unit test to manually render a template and compare it
with the HTML the view returns.  Now let&#8217;s add the variable we want to pass in:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="predefined-constant">self</span>.assertIn(<span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>, response.content.decode())
    expected_html = render_to_string(
        <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>,
        {<span class="string"><span class="delimiter">'</span><span class="content">new_item_text</span><span class="delimiter">'</span></span>:  <span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>}
    )
    <span class="predefined-constant">self</span>.assertEqual(response.content.decode(), expected_html)</code></pre>
</div>
</div>
<div class="paragraph">
<p>
As you can see, the <code>render_to_string</code> function takes, as its second parameter,
a mapping of variable names to values. We&#8217;re giving the template a variable
named <code>new_item_text</code>, whose value is the expected item text from our
POST request.</p>
</div>
<div class="paragraph">
<p>When we run the unit test, <code>render_to_string</code> will substitute
<code>{{ new_item_text }}</code> for <em>A new list item</em> inside the <code>&lt;td&gt;</code>. That&#8217;s
something the actual view isn&#8217;t doing yet, so we should see a test failure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    self.assertEqual(response.content.decode(), expected_html)
AssertionError: 'A new list item' != '&lt;html&gt;\n    &lt;head&gt;\n [...]</pre>
</div>
</div>
<div class="paragraph">
<p>Good, our deliberately silly return value is now no longer fooling our tests,
so we are allowed to rewrite our view, and tell it to pass the POST
parameter to the template:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py (ch05l009)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">home_page</span>(request):
    <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>, {
        <span class="string"><span class="delimiter">'</span><span class="content">new_item_text</span><span class="delimiter">'</span></span>: request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>],
    })</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running the unit tests again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ERROR: test_home_page_returns_correct_html (lists.tests.HomePageTest)
[...]
    'new_item_text': request.POST['item_text'],
KeyError: 'item_text'</pre>
</div>
</div>
<div class="paragraph">
<p>An <em>unexpected failure</em>.</p>
</div>
<div class="paragraph">
<p>
If you remember the rules for reading tracebacks, you&#8217;ll spot that it&#8217;s
actually a failure in a <em>different</em> test.  We got the actual test we
were working on to pass, but the unit tests have picked up an unexpected
consequence, a regression: we broke the code path where there is no POST
request.</p>
</div>
<div class="paragraph">
<p>This is the whole point of having tests.  Yes, we could have predicted
this would happen, but imagine if we&#8217;d been having a bad day or weren&#8217;t paying
attention: our tests have just saved us from accidentally breaking our
application, and, because we&#8217;re using TDD, we found out immediately.  We didn&#8217;t
have to wait for a QA team, or switch to a web browser and click through our
site manually, and we can get on with fixing it straight away.  Here&#8217;s how:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">home_page</span>(request):
    <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>, {
        <span class="string"><span class="delimiter">'</span><span class="content">new_item_text</span><span class="delimiter">'</span></span>: request.POST.get(<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>),
    })</code></pre>
</div>
</div>
<div class="paragraph">
<p>Look up
<a href="http://docs.python.org/3/library/stdtypes.html#dict.get"><code>dict.get</code></a> if you&#8217;re
not sure what&#8217;s going on there.</p>
</div>
<div class="paragraph">
<p>The unit tests should now pass.  Let&#8217;s see what the functional tests say:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the unit tests don&#8217;t pass for you at this point, and you see an error
    message about a csrf token, it&#8217;s probably because you&#8217;re using the
    wrong version of Django.  The book expects you to be using Django 1.8,
    which is an LTS edition. See the <a href="/book/pre-requisite-installations.html">[pre-requisites]</a> chapter.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: False is not true : New to-do item did not appear in table</pre>
</div>
</div>
<div class="paragraph">
<p>

Hmm, not a wonderfully helpful error.  Let&#8217;s use another of our FT debugging
techniques: improving the error message.  This is probably the most
constructive technique, because those improved error messages stay around to
help debug any future errors:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="predefined-constant">self</span>.assertTrue(
        <span class="predefined">any</span>(row.text == <span class="string"><span class="delimiter">'</span><span class="content">1: Buy peacock feathers</span><span class="delimiter">'</span></span> <span class="keyword">for</span> row <span class="keyword">in</span> rows),
        <span class="string"><span class="delimiter">"</span><span class="content">New to-do item did not appear in table -- its text was:</span><span class="char">\n</span><span class="content">%s</span><span class="delimiter">"</span></span> % (
            table.text,
        )
    )</code></pre>
</div>
</div>
<div class="paragraph">
<p>That gives us a more helpful error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: False is not true : New to-do item did not appear in table --
its text was:
Buy peacock feathers</pre>
</div>
</div>
<div class="paragraph">
<p>You know what could be even better than that?  Making that assertion a bit less
clever.  As you may remember, I was very pleased with myself for using the
<code>any</code> function, but one of my Early Release readers (thanks Jason!) suggested
a much simpler implementation.  We can replace all six lines of the
<code>assertTrue</code> with a single <code>assertIn</code>:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="predefined-constant">self</span>.assertIn(<span class="string"><span class="delimiter">'</span><span class="content">1: Buy peacock feathers</span><span class="delimiter">'</span></span>, [row.text <span class="keyword">for</span> row <span class="keyword">in</span> rows])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Much better.  You should always be very worried whenever you think you&#8217;re being
clever, because what you&#8217;re probably being is <em>overcomplicated</em>. And we get
the error message for free:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    self.assertIn('1: Buy peacock feathers', [row.text for row in rows])
AssertionError: '1: Buy peacock feathers' not found in ['Buy peacock feathers']</pre>
</div>
</div>
<div class="paragraph">
<p>Consider me suitably chastened.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If, instead, your FT seems to be saying the table is empty ("not found in
[]"), check your <code>&lt;input&gt;</code> tag&#8201;&#8212;&#8201;does it have the correct <code>name="item_text"</code>
attribute?  Without it, the user&#8217;s input won&#8217;t be associated with the right
key in <code>request.POST</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The point is that the FT wants us to enumerate list items with a "1:" at the
beginning of the first list item. The fastest way to get that to pass is with a
quick "cheating" change to the template:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/home.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">    <span class="tag">&lt;tr&gt;</span><span class="tag">&lt;td&gt;</span>1: {{ new_item_text }}<span class="tag">&lt;/td&gt;</span><span class="tag">&lt;/tr&gt;</span></code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Red/Green/Refactor and Triangulation</div>
<div class="paragraph">
<p>The unit-test/code cycle is sometimes taught as <em>Red, Green, Refactor</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Start by writing a unit test which fails (<em>Red</em>).</p>
</li>
<li>
<p>Write the simplest possible code to get it to pass (<em>Green</em>), <em>even if
that means cheating</em>.</p>
</li>
<li>
<p><em>Refactor</em> to get to better code that makes more sense.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So what do we do during the Refactor stage?  What justifies moving from
an implementation where we "cheat" to one we&#8217;re happy with?</p>
</div>
<div class="paragraph">
<p>One methodology is <em>eliminate duplication</em>: if your test uses a magic constant
(like the "1:" in front of our list item), and your application code also uses
it, that counts as duplication, so it justifies refactoring. Removing the magic
constant from the application code usually means you have to stop cheating.</p>
</div>
<div class="paragraph">
<p>I find that leaves things a little too vague, so I usually like to
use a second technique, which is called <em>triangulation</em>: if your
tests let you get away with writing "cheating" code that you&#8217;re not happy
with, like returning a magic constant, <em>write another test</em> that forces you to
write some better code.  That&#8217;s what we&#8217;re doing when we extend the FT to
check that we get a "2:" when inputting a <em>second</em> list item.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>



Now we get to the <code>self.fail('Finish the test!')</code>.  If we extend our FT to
check for adding a second item to the table (copy and paste is our friend), we
begin to see that our first cut solution really isn&#8217;t going to, um, cut it:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="comment"># There is still a text box inviting her to add another item. She</span>
    <span class="comment"># enters "Use peacock feathers to make a fly" (Edith is very</span>
    <span class="comment"># methodical)</span>
    inputbox = <span class="predefined-constant">self</span>.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_new_item</span><span class="delimiter">'</span></span>)
    inputbox.send_keys(<span class="string"><span class="delimiter">'</span><span class="content">Use peacock feathers to make a fly</span><span class="delimiter">'</span></span>)
    inputbox.send_keys(Keys.ENTER)

    <span class="comment"># The page updates again, and now shows both items on her list</span>
    table = <span class="predefined-constant">self</span>.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_list_table</span><span class="delimiter">'</span></span>)
    rows = table.find_elements_by_tag_name(<span class="string"><span class="delimiter">'</span><span class="content">tr</span><span class="delimiter">'</span></span>)
    <span class="predefined-constant">self</span>.assertIn(<span class="string"><span class="delimiter">'</span><span class="content">1: Buy peacock feathers</span><span class="delimiter">'</span></span>, [row.text <span class="keyword">for</span> row <span class="keyword">in</span> rows])
    <span class="predefined-constant">self</span>.assertIn(
        <span class="string"><span class="delimiter">'</span><span class="content">2: Use peacock feathers to make a fly</span><span class="delimiter">'</span></span> ,
         [row.text <span class="keyword">for</span> row <span class="keyword">in</span> rows]
    )

    <span class="comment"># Edith wonders whether the site will remember her list. Then she sees</span>
    <span class="comment"># that the site has generated a unique URL for her -- there is some</span>
    <span class="comment"># explanatory text to that effect.</span>
    <span class="predefined-constant">self</span>.fail(<span class="string"><span class="delimiter">'</span><span class="content">Finish the test!</span><span class="delimiter">'</span></span>)

    <span class="comment"># She visits that URL - her to-do list is still there.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sure enough, the functional tests return an error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: '1: Buy peacock feathers' not found in ['1: Use peacock
feathers to make a fly']</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_three_strikes_and_refactor">Three Strikes and Refactor</h3>
<div class="paragraph">
<p>
Before we go further&#8212;&#8203;we&#8217;ve got a bad
<em>code smell</em><sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>
in this FT. We have three
almost identical code blocks checking for new items in the list table. There&#8217;s
a principle called <em>don&#8217;t repeat yourself</em> (DRY), which we like to apply by
following the mantra <em>three strikes and refactor</em>. You can copy and paste code
once, and it may be premature to try and remove the duplication it causes, but
once you get three occurrences, it&#8217;s time to remove duplication.
</p>
</div>
<div class="paragraph">
<p>We start by committing what we have so far. Even though we know our site
has a major flaw&#8212;&#8203;it can only handle one list item&#8212;&#8203;it&#8217;s still further ahead
than it was. We may have to rewrite it all, and we may not, but the rule
is that before you do any refactoring, always do a commit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git diff</strong>
# should show changes to functional_tests.py, home.html,
# tests.py and views.py
$ <strong>git commit -a</strong></pre>
</div>
</div>
<div class="paragraph">
<p>
Back to our functional test refactor: we could use an inline function, but that
upsets the flow of the test slightly. Let&#8217;s use a helper method&#8212;&#8203;remember,
only methods that begin with <code>test_</code> will get run as tests, so you can use
other methods for your own purposes:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">def</span> <span class="function">tearDown</span>(<span class="predefined-constant">self</span>):
        <span class="predefined-constant">self</span>.browser.quit()


    <span class="keyword">def</span> <span class="function">check_for_row_in_list_table</span>(<span class="predefined-constant">self</span>, row_text):
        table = <span class="predefined-constant">self</span>.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_list_table</span><span class="delimiter">'</span></span>)
        rows = table.find_elements_by_tag_name(<span class="string"><span class="delimiter">'</span><span class="content">tr</span><span class="delimiter">'</span></span>)
        <span class="predefined-constant">self</span>.assertIn(row_text, [row.text <span class="keyword">for</span> row <span class="keyword">in</span> rows])


    <span class="keyword">def</span> <span class="function">test_can_start_a_list_and_retrieve_it_later</span>(<span class="predefined-constant">self</span>):
        [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>I like to put helper methods near the top of the class, between the <code>tearDown</code>
and the first test. Let&#8217;s use it in the FT:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="comment"># When she hits enter, the page updates, and now the page lists</span>
    <span class="comment"># "1: Buy peacock feathers" as an item in a to-do list table</span>
    inputbox.send_keys(Keys.ENTER)
    <span class="predefined-constant">self</span>.check_for_row_in_list_table(<span class="string"><span class="delimiter">'</span><span class="content">1: Buy peacock feathers</span><span class="delimiter">'</span></span>)

    <span class="comment"># There is still a text box inviting her to add another item. She</span>
    <span class="comment"># enters "Use peacock feathers to make a fly" (Edith is very</span>
    <span class="comment"># methodical)</span>
    inputbox = <span class="predefined-constant">self</span>.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_new_item</span><span class="delimiter">'</span></span>)
    inputbox.send_keys(<span class="string"><span class="delimiter">'</span><span class="content">Use peacock feathers to make a fly</span><span class="delimiter">'</span></span>)
    inputbox.send_keys(Keys.ENTER)

    <span class="comment"># The page updates again, and now shows both items on her list</span>
    <span class="predefined-constant">self</span>.check_for_row_in_list_table(<span class="string"><span class="delimiter">'</span><span class="content">1: Buy peacock feathers</span><span class="delimiter">'</span></span>)
    <span class="predefined-constant">self</span>.check_for_row_in_list_table(<span class="string"><span class="delimiter">'</span><span class="content">2: Use peacock feathers to make a fly</span><span class="delimiter">'</span></span>)

    <span class="comment"># Edith wonders whether the site will remember her list. Then she sees</span>
    [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>We run the FT again to check that it still behaves in the same way&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: '1: Buy peacock feathers' not found in ['1: Use peacock
feathers to make a fly']</pre>
</div>
</div>
<div class="paragraph">
<p>Good. Now we can commit the FT refactor as its own small, atomic change:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git diff</strong> # check the changes to functional_tests.py
$ <strong>git commit -a</strong></pre>
</div>
</div>
<div class="paragraph">
<p>And back to work.  If we&#8217;re ever going to handle more than one list item,
we&#8217;re going to need some kind of persistence, and databases are a stalwart
solution in this area.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_django_orm_and_our_first_model">The Django ORM and Our First Model</h3>
<div class="paragraph">
<p>

An <em>Object-Relational Mapper</em> (ORM) is a layer of abstraction for data stored in
a database with tables, rows, and columns. It lets us work with databases using
familiar object-oriented metaphors which work well with code.  Classes map to
database tables, attributes map to columns, and an individual instance of the
class represents a row of data in the database.</p>
</div>
<div class="paragraph">
<p>Django comes with an excellent ORM, and writing a unit test that uses it is
actually an excellent way of learning it, since it exercises code by specifying
how we want it to work.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create a new class in <em>lists/tests.py</em>:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">lists.models</span> <span class="keyword">import</span> <span class="include">Item</span>
[...]

<span class="keyword">class</span> <span class="class">ItemModelTest</span>(TestCase):

    <span class="keyword">def</span> <span class="function">test_saving_and_retrieving_items</span>(<span class="predefined-constant">self</span>):
        first_item = Item()
        first_item.text = <span class="string"><span class="delimiter">'</span><span class="content">The first (ever) list item</span><span class="delimiter">'</span></span>
        first_item.save()

        second_item = Item()
        second_item.text = <span class="string"><span class="delimiter">'</span><span class="content">Item the second</span><span class="delimiter">'</span></span>
        second_item.save()

        saved_items = Item.objects.all()
        <span class="predefined-constant">self</span>.assertEqual(saved_items.count(), <span class="integer">2</span>)

        first_saved_item = saved_items[<span class="integer">0</span>]
        second_saved_item = saved_items[<span class="integer">1</span>]
        <span class="predefined-constant">self</span>.assertEqual(first_saved_item.text, <span class="string"><span class="delimiter">'</span><span class="content">The first (ever) list item</span><span class="delimiter">'</span></span>)
        <span class="predefined-constant">self</span>.assertEqual(second_saved_item.text, <span class="string"><span class="delimiter">'</span><span class="content">Item the second</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that creating a new record in the database is a relatively simple
matter of creating an object, assigning some attributes, and calling a
<code>.save()</code> function.  Django also gives us an API for querying the database via
a class attribute, <code>.objects</code>, and we use the simplest possible query,
<code>.all()</code>, which retrieves all the records for that table.  The results are
returned as a list-like object called a <code>QuerySet</code>, from which we can extract
individual objects, and also call further functions, like <code>.count()</code>. We then
check the objects as saved to the database, to check whether the right
information was saved.
</p>
</div>
<div class="paragraph">
<p>Django&#8217;s ORM has many other helpful and intuitive features; this might be a
good time to skim through the
<a href="https://docs.djangoproject.com/en/1.8/intro/tutorial01/">Django
tutorial</a>, which has an excellent intro to them.

</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
I&#8217;ve written this unit test in a very verbose style, as a way of
introducing the Django ORM.  You can actually write a much shorter test for a
model class, which we&#8217;ll see later on, in <a href="/book/chapter_11.html">[simple-form-chapter]</a>.
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Terminology 2: Unit Tests Versus Integrated Tests, and the Database</div>
<div class="paragraph">
<p>Purists will tell you that a "real" unit test should never touch the database,
and that the test I&#8217;ve just written should be more properly called an
integrated test, because it doesn&#8217;t only test our code, but also relies on
an external system, ie a database.</p>
</div>
<div class="paragraph">
<p>It&#8217;s OK to ignore this distinction for now&#8212;&#8203;we have two types of test,
the high-level functional tests which test the application from the user&#8217;s
point of view, and these lower-level tests which test it from the programmer&#8217;s
point of view.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll come back to this and talk about unit tests and integrated tests in
<a href="/book/chapter_19.html">[isolation-chapter]</a>, towards the end of the book.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s try running the unit test. Here comes another unit-test/code cycle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ImportError: cannot import name 'Item'</pre>
</div>
</div>
<div class="paragraph">
<p>Very well, let&#8217;s give it something to import from <em>lists/models.py</em>.  We&#8217;re
feeling confident so we&#8217;ll skip the <code>Item = None</code> step, and go straight to
creating a class:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/models.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.db</span> <span class="keyword">import</span> <span class="include">models</span>

<span class="keyword">class</span> <span class="class">Item</span>(<span class="predefined">object</span>):
    <span class="keyword">pass</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That gets our test as far as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    first_item.save()
AttributeError: 'Item' object has no attribute 'save'</pre>
</div>
</div>
<div class="paragraph">
<p>To give our <code>Item</code> class a <code>save</code> method, and to make it into a real Django
model, we make it inherit from the <code>Model</code> class:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/models.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.db</span> <span class="keyword">import</span> <span class="include">models</span>

<span class="keyword">class</span> <span class="class">Item</span>(models.Model):
    <span class="keyword">pass</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_our_first_database_migration">Our First Database Migration</h4>
<div class="paragraph">
<p>

The next thing that happens is a database error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>django.db.utils.OperationalError: no such table: lists_item</pre>
</div>
</div>
<div class="paragraph">
<p>In Django, the ORM&#8217;s job is to model the database, but there&#8217;s a second
system that&#8217;s in charge of actually building the database called <em>migrations</em>.
Its job is to give you the ability to add and remove tables and columns,
based on changes you make to your <em>models.py</em> files.</p>
</div>
<div class="paragraph">
<p>One way to think of it is as a version control system for your database.
As we&#8217;ll see later, it comes in particularly useful when we need to
upgrade a database that&#8217;s deployed on a live server.</p>
</div>
<div class="paragraph">
<p>For now all we need to know is how to build our first database migration,
which we do using the <code>makemigrations</code> command:
</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py makemigrations</strong>
Migrations for 'lists':
  0001_initial.py:
    - Create model Item
$ <strong>ls lists/migrations</strong>
0001_initial.py  __init__.py  __pycache__</pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;re curious, you can go and take a look in the migrations file,
and you&#8217;ll see it&#8217;s a representation of our additions to <em>models.py</em>.</p>
</div>
<div class="paragraph">
<p>In the meantime, we should find our tests get a little further.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_test_gets_surprisingly_far">The Test Gets Surprisingly Far</h4>
<div class="paragraph">
<p>The test actually gets surprisingly far:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test lists</strong>
[...]
    self.assertEqual(first_saved_item.text, 'The first (ever) list item')
AttributeError: 'Item' object has no attribute 'text'</pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s a full eight lines later than the last failure&#8212;&#8203;we&#8217;ve been all the way
through saving the two Items, we&#8217;ve checked they&#8217;re saved in the database, but
Django just doesn&#8217;t seem to have remembered the <code>.text</code> attribute.</p>
</div>
<div class="paragraph">
<p>Incidentally, if you&#8217;re new to Python, you might have been surprised we were
allowed to assign the <code>.text</code> attribute at all.  In something like Java, that
would probably give you a compilation error.  Python is more relaxed about
things like that.</p>
</div>
<div class="paragraph">
<p>Classes that inherit from <code>models.Model</code> map to tables in the database.  By
default they get an auto-generated <code>id</code> attribute, which will be a primary key
column in the database, but you have to define any other columns you want
explicitly. Here&#8217;s how we set up a text field:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/models.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">Item</span>(models.Model):
    text = models.TextField()</code></pre>
</div>
</div>
<div class="paragraph">
<p>
Django has many other field types, like <code>IntegerField</code>, <code>CharField</code>,
<code>DateField</code>, and so on.  I&#8217;ve chosen <code>TextField</code> rather than <code>CharField</code> because
the latter requires a length restriction, which seems arbitrary at this point.
You can read more on field types in the Django
<a href="http://bit.ly/1slDAGH">tutorial</a>
and in the
<a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/">documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_new_field_means_a_new_migration">A New Field Means a New Migration</h4>
<div class="paragraph">
<p>Running the tests gives us another database error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>django.db.utils.OperationalError: no such column: lists_item.text</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s because we&#8217;ve added another new field to our database, which means we need
to create another migration.  Nice of our tests to let us know!</p>
</div>
<div class="paragraph">
<p>Let&#8217;s try it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py makemigrations</strong>
You are trying to add a non-nullable field 'text' to item without a default; we
can't do that (the database needs something to populate existing rows).
Please select a fix:
 1) Provide a one-off default now (will be set on all existing rows)
 2) Quit, and let me add a default in models.py
Select an option:<strong>2</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Ah.  It won&#8217;t let us add the column without a default value.  Let&#8217;s pick option
2 and set a default in <em>models.py</em>.  I think you&#8217;ll find the syntax reasonably
self-explanatory:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/models.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">Item</span>(models.Model):
    text = models.TextField(default=<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now the migration should complete:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py makemigrations</strong>
Migrations for 'lists':
  0002_item_text.py:
    - Add field text to item</pre>
</div>
</div>
<div class="paragraph">
<p>So, two new lines in <em>models.py</em>, two database migrations, and as a result,
the <code>.text</code> attribute on our model objects is now
recognised as a special attribute, so it does get saved to the database, and
the tests pass&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test lists</strong>
[...]

Ran 4 tests in 0.010s
OK</pre>
</div>
</div>
<div class="paragraph">
<p>



So let&#8217;s do a commit for our first ever model!</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git status</strong> # see tests.py, models.py, and 2 untracked migrations
$ <strong>git diff</strong> # review changes to tests.py and models.py
$ <strong>git add lists</strong>
$ <strong>git commit -m "Model for list Items and associated migration"</strong></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_saving_the_post_to_the_database">Saving the POST to the Database</h3>
<div class="paragraph">
<p>Let&#8217;s adjust the test for our home page POST request, and say we want the view to save a new item to the database instead of just passing it through to its response. We can do that by adding three new lines to the existing test called
<code>test_home_page_can_save_</code> <code>a_POST_request</code>:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">test_home_page_can_save_a_POST_request</span>(<span class="predefined-constant">self</span>):
    request = HttpRequest()
    request.method = <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>
    request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>

    response = home_page(request)

    <span class="predefined-constant">self</span>.assertEqual(Item.objects.count(), <span class="integer">1</span>)  <i class="conum" data-value="1"></i><b>(1)</b>
    new_item = Item.objects.first()  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="predefined-constant">self</span>.assertEqual(new_item.text, <span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>)  <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="predefined-constant">self</span>.assertIn(<span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>, response.content.decode())
    expected_html = render_to_string(
        <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>,
        {<span class="string"><span class="delimiter">'</span><span class="content">new_item_text</span><span class="delimiter">'</span></span>:  <span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>}
    )
    <span class="predefined-constant">self</span>.assertEqual(response.content.decode(), expected_html)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We check that one new <code>Item</code> has been saved to the database.
<code>objects.count()</code> is a shorthand for <code>objects.all().count()</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>objects.first()</code> is the same as doing <code>objects.all()[0]</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We check that the item&#8217;s text is correct.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>
This test is getting a little long-winded.  It seems to be testing lots of
different things.  That&#8217;s another <em>code smell</em>&#8212;a long unit test either needs
to be broken into two, or it may be an indication that the thing you&#8217;re testing
is too complicated.  Let&#8217;s add that to a little to-do list of our own, perhaps
on a piece of scrap paper:</p>
</div>
<div class="sidebarblock scratchpad">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>Code smell: POST test is too long?</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Writing it down on a scratchpad like this reassures us that we won&#8217;t forget, so
we are comfortable getting back to what we were working on.  We rerun the
tests and see an expected failure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    self.assertEqual(Item.objects.count(), 1)
AssertionError: 0 != 1</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s adjust our view:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.shortcuts</span> <span class="keyword">import</span> <span class="include">render</span>
<span class="keyword">from</span> <span class="include">lists.models</span> <span class="keyword">import</span> <span class="include">Item</span>

<span class="keyword">def</span> <span class="function">home_page</span>(request):
    item = Item()
    item.text = request.POST.get(<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>)
    item.save()

    <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>, {
        <span class="string"><span class="delimiter">'</span><span class="content">new_item_text</span><span class="delimiter">'</span></span>: request.POST.get(<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>),
    })</code></pre>
</div>
</div>
<div class="paragraph">
<p>I&#8217;ve coded a very naive solution and you can probably spot a very obvious
problem, which is that we&#8217;re going to be saving empty items with every request
to the home page.  Let&#8217;s add that to our list of things to fix later.  You
know, along with the painfully obvious fact that we currently have no way at
all of having different lists for different people.  That we&#8217;ll keep ignoring
for now.</p>
</div>
<div class="paragraph">
<p>Remember, I&#8217;m not saying you should always ignore glaring problems like this in
"real life". Whenever we spot problems in advance, there&#8217;s a judgement call
to make over whether to stop what you&#8217;re doing and start again, or leave them
until later.  Sometimes finishing off what you&#8217;re doing is still worth it, and
sometimes the problem may be so major as to warrant a stop and rethink.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see how the unit tests get on&#8230;&#8203;they pass!  Good.  We can do a bit of
refactoring:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>, {
        <span class="string"><span class="delimiter">'</span><span class="content">new_item_text</span><span class="delimiter">'</span></span>: item.text
    })</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s have a little look at our scratchpad. I&#8217;ve added a couple of the other
things that are on our mind:</p>
</div>
<div class="sidebarblock scratchpad">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>Don&#8217;t save blank items for every request</em></p>
</li>
<li>
<p><em>Code smell: POST test is too long?</em></p>
</li>
<li>
<p><em>Display multiple items in the table</em></p>
</li>
<li>
<p><em>Support more than one list!</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s start with the first one.  We could tack on an assertion to an existing
test, but it&#8217;s best to keep unit tests to testing one thing at a time, so let&#8217;s
add a new one:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">HomePageTest</span>(TestCase):
    [...]

    <span class="keyword">def</span> <span class="function">test_home_page_only_saves_items_when_necessary</span>(<span class="predefined-constant">self</span>):
        request = HttpRequest()
        home_page(request)
        <span class="predefined-constant">self</span>.assertEqual(Item.objects.count(), <span class="integer">0</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That gives us a <code>1 != 0</code> failure.  Let&#8217;s fix it.  Watch out; although it&#8217;s
quite a small change to the logic of the view, there are quite a few little
tweaks to the implementation in code:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">home_page</span>(request):
    <span class="keyword">if</span> request.method == <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>:
        new_item_text = request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>]  <i class="conum" data-value="1"></i><b>(1)</b>
        Item.objects.create(text=new_item_text)  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">else</span>:
        new_item_text = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>, {
        <span class="string"><span class="delimiter">'</span><span class="content">new_item_text</span><span class="delimiter">'</span></span>: new_item_text,  <i class="conum" data-value="1"></i><b>(1)</b>
    })</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We use a variable called <code>new_item_text</code>, which will either
hold the POST contents, or the empty string.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>.objects.create</code> is a neat shorthand for creating a new <code>Item</code>, without
needing to call <code>.save()</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>
And that gets the test passing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Ran 5 tests in 0.010s

OK</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_redirect_after_a_post">Redirect After a POST</h3>
<div class="paragraph">
<p>

But, yuck, that whole <code>new_item_text = ''</code> dance is making me pretty unhappy.
Thankfully the next item on the list gives us a chance to fix it.
<a href="https://en.wikipedia.org/wiki/Post/Redirect/Get">Always redirect after a POST</a>,
they say, so let&#8217;s do that.  Once again we change our unit test for
saving a POST request to say that, instead of rendering a response with
the item in it, it should redirect back to the home page:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">def</span> <span class="function">test_home_page_can_save_a_POST_request</span>(<span class="predefined-constant">self</span>):
        request = HttpRequest()
        request.method = <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>
        request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>

        response = home_page(request)

        <span class="predefined-constant">self</span>.assertEqual(Item.objects.count(), <span class="integer">1</span>)
        new_item = Item.objects.first()
        <span class="predefined-constant">self</span>.assertEqual(new_item.text, <span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>)

        <span class="predefined-constant">self</span>.assertEqual(response.status_code, <span class="integer">302</span>)
        <span class="predefined-constant">self</span>.assertEqual(response[<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>], <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We no longer expect a response with a <code>.content</code> rendered by a template, so we
lose the assertions that look at that.  Instead, the response will represent
an HTTP <em>redirect</em>, which should have status code 302, and points the browser
towards a new location.</p>
</div>
<div class="paragraph">
<p>That gives us the error <code>200 != 302</code>.  We can now tidy up our view
substantially:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py (ch05l028)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.shortcuts</span> <span class="keyword">import</span> <span class="include">redirect</span>, <span class="include">render</span>
<span class="keyword">from</span> <span class="include">lists.models</span> <span class="keyword">import</span> <span class="include">Item</span>

<span class="keyword">def</span> <span class="function">home_page</span>(request):
    <span class="keyword">if</span> request.method == <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>:
        Item.objects.create(text=request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>])
        <span class="keyword">return</span> redirect(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)

    <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the tests should now pass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Ran 5 tests in 0.010s

OK</pre>
</div>
</div>
<div class="sect3">
<h4 id="_better_unit_testing_practice_each_test_should_test_one_thing">Better Unit Testing Practice: Each Test Should Test One Thing</h4>
<div class="paragraph">
<p>Our view now does a redirect after a POST, which is good practice,
and we&#8217;ve shortened the unit test somewhat, but we can still do better. Good
unit testing practice says that each test should only test one thing. The
reason is that it makes it easier to track down bugs.  Having multiple
assertions in a test means that, if the test fails on an early assertion, you
don&#8217;t know what the status of the later assertions is. As we&#8217;ll see in the next
chapter, if we ever break this view accidentally, we want to know whether it&#8217;s
the saving of objects that&#8217;s broken, or the type of response.</p>
</div>
<div class="paragraph">
<p>You may not always write perfect unit tests with single assertions on your
first go, but now feels like a good time to separate out our concerns:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">def</span> <span class="function">test_home_page_can_save_a_POST_request</span>(<span class="predefined-constant">self</span>):
        request = HttpRequest()
        request.method = <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>
        request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>

        response = home_page(request)

        <span class="predefined-constant">self</span>.assertEqual(Item.objects.count(), <span class="integer">1</span>)
        new_item = Item.objects.first()
        <span class="predefined-constant">self</span>.assertEqual(new_item.text, <span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>)


    <span class="keyword">def</span> <span class="function">test_home_page_redirects_after_POST</span>(<span class="predefined-constant">self</span>):
        request = HttpRequest()
        request.method = <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>
        request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">A new list item</span><span class="delimiter">'</span></span>

        response = home_page(request)

        <span class="predefined-constant">self</span>.assertEqual(response.status_code, <span class="integer">302</span>)
        <span class="predefined-constant">self</span>.assertEqual(response[<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>], <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we should now see six tests pass instead of five:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Ran 6 tests in 0.010s

OK</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rendering_items_in_the_template">Rendering Items in the Template</h3>
<div class="paragraph">
<p>

Much better!  Back to our to-do list:</p>
</div>
<div class="sidebarblock scratchpad">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em><span class="strikethrough line-through">Don&#8217;t save blank items for every request</span></em></p>
</li>
<li>
<p><em><span class="strikethrough line-through">Code smell: POST test is too long?</span></em></p>
</li>
<li>
<p><em>Display multiple items in the table</em></p>
</li>
<li>
<p><em>Support more than one list!</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Crossing things off the list is almost as satisfying as seeing tests pass!</p>
</div>
<div class="paragraph">
<p>The third item is the last of the "easy" ones. Let&#8217;s have a new unit test
that checks that the template can also display multiple list items:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">HomePageTest</span>(TestCase):
    [...]

    <span class="keyword">def</span> <span class="function">test_home_page_displays_all_list_items</span>(<span class="predefined-constant">self</span>):
        Item.objects.create(text=<span class="string"><span class="delimiter">'</span><span class="content">itemey 1</span><span class="delimiter">'</span></span>)
        Item.objects.create(text=<span class="string"><span class="delimiter">'</span><span class="content">itemey 2</span><span class="delimiter">'</span></span>)

        request = HttpRequest()
        response = home_page(request)

        <span class="predefined-constant">self</span>.assertIn(<span class="string"><span class="delimiter">'</span><span class="content">itemey 1</span><span class="delimiter">'</span></span>, response.content.decode())
        <span class="predefined-constant">self</span>.assertIn(<span class="string"><span class="delimiter">'</span><span class="content">itemey 2</span><span class="delimiter">'</span></span>, response.content.decode())</code></pre>
</div>
</div>
<div class="paragraph">
<p>That fails as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: 'itemey 1' not found in '&lt;html&gt;\n    &lt;head&gt;\n [...]</pre>
</div>
</div>
<div class="paragraph">
<p>The Django template syntax has a tag for iterating through lists,
 <code>{% for .. in .. %}</code>; we can use it like this:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/home.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">id_list_table</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    {% for item in items %}
        <span class="tag">&lt;tr&gt;</span><span class="tag">&lt;td&gt;</span>1: {{ item.text }}<span class="tag">&lt;/td&gt;</span><span class="tag">&lt;/tr&gt;</span>
    {% endfor %}
<span class="tag">&lt;/table&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is one of the major strengths of the templating system. Now the template
will render with multiple <code>&lt;tr&gt;</code> rows, one for each item in the variable
<code>items</code>.  Pretty neat!  I&#8217;ll introduce a few more bits of Django template
magic as we go, but at some point you&#8217;ll want to go and read up on the rest of
them in the
<a href="https://docs.djangoproject.com/en/1.8/topics/templates/">Django docs</a>.</p>
</div>
<div class="paragraph">
<p>Just changing the template doesn&#8217;t get our tests to pass; we need to actually
pass the items to it from our home page view:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">home_page</span>(request):
    <span class="keyword">if</span> request.method == <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>:
        Item.objects.create(text=request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>])
        <span class="keyword">return</span> redirect(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)

    items = Item.objects.all()
    <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>, {<span class="string"><span class="delimiter">'</span><span class="content">items</span><span class="delimiter">'</span></span>: items})</code></pre>
</div>
</div>
<div class="paragraph">
<p>That does get the unit tests to pass&#8230;&#8203;moment of truth, will the functional
test pass?</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 functional_tests.py</strong>
[...]
AssertionError: 'To-Do' not found in 'OperationalError at /'</pre>
</div>
</div>
<div class="paragraph">
<p>Oops, apparently not.  Let&#8217;s use another functional test debugging technique,
and it&#8217;s one of the most straightforward: manually visiting the site!  Open
up <em><a href="http://localhost:8000" class="bare">http://localhost:8000</a></em> in your web browser, and you&#8217;ll see a Django debug
page saying "no such table: lists_item", as in <a href="#operationalerror">Another helpful debug message</a>.

</p>
</div>
<div id="operationalerror" class="imageblock">
<div class="content">
<img src="images/twdp_0502.png" alt="OperationalError at / no such table: lists_item">
</div>
<div class="title">Figure 2. Another helpful debug message</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_our_production_database_with_migrate">Creating Our Production Database with migrate</h3>
<div class="paragraph">
<p>

Another helpful error message from Django, which is basically complaining that
we haven&#8217;t set up the database properly.  How come everything worked fine
in the unit tests, I hear you ask?  Because Django creates a special <em>test
database</em> for unit tests; it&#8217;s one of the magical things that Django&#8217;s
<code>TestCase</code> does.</p>
</div>
<div class="paragraph">
<p>To set up our "real" database, we need to create it.  SQLite databases
are just a file on disk, and you&#8217;ll see in <em>settings.py</em> that Django,
by default, will just put it in a file called <em>db.sqlite3</em> in the base
project directory:</p>
</div>
<div class="listingblock sourcecode currentcontents">
<div class="title">superlists/settings.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">[...]
<span class="comment"># Database</span>
<span class="comment"># https://docs.djangoproject.com/en/1.8/ref/settings/#databases</span>

DATABASES = {
    <span class="string"><span class="delimiter">'</span><span class="content">default</span><span class="delimiter">'</span></span>: {
        <span class="string"><span class="delimiter">'</span><span class="content">ENGINE</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">django.db.backends.sqlite3</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">NAME</span><span class="delimiter">'</span></span>: os.path.join(BASE_DIR, <span class="string"><span class="delimiter">'</span><span class="content">db.sqlite3</span><span class="delimiter">'</span></span>),
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ve told Django everything it needs to create the database, first via
<em>models.py</em> and then when we created the migrations file.  To actually apply
it to creating a real database, we use another Django Swiss Army knife
<em>manage.py</em> command, <code>migrate</code>:
</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py migrate</strong>
Operations to perform:
  Synchronize unmigrated apps: messages, staticfiles
  Apply all migrations: contenttypes, lists, admin, auth, sessions
Synchronizing apps without migrations:
  Creating tables...
    Running deferred SQL...
  Installing custom SQL...
Running migrations:
  Rendering model states... DONE
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying lists.0001_initial... OK
  Applying lists.0002_item_text... OK
  Applying sessions.0001_initial... OK</pre>
</div>
</div>
<div class="paragraph">
<p>Now we can refresh the page on <em>localhost</em>, see that our error is gone, and try
running the functional tests
again:<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: '2: Use peacock feathers to make a fly' not found in ['1: Buy
peacock feathers', '1: Use peacock feathers to make a fly']</pre>
</div>
</div>
<div class="paragraph">
<p>So close!  We just need to get our list numbering right.  Another awesome
Django template tag, <code>forloop.counter</code>, will help here:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/home.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">    {% for item in items %}
        <span class="tag">&lt;tr&gt;</span><span class="tag">&lt;td&gt;</span>{{ forloop.counter }}: {{ item.text }}<span class="tag">&lt;/td&gt;</span><span class="tag">&lt;/tr&gt;</span>
    {% endfor %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you try it again, you should now see the FT get to the end:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    self.fail('Finish the test!')
AssertionError: Finish the test!</pre>
</div>
</div>
<div class="paragraph">
<p>But, as it&#8217;s running, you may notice something is amiss, like in
<a href="#items_left_over_from_previous_run">There are list items left over from the last run of the test</a>.</p>
</div>
<div id="items_left_over_from_previous_run" class="imageblock">
<div class="content">
<img src="images/twdp_0503.png" alt="There are list items left over from the last run of the test">
</div>
<div class="title">Figure 3. There are list items left over from the last run of the test</div>
</div>
<div class="paragraph">
<p>Oh dear. It looks like previous runs of the test are leaving stuff lying around
in our database.  In fact, if you run the tests again, you&#8217;ll see it gets
worse:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1: Buy peacock feathers
2: Use peacock feathers to make a fly
3: Buy peacock feathers
4: Use peacock feathers to make a fly
5: Buy peacock feathers
6: Use peacock feathers to make a fly</pre>
</div>
</div>
<div class="paragraph">
<p>

Grrr.  We&#8217;re so close! We&#8217;re going to need some kind of automated way of
tidying up after ourselves. For now, if you feel like it, you can do it
manually, by deleting the database and re-creating it fresh with <code>migrate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>rm db.sqlite3</strong>
$ <strong>python3 manage.py migrate --noinput</strong></pre>
</div>
</div>
<div class="paragraph">
<p>And then reassure yourself that the FT still passes.</p>
</div>
<div class="paragraph">
<p>Apart from that little bug in our functional testing, we&#8217;ve got some code
that&#8217;s more or less working.  Let&#8217;s do a commit.</p>
</div>
<div class="paragraph">
<p>Start by doing a <strong><code>git status</code></strong> and a <strong><code>git diff</code></strong>, and you should see changes
to <em>home.html</em>, <em>tests.py</em>, and <em>views.py</em>. Let&#8217;s add them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git add lists</strong>
$ <strong>git commit -m "Redirect after POST, and show all items in template"</strong></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You might find it useful to add markers for the end of each chapter, like
<strong><code>git tag end-of-chapter-05</code></strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Where are we?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We&#8217;ve got a form set up to add new items to the list using POST.</p>
</li>
<li>
<p>We&#8217;ve set up a simple model in the database to save list items.</p>
</li>
<li>
<p>We&#8217;ve used at least three different FT debugging techniques.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But we&#8217;ve got a couple of items on our own to-do list, namely getting the FT to
clean up after itself, and perhaps more critically, adding support for more
than one list.</p>
</div>
<div class="paragraph">
<p>I mean, we <em>could</em> ship the site as it is, but people might find it
strange that the entire human population has to share a single to-do list.  I
suppose it might get people to stop and think about how connected we all are to
one another, how we all share a common destiny here on Spaceship Earth, and how
we must all work together to solve the global problems that we face.</p>
</div>
<div class="paragraph">
<p>But in practical terms, the site wouldn&#8217;t be very useful.</p>
</div>
<div class="paragraph">
<p>Ah well.
</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Useful TDD Concepts</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Regression</dt>
<dd>
<p>When new code breaks some aspect of the application which used to work.</p>
</dd>
<dt class="hdlist1">Unexpected failure</dt>
<dd>
<p>When a test fails in a way we weren&#8217;t expecting.  This either means that
we&#8217;ve made a mistake in our tests, or that the tests have helped us find
a regression, and we need to fix something in our code.</p>
</dd>
<dt class="hdlist1">Red/Green/Refactor</dt>
<dd>
<p>Another way of describing the TDD process. Write a test and see it fail
(Red), write some code to get it to pass (Green), then Refactor to improve
the implementation.</p>
</dd>
<dt class="hdlist1">Triangulation</dt>
<dd>
<p>Adding a test case with a new specific example for some existing code, to
justify generalising the implementation (which may be a "cheat" until that
point).</p>
</dd>
<dt class="hdlist1">Three strikes and refactor</dt>
<dd>
<p>A rule of thumb for when to remove duplication from code. When two pieces
of code look very similar, it often pays to wait until you see a third
use case, so that you&#8217;re more sure about what part of the code really
is the common, re-usable part to refactor out.</p>
</dd>
<dt class="hdlist1">The scratchpad to-do list</dt>
<dd>
<p>A place to write down things that occur to us as we&#8217;re coding, so that
we can finish up what we&#8217;re doing and come back to them later.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. If you&#8217;ve not come across the concept, a "code smell" is something about a piece of code that makes you want to rewrite it. Jeff Atwood has <a href="http://www.codinghorror.com/blog/2006/05/code-smells.html">a compilation on his blog Coding Horror</a>. The more experience you gain as a programmer, the more fine-tuned your nose becomes to code smells&#8230;&#8203;
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. If you get a different error at this point, try restarting your dev server&#8212;&#8203;it may have gotten confused by the changes to the database happening under its feet.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-08-11 17:26:29 BST
</div>
</div>
<div class="comments" style="padding: 20px">
  <h3>Comments</h3>
  <div id="disqus_thread"></div>

  <script type="text/javascript">
var disqus_shortname = 'obeythetestinggoat';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
  </script>

  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
<html><head><script>   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)   })(window,document,'script','//www.google-analytics.com/analytics.js','ga');    ga('create', 'UA-40928035-1', 'obeythetestinggoat.com');   ga('send', 'pageview');  </script>
</head></html></body>
</html>