<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>Input Validation and Test Organisation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="buy_the_book" style="position: absolute; top: 0; right: 0; z-index:100">
  <a href="/pages/book.html">
    <img src="images/buy_the_book.svg" alt="buy the book ribbon">
  </a>
</div>
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="/book/praise.harry.html">Praise for <em>Test-Driven Development with Python</em></a></li>
<li><a href="/book/preface.html">Preface</a>
<ul class="sectlevel2">
<li><a href="/book/preface.html#_why_i_wrote_a_book_about_test_driven_development">Why I Wrote a Book About Test-Driven Development</a></li>
<li><a href="/book/preface.html#_aims_of_this_book">Aims of This Book</a></li>
<li><a href="/book/preface.html#_outline">Outline</a></li>
<li><a href="/book/preface.html#_conventions_used_in_this_book">Conventions Used in This Book</a></li>
<li><a href="/book/preface.html#_using_code_examples">Using Code Examples</a></li>
<li><a href="/book/preface.html#_safari_books_online">Safari&#174; Books Online</a></li>
<li><a href="/book/preface.html#_contacting_o_reilly">Contacting O&#8217;Reilly</a></li>
</ul>
</li>
<li><a href="/book/pre-requisite-installations.html">Prerequisites and Assumptions</a>
<ul class="sectlevel2">
<li><a href="/book/pre-requisite-installations.html#_python_3_and_programming">Python 3 and Programming</a></li>
<li><a href="/book/pre-requisite-installations.html#_how_html_works">How HTML Works</a></li>
<li><a href="/book/pre-requisite-installations.html#_javascript">JavaScript</a></li>
<li><a href="/book/pre-requisite-installations.html#_required_software_installations">Required Software Installations</a></li>
</ul>
</li>
<li><a href="/book/video_plug.html">Companion Video</a></li>
<li><a href="/book/acknowledgments.html">Acknowledgments</a></li>
<li><a href="/book/part1.harry.html">The Basics of TDD and Django</a>
<ul class="sectlevel1">
<li><a href="/book/chapter_01.html">1. Getting Django Set Up Using a <span class="keep-together">Functional Test</span></a>
<ul class="sectlevel2">
<li><a href="/book/chapter_01.html#_obey_the_testing_goat_do_nothing_until_you_have_a_test">1.1. Obey the Testing Goat! Do Nothing Until You Have a Test</a></li>
<li><a href="/book/chapter_01.html#_getting_django_up_and_running">1.2. Getting Django Up and Running</a></li>
<li><a href="/book/chapter_01.html#_starting_a_git_repository">1.3. Starting a Git Repository</a></li>
</ul>
</li>
<li><a href="/book/chapter_02.html">2. Extending Our Functional Test Using the unittest Module</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_02.html#_using_a_functional_test_to_scope_out_a_minimum_viable_app">2.1. Using a Functional Test to Scope Out a Minimum Viable App</a></li>
<li><a href="/book/chapter_02.html#_the_python_standard_library_s_unittest_module">2.2. The Python Standard Library&#8217;s unittest Module</a></li>
<li><a href="/book/chapter_02.html#_implicit_waits">2.3. Implicit waits</a></li>
<li><a href="/book/chapter_02.html#_commit">2.4. Commit</a></li>
</ul>
</li>
<li><a href="/book/chapter_03.html">3. Testing a Simple Home Page with Unit Tests</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_03.html#_our_first_django_app_and_our_first_unit_test">3.1. Our First Django App, and Our First Unit Test</a></li>
<li><a href="/book/chapter_03.html#_unit_tests_and_how_they_differ_from_functional_tests">3.2. Unit Tests, and How They Differ from Functional Tests</a></li>
<li><a href="/book/chapter_03.html#_unit_testing_in_django">3.3. Unit Testing in Django</a></li>
<li><a href="/book/chapter_03.html#_django_s_mvc_urls_and_view_functions">3.4. Django&#8217;s MVC, URLs, and View Functions</a></li>
<li><a href="/book/chapter_03.html#_at_last_we_actually_write_some_application_code">3.5. At Last! We Actually Write Some Application Code!</a></li>
<li><a href="/book/chapter_03.html#_urls_py">3.6. urls.py</a></li>
<li><a href="/book/chapter_03.html#_unit_testing_a_view">3.7. Unit Testing a View</a></li>
</ul>
</li>
<li><a href="/book/chapter_04.html">4. What Are We Doing with All These Tests?</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_04.html#_programming_is_like_pulling_a_bucket_of_water_up_from_a_well">4.1. Programming Is like Pulling a Bucket of Water up from a Well</a></li>
<li><a href="/book/chapter_04.html#_using_selenium_to_test_user_interactions">4.2. Using Selenium to Test User Interactions</a></li>
<li><a href="/book/chapter_04.html#_the_don_t_test_constants_rule_and_templates_to_the_rescue">4.3. The &#8220;Don&#8217;t Test Constants&#8221; Rule, and Templates to the Rescue</a></li>
<li><a href="/book/chapter_04.html#_on_refactoring">4.4. On Refactoring</a></li>
<li><a href="/book/chapter_04.html#_a_little_more_of_our_front_page">4.5. A Little More of Our Front Page</a></li>
<li><a href="/book/chapter_04.html#_recap_the_tdd_process">4.6. Recap: The TDD Process</a></li>
</ul>
</li>
<li><a href="/book/chapter_05.html">5. Saving User Input</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_05.html#_wiring_up_our_form_to_send_a_post_request">5.1. Wiring Up Our Form to Send a POST Request</a></li>
<li><a href="/book/chapter_05.html#_processing_a_post_request_on_the_server">5.2. Processing a POST Request on the Server</a></li>
<li><a href="/book/chapter_05.html#_passing_python_variables_to_be_rendered_in_the_template">5.3. Passing Python Variables to Be Rendered in the Template</a></li>
<li><a href="/book/chapter_05.html#_three_strikes_and_refactor">5.4. Three Strikes and Refactor</a></li>
<li><a href="/book/chapter_05.html#_the_django_orm_and_our_first_model">5.5. The Django ORM and Our First Model</a></li>
<li><a href="/book/chapter_05.html#_saving_the_post_to_the_database">5.6. Saving the POST to the Database</a></li>
<li><a href="/book/chapter_05.html#_redirect_after_a_post">5.7. Redirect After a POST</a></li>
<li><a href="/book/chapter_05.html#_rendering_items_in_the_template">5.8. Rendering Items in the Template</a></li>
<li><a href="/book/chapter_05.html#_creating_our_production_database_with_migrate">5.9. Creating Our Production Database with migrate</a></li>
</ul>
</li>
<li><a href="/book/chapter_06.html">6. Getting to the Minimum Viable Site</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_06.html#_ensuring_test_isolation_in_functional_tests">6.1. Ensuring Test Isolation in Functional Tests</a></li>
<li><a href="/book/chapter_06.html#_small_design_when_necessary">6.2. Small Design When Necessary</a></li>
<li><a href="/book/chapter_06.html#_implementing_the_new_design_using_tdd">6.3. Implementing the New Design Using TDD</a></li>
<li><a href="/book/chapter_06.html#_iterating_towards_the_new_design">6.4. Iterating Towards the New Design</a></li>
<li><a href="/book/chapter_06.html#_testing_views_templates_and_urls_together_with_the_django_test_client">6.5. Testing Views, Templates, and URLs Together with the Django Test Client</a></li>
<li><a href="/book/chapter_06.html#_another_url_and_view_for_adding_list_items">6.6. Another URL and View for Adding List Items</a></li>
<li><a href="/book/chapter_06.html#_adjusting_our_models">6.7. Adjusting Our Models</a></li>
<li><a href="/book/chapter_06.html#_each_list_should_have_its_own_url">6.8. Each List Should Have Its Own URL</a></li>
<li><a href="/book/chapter_06.html#_one_more_view_to_handle_adding_items_to_an_existing_list">6.9. One More View to Handle Adding Items to an Existing List</a></li>
<li><a href="/book/chapter_06.html#_a_final_refactor_using_url_includes">6.10. A Final Refactor Using URL includes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/book/part2.harry.html">Web Development Sine Qua Nons</a>
<ul class="sectlevel1">
<li><a href="/book/chapter_07.html">7. Prettification: Layout and Styling, <span class="keep-together">and What to Test About It</span></a>
<ul class="sectlevel2">
<li><a href="/book/chapter_07.html#_what_to_functionally_test_about_layout_and_style">7.1. What to Functionally Test About Layout and Style</a></li>
<li><a href="/book/chapter_07.html#_prettification_using_a_css_framework">7.2. Prettification: Using a CSS Framework</a></li>
<li><a href="/book/chapter_07.html#_django_template_inheritance">7.3. Django Template Inheritance</a></li>
<li><a href="/book/chapter_07.html#_integrating_bootstrap">7.4. Integrating Bootstrap</a></li>
<li><a href="/book/chapter_07.html#_static_files_in_django">7.5. Static Files in Django</a></li>
<li><a href="/book/chapter_07.html#_using_bootstrap_components_to_improve_the_look_of_the_site">7.6. Using Bootstrap Components to Improve the Look of the Site</a></li>
<li><a href="/book/chapter_07.html#_using_our_own_css">7.7. Using Our Own CSS</a></li>
<li><a href="/book/chapter_07.html#_what_we_glossed_over_collectstatic_and_other_static_directories">7.8. What We Glossed Over: collectstatic and Other Static Directories</a></li>
<li><a href="/book/chapter_14.html#_a_few_things_that_didn_t_make_it">7.9. A Few Things That Didn&#8217;t Make It</a></li>
</ul>
</li>
<li><a href="/book/chapter_08.html">8. Testing Deployment Using a Staging Site</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_08.html#_tdd_and_the_danger_areas_of_deployment">8.1. TDD and the Danger Areas of Deployment</a></li>
<li><a href="/book/chapter_08.html#_as_always_start_with_a_test">8.2. As Always, Start with a Test</a></li>
<li><a href="/book/chapter_08.html#_getting_a_domain_name">8.3. Getting a Domain Name</a></li>
<li><a href="/book/chapter_08.html#_manually_provisioning_a_server_to_host_our_site">8.4. Manually Provisioning a Server to Host Our Site</a></li>
<li><a href="/book/chapter_08.html#_deploying_our_code_manually">8.5. Deploying Our Code Manually</a></li>
<li><a href="/book/chapter_08.html#_getting_to_a_production_ready_deployment">8.6. Getting to a Production-Ready Deployment</a></li>
<li><a href="/book/chapter_08.html#_automating">8.7. Automating</a></li>
</ul>
</li>
<li><a href="/book/chapter_09.html">9. Automating Deployment with Fabric</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_09.html#_breakdown_of_a_fabric_script_for_our_deployment">9.1. Breakdown of a Fabric Script for Our Deployment</a></li>
<li><a href="/book/chapter_09.html#_trying_it_out">9.2. Trying It Out</a></li>
<li><a href="/book/chapter_09.html#_git_tag_the_release">9.3. Git Tag the Release</a></li>
<li><a href="/book/chapter_09.html#_further_reading">9.4. Further Reading</a></li>
</ul>
</li>
<li><a href="/book/chapter_10.html">10. Input Validation and Test Organisation</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_10.html#_validation_ft_preventing_blank_items">10.1. Validation FT: Preventing Blank Items</a></li>
<li><a href="/book/chapter_10.html#_using_model_layer_validation">10.2. Using Model-Layer Validation</a></li>
<li><a href="/book/chapter_10.html#_surfacing_model_validation_errors_in_the_view">10.3. Surfacing Model Validation Errors in the View</a></li>
<li><a href="/book/chapter_10.html#_django_pattern_processing_post_requests_in_the_same_view_as_renders_the_form">10.4. Django Pattern: Processing POST Requests in the Same View as Renders the Form</a></li>
<li><a href="/book/chapter_10.html#_refactor_removing_hardcoded_urls">10.5. Refactor: Removing Hardcoded URLs</a></li>
</ul>
</li>
<li><a href="/book/chapter_11.html">11. A Simple Form</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_11.html#_moving_validation_logic_into_a_form">11.1. Moving Validation Logic into a Form</a></li>
<li><a href="/book/chapter_11.html#_using_the_form_in_our_views">11.2. Using the Form in Our Views</a></li>
<li><a href="/book/chapter_11.html#_using_the_form_in_a_view_that_takes_post_requests">11.3. Using the Form in a View That Takes POST Requests</a></li>
<li><a href="/book/chapter_11.html#_using_the_form_in_the_other_view">11.4. Using the Form in the Other View</a></li>
<li><a href="/book/chapter_11.html#_using_the_form_s_own_save_method">11.5. Using the Form&#8217;s Own Save Method</a></li>
</ul>
</li>
<li><a href="/book/chapter_12.html">12. More Advanced Forms</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_12.html#_another_ft_for_duplicate_items">12.1. Another FT for Duplicate Items</a></li>
<li><a href="/book/chapter_12.html#_experimenting_with_duplicate_item_validation_at_the_views_layer">12.2. Experimenting with Duplicate Item Validation at the Views Layer</a></li>
<li><a href="/book/chapter_12.html#_a_more_complex_form_to_handle_uniqueness_validation">12.3. A More Complex Form to Handle Uniqueness Validation</a></li>
<li><a href="/book/chapter_12.html#_using_the_existing_list_item_form_in_the_list_view">12.4. Using the Existing List Item Form in the List View</a></li>
</ul>
</li>
<li><a href="/book/chapter_14.html">13. Dipping Our Toes, Very Tentatively, <span class="keep-together">into JavaScript</span></a>
<ul class="sectlevel2">
<li><a href="/book/chapter_14.html#_starting_with_an_ft">13.1. Starting with an FT</a></li>
<li><a href="/book/chapter_14.html#_setting_up_a_basic_javascript_test_runner">13.2. Setting Up a Basic JavaScript Test Runner</a></li>
<li><a href="/book/chapter_14.html#_using_jquery_and_the_fixtures_div">13.3. Using jQuery and the Fixtures Div</a></li>
<li><a href="/book/chapter_14.html#_building_a_javascript_unit_test_for_our_desired_functionality">13.4. Building a JavaScript Unit Test for Our Desired Functionality</a></li>
<li><a href="/book/chapter_14.html#_javascript_testing_in_the_tdd_cycle">13.5. Javascript Testing in the TDD Cycle</a></li>
<li><a href="/book/chapter_14.html#_columbo_says_onload_boilerplate_and_namespacing">13.6. Columbo Says: Onload Boilerplate and Namespacing</a></li>
<li><a href="#_a_few_things_that_didn_t_make_it_2">13.7. A Few Things That Didn&#8217;t Make It</a></li>
</ul>
</li>
<li><a href="/book/chapter_13.html">14. Deploying Our New Code</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_13.html#_staging_deploy">14.1. Staging Deploy</a></li>
<li><a href="/book/chapter_13.html#_live_deploy">14.2. Live Deploy</a></li>
<li><a href="/book/chapter_13.html#_what_to_do_if_you_see_a_database_error">14.3. What to Do If You See a Database Error</a></li>
<li><a href="/book/chapter_13.html#_wrap_up_git_tag_the_new_release">14.4. Wrap-Up: git tag the New Release</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/book/part3.harry.html">More Advanced Topics</a>
<ul class="sectlevel1">
<li><a href="/book/chapter_15.html">15. User Authentication, Spiking and Mocking</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_15.html#_passwordless_auth">15.1. Passwordless Auth</a></li>
<li><a href="/book/chapter_15.html#_exploratory_coding_aka_spiking">15.2. Exploratory Coding, aka "Spiking"</a></li>
<li><a href="/book/chapter_15.html#_de_spiking">15.3. De-spiking</a></li>
<li><a href="/book/chapter_15.html#_a_minimal_custom_user_model">15.4. A Minimal Custom User Model</a></li>
<li><a href="/book/chapter_15.html#_a_token_model_to_link_emails_with_a_unqiue_id">15.5. A Token model to link emails with a unqiue id</a></li>
</ul>
</li>
<li><a href="/book/chapter_16.html">16. Testing external dependencies using mocks</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_16.html#_before_we_start_getting_the_basic_plumbing_in">16.1. Before we start: getting the basic plumbing in</a></li>
<li><a href="/book/chapter_16.html#_mocking_manually_aka_monkey_patching">16.2. Mocking manually, aka monkey-patching</a></li>
<li><a href="/book/chapter_16.html#_the_python_mock_library">16.3. The Python Mock Library</a></li>
<li><a href="/book/chapter_16.html#_de_spiking_our_custom_authentication_backend">16.4. De-spiking Our Custom Authentication Backend</a></li>
<li><a href="/book/chapter_16.html#_using_our_auth_backend_in_the_login_view">16.5. Using our auth backend in the login view</a></li>
<li><a href="/book/chapter_16.html#_the_moment_of_truth_will_the_ft_pass">16.6. The Moment of Truth:  Will the FT Pass?</a></li>
<li><a href="/book/chapter_16.html#_finishing_off_our_ft_testing_logout">16.7. Finishing Off Our FT, Testing Logout</a></li>
<li><a href="/book/chapter_16.html#_old_content_we_might_want_to_re_use">16.8. Old content we might want to re-use</a></li>
</ul>
</li>
<li><a href="/book/chapter_17.html">17. Test Fixtures, Logging, and <span class="keep-together">Server-Side Debugging</span></a>
<ul class="sectlevel2">
<li><a href="/book/chapter_17.html#_skipping_the_login_process_by_pre_creating_a_session">17.1. Skipping the Login Process by Pre-creating a Session</a></li>
<li><a href="/book/chapter_17.html#_the_proof_is_in_the_pudding_using_staging_to_catch_final_bugs">17.2. The Proof Is in the Pudding: Using Staging to Catch Final Bugs</a></li>
<li><a href="/book/chapter_17.html#_managing_the_test_database_on_staging">17.3. Managing the Test Database on Staging</a></li>
<li><a href="/book/chapter_17.html#_baking_in_our_logging_code">17.4. Baking In Our Logging Code</a></li>
<li><a href="/book/chapter_17.html#_wrap_up">17.5. Wrap-Up</a></li>
</ul>
</li>
<li><a href="/book/chapter_18.html">18. Finishing "My Lists": Outside-In TDD</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_18.html#_the_alternative_inside_out">18.1. The Alternative: "Inside Out"</a></li>
<li><a href="/book/chapter_18.html#_why_prefer_outside_in">18.2. Why Prefer "Outside-In"?</a></li>
<li><a href="/book/chapter_18.html#_the_ft_for_my_lists">18.3. The FT for "My Lists"</a></li>
<li><a href="/book/chapter_18.html#_the_outside_layer_presentation_and_templates">18.4. The Outside Layer: Presentation and Templates</a></li>
<li><a href="/book/chapter_18.html#_moving_down_one_layer_to_view_functions_the_controller">18.5. Moving Down One Layer to View Functions (the Controller)</a></li>
<li><a href="/book/chapter_18.html#_another_pass_outside_in">18.6. Another Pass, Outside-In</a></li>
<li><a href="/book/chapter_18.html#_the_next_requirement_from_the_views_layer_new_lists_should_record_owner">18.7. The Next "Requirement" from the Views Layer: New Lists Should Record Owner</a></li>
<li><a href="/book/chapter_18.html#_moving_down_to_the_model_layer">18.8. Moving Down to the Model Layer</a></li>
</ul>
</li>
<li><a href="/book/chapter_19.html">19. Test Isolation, and "Listening to Your Tests"</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_19.html#_revisiting_our_decision_point_the_views_layer_depends_on_unwritten_models_code">19.1. Revisiting Our Decision Point: The Views Layer Depends on Unwritten Models Code</a></li>
<li><a href="/book/chapter_19.html#_a_first_attempt_at_using_mocks_for_isolation">19.2. A First Attempt at Using Mocks for Isolation</a></li>
<li><a href="/book/chapter_19.html#_listen_to_your_tests_ugly_tests_signal_a_need_to_refactor">19.3. Listen to Your Tests: Ugly Tests Signal a Need to Refactor</a></li>
<li><a href="/book/chapter_19.html#_rewriting_our_tests_for_the_view_to_be_fully_isolated">19.4. Rewriting Our Tests for the View to Be Fully Isolated</a></li>
<li><a href="/book/chapter_19.html#_moving_down_to_the_forms_layer">19.5. Moving Down to the Forms Layer</a></li>
<li><a href="/book/chapter_19.html#_finally_moving_down_to_the_models_layer">19.6. Finally, Moving Down to the Models Layer</a></li>
<li><a href="/book/chapter_19.html#_the_moment_of_truth_and_the_risks_of_mocking">19.7. The Moment of Truth (and the Risks of Mocking)</a></li>
<li><a href="/book/chapter_19.html#_thinking_of_interactions_between_layers_as_contracts">19.8. Thinking of Interactions Between Layers as "Contracts"</a></li>
<li><a href="/book/chapter_19.html#_one_more_test">19.9. One More Test</a></li>
<li><a href="/book/chapter_19.html#_tidy_up_what_to_keep_from_our_integrated_test_suite">19.10. Tidy Up: What to Keep from Our Integrated Test Suite</a></li>
<li><a href="/book/chapter_19.html#_conclusions_when_to_write_isolated_versus_integrated_tests">19.11. Conclusions: When to Write Isolated Versus Integrated Tests</a></li>
</ul>
</li>
<li><a href="/book/chapter_20.html">20. Continuous Integration (CI)</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_20.html#_installing_jenkins">20.1. Installing Jenkins</a></li>
<li><a href="/book/chapter_20.html#_setting_up_our_project">20.2. Setting Up Our Project</a></li>
<li><a href="/book/chapter_20.html#_first_build">20.3. First Build!</a></li>
<li><a href="/book/chapter_20.html#_setting_up_a_virtual_display_so_the_fts_can_run_headless">20.4. Setting Up a Virtual Display so the FTs Can Run Headless</a></li>
<li><a href="/book/chapter_20.html#_taking_screenshots">20.5. Taking Screenshots</a></li>
<li><a href="/book/chapter_20.html#_a_common_selenium_problem_race_conditions">20.6. A Common Selenium Problem: Race Conditions</a></li>
<li><a href="/book/chapter_20.html#_running_our_qunit_javascript_tests_in_jenkins_with_phantomjs">20.7. Running Our QUnit JavaScript Tests in Jenkins with PhantomJS</a></li>
<li><a href="/book/chapter_20.html#_more_things_to_do_with_a_ci_server">20.8. More Things to Do with a CI Server</a></li>
</ul>
</li>
<li><a href="/book/chapter_21.html">21. The Token Social Bit, the Page Pattern, and an Exercise for the Reader</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_21.html#_an_ft_with_multiple_users_and_addcleanup">21.1. An FT with Multiple Users, and addCleanup</a></li>
<li><a href="/book/chapter_21.html#_implementing_the_selenium_interact_wait_pattern">21.2. Implementing the Selenium Interact/Wait Pattern</a></li>
<li><a href="/book/chapter_21.html#_the_page_pattern">21.3. The Page Pattern</a></li>
<li><a href="/book/chapter_21.html#_extend_the_ft_to_a_second_user_and_the_my_lists_page">21.4. Extend the FT to a Second User, and the "My Lists" Page</a></li>
<li><a href="/book/chapter_21.html#_an_exercise_for_the_reader">21.5. An Exercise for the Reader</a></li>
</ul>
</li>
<li><a href="/book/chapter_22.html">22. Fast Tests, Slow Tests, and Hot Lava</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_22.html#_thesis_unit_tests_are_superfast_and_good_besides_that">22.1. Thesis: Unit Tests Are Superfast and Good Besides That</a></li>
<li><a href="/book/chapter_22.html#_the_problems_with_pure_unit_tests">22.2. The Problems with "Pure" Unit Tests</a></li>
<li><a href="/book/chapter_22.html#_synthesis_what_do_we_want_from_our_tests_anyway">22.3. Synthesis: What Do We Want from Our Tests, Anyway?</a></li>
<li><a href="/book/chapter_22.html#_architectural_solutions">22.4. Architectural Solutions</a></li>
<li><a href="/book/chapter_22.html#_conclusion">22.5. Conclusion</a></li>
</ul>
</li>
<li><a href="/book/epilogue.html">23. Obey the Testing Goat!</a>
<ul class="sectlevel2">
<li><a href="/book/epilogue.html#_testing_is_hard">23.1. Testing Is Hard</a></li>
<li><a href="/book/epilogue.html#_remember_to_tip_the_bar_staff">23.2. Remember to Tip the Bar Staff</a></li>
<li><a href="/book/epilogue.html#_don_t_be_a_stranger">23.3. Don&#8217;t Be a Stranger!</a></li>
</ul>
</li>
<li><a href="/book/appendix_I_PythonAnywhere.html">Appendix A: PythonAnywhere</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_I_PythonAnywhere.html#_starting_a_virtualenv">A.1. Starting a virtualenv</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_running_firefox_selenium_sessions_with_xvfb">A.2. Running Firefox Selenium Sessions with Xvfb</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_setting_up_django_as_a_pythonanywhere_web_app">A.3. Setting Up Django as a PythonAnywhere Web App</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_cleaning_up_tmp">A.4. Cleaning Up /tmp</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_screenshots">A.5. Screenshots</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_the_deployment_chapter">A.6. The Deployment Chapter</a></li>
</ul>
</li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html">Appendix B: Django Class-Based Views</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_class_based_generic_views">B.1. Class-Based Generic Views</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_the_home_page_as_a_formview">B.2. The Home Page as a FormView</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_using_form_valid_to_customise_a_createview">B.3. Using form_valid to Customise a CreateView</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_a_more_complex_view_to_handle_both_viewing_and_adding_to_a_list">B.4. A More Complex View to Handle Both Viewing and Adding to a List</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_compare_old_and_new">B.5. Compare Old and New</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_best_practices_for_unit_testing_cbgvs">B.6. Best Practices for Unit Testing CBGVs?</a></li>
</ul>
</li>
<li><a href="/book/appendix_III_provisioning_with_ansible.html">Appendix C: Provisioning with Ansible</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_III_provisioning_with_ansible.html#_installing_system_packages_and_nginx">C.1. Installing System Packages and Nginx</a></li>
<li><a href="/book/appendix_III_provisioning_with_ansible.html#_configuring_gunicorn_and_using_handlers_to_restart_services">C.2. Configuring Gunicorn, and Using Handlers to Restart Services</a></li>
<li><a href="/book/appendix_III_provisioning_with_ansible.html#_what_to_do_next">C.3. What to Do Next</a></li>
</ul>
</li>
<li><a href="/book/appendix_IV_testing_migrations.html">Appendix D: Testing Database Migrations</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_IV_testing_migrations.html#_an_attempted_deploy_to_staging">D.1. An Attempted Deploy to Staging</a></li>
<li><a href="/book/appendix_IV_testing_migrations.html#_running_a_test_migration_locally">D.2. Running a Test Migration Locally</a></li>
<li><a href="/book/appendix_IV_testing_migrations.html#_inserting_a_data_migration">D.3. Inserting a Data Migration</a></li>
<li><a href="/book/appendix_IV_testing_migrations.html#_testing_the_new_migrations_together">D.4. Testing the New Migrations Together</a></li>
<li><a href="/book/appendix_IV_testing_migrations.html#_conclusions">D.5. Conclusions</a></li>
</ul>
</li>
<li><a href="/book/appendix_bdd_tools.html">Appendix E: Behaviour-Driven Development (BDD)</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_bdd_tools.html#_what_is_bdd">E.1. What is BDD?</a></li>
<li><a href="/book/appendix_bdd_tools.html#_basic_housekeeping">E.2. Basic Housekeeping</a></li>
<li><a href="/book/appendix_bdd_tools.html#_writing_an_ft_as_a_feature_using_gherkin_syntax">E.3. Writing an FT as a "Feature" using Gherkin Syntax</a></li>
<li><a href="/book/appendix_bdd_tools.html#_coding_the_step_functions">E.4. Coding the Step Functions</a></li>
<li><a href="/book/appendix_bdd_tools.html#_first_step_definition">E.5. First Step Definition</a></li>
<li><a href="/book/appendix_bdd_tools.html#_setup_and_teardown_equivalents_in_environment_py">E.6. setUp and tearDown Equivalents in environment.py</a></li>
<li><a href="/book/appendix_bdd_tools.html#_another_run">E.7. Another Run</a></li>
<li><a href="/book/appendix_bdd_tools.html#_capturing_parameters_in_steps">E.8. Capturing Parameters in Steps</a></li>
<li><a href="/book/appendix_bdd_tools.html#_comparing_the_inline_style_ft">E.9. Comparing the Inline-Style FT</a></li>
<li><a href="/book/appendix_bdd_tools.html#_bdd_encourages_structured_test_code">E.10. BDD Encourages Structured Test Code</a></li>
<li><a href="/book/appendix_bdd_tools.html#_the_page_pattern_as_an_alternative">E.11. The Page Pattern as an Alternative</a></li>
<li><a href="/book/appendix_bdd_tools.html#_bdd_might_be_less_expressive_than_inline_comments">E.12. BDD Might Be Less Expressive than Inline Comments</a></li>
<li><a href="/book/appendix_bdd_tools.html#_will_nonprogrammers_write_tests">E.13. Will Nonprogrammers Write Tests?</a></li>
<li><a href="/book/appendix_bdd_tools.html#_some_tentative_conclusions">E.14. Some Tentative Conclusions</a></li>
</ul>
</li>
<li><a href="/book/appendix_VI_cheat_sheet.html">Appendix F: Cheat Sheet</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_VI_cheat_sheet.html#_initial_project_setup">F.1. Initial Project Setup</a></li>
<li><a href="/book/appendix_VI_cheat_sheet.html#_the_basic_tdd_workflow">F.2. The Basic TDD Workflow</a></li>
<li><a href="/book/appendix_VI_cheat_sheet.html#_moving_beyond_dev_only_testing">F.3. Moving Beyond dev-only Testing</a></li>
<li><a href="/book/appendix_VI_cheat_sheet.html#_general_testing_best_practices">F.4. General Testing Best Practices</a></li>
<li><a href="/book/appendix_VI_cheat_sheet.html#_selenium_functional_testing_best_practices">F.5. Selenium/Functional Testing Best Practices</a></li>
<li><a href="/book/appendix_VI_cheat_sheet.html#_outside_in_test_isolation_versus_integrated_tests_and_mocking">F.6. Outside-In, Test Isolation Versus Integrated Tests, and Mocking</a></li>
</ul>
</li>
<li><a href="/book/appendix_V_what_to_do_next.html">Appendix G: What to Do Next</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_V_what_to_do_next.html#_notifications_both_on_the_site_and_by_email">G.1. Notifications&#8212;&#8203;Both on the Site and by Email</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_switch_to_postgres">G.2. Switch to Postgres</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_run_your_tests_against_different_browsers">G.3. Run Your Tests Against Different Browsers</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_404_and_500_tests">G.4. 404 and 500 Tests</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_the_django_admin_site">G.5. The Django Admin Site</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_write_some_security_tests">G.6. Write Some Security Tests</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_test_for_graceful_degradation">G.7. Test for Graceful Degradation</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_caching_and_performance_testing">G.8. Caching and Performance Testing</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_javascript_mvc_frameworks">G.9. JavaScript MVC Frameworks</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_async_and_websockets">G.10. Async and Websockets</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_switch_to_using_py_test">G.11. Switch to Using py.test</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_check_out_coverage_py">G.12. Check out coverage.py</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_client_side_encryption">G.13. Client-Side Encryption</a></li>
<li><a href="/book/appendix_V_what_to_do_next.html#_your_suggestion_here">G.14. Your Suggestion Here</a></li>
</ul>
</li>
<li><a href="/book/bibliography.html">Appendix H: Bibliography</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="manual-validation-chapter">Input Validation and Test Organisation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Over the next few chapters we&#8217;ll talk about testing and implementing validation
of user inputs. We&#8217;ll also take the opportunity to do a little tidying up&#8212;&#8203;both
in our application code, and also in our tests.</p>
</div>
<div class="sect2">
<h3 id="_validation_ft_preventing_blank_items">Validation FT: Preventing Blank Items</h3>
<div class="paragraph">
<p>
As our first few users start using the site, we&#8217;ve noticed they sometimes make
mistakes that mess up their lists, like accidentally submitting blank list
items, or accidentally inputting two identical items to a list.  Computers are
meant to help stop us from making silly mistakes, so let&#8217;s see if we can get
our site to help.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the outline of an FT:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests/tests.py (ch10l001)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">test_cannot_add_empty_list_items</span>(<span class="predefined-constant">self</span>):
    <span class="comment"># Edith goes to the home page and accidentally tries to submit</span>
    <span class="comment"># an empty list item. She hits Enter on the empty input box</span>

    <span class="comment"># The home page refreshes, and there is an error message saying</span>
    <span class="comment"># that list items cannot be blank</span>

    <span class="comment"># She tries again with some text for the item, which now works</span>

    <span class="comment"># Perversely, she now decides to submit a second blank list item</span>

    <span class="comment"># She receives a similar warning on the list page</span>

    <span class="comment"># And she can correct it by filling some text in</span>
    <span class="predefined-constant">self</span>.fail(<span class="string"><span class="delimiter">'</span><span class="content">write me!</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all very well, but before we go any further&#8212;&#8203;our functional tests
file is beginning to get a little crowded.  Let&#8217;s split it out into several
files, in which each has a single test method.</p>
</div>
<div class="paragraph">
<p>
Remember that functional tests are closely linked to "user stories". If you
were using some sort of project management tool like an issue tracker, you
might make it so that each file matched one issue or ticket, and its filename
contained the ticket ID.  Or, if you prefer to think about things in terms of
"features", where one feature may have several user stories, then you might
have one file and class for the feature, and several methods for each of its
user stories.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll also have one base test class which they can all inherit from.  Here&#8217;s
how to get there step by step.</p>
</div>
<div class="sect3">
<h4 id="_skipping_a_test">Skipping a Test</h4>
<div class="paragraph">
<p>

It&#8217;s always nice, when doing refactoring, to have a fully passing test suite.
We&#8217;ve just written a test with a deliberate failure. Let&#8217;s temporarily switch
it off, using a decorator called "skip" from <code>unittest</code>:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests/tests.py (ch10l001-1)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">unittest</span> <span class="keyword">import</span> <span class="include">skip</span>
[...]

    <span class="decorator">@skip</span>
    <span class="keyword">def</span> <span class="function">test_cannot_add_empty_list_items</span>(<span class="predefined-constant">self</span>):</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tells the test runner to ignore this test.  You can see it works&#8212;&#8203;if we rerun the tests, it&#8217;ll say it passes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test functional_tests</strong>
[...]
Ran 3 tests in 11.577s
OK</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Skips are dangerous&#8212;&#8203;you need to remember to remove them
before you commit your changes back to the repo.  This is why line-by-line
reviews of each of your diffs are a good idea!
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Don&#8217;t Forget the "Refactor" in "Red, Green, Refactor"</div>
<div class="paragraph">
<p>

A criticism that&#8217;s sometimes levelled at TDD is that it leads to badly
architected code, as the developer just focuses on getting tests to pass
rather than stopping to think about how the whole system should be designed.
I think it&#8217;s slightly unfair.</p>
</div>
<div class="paragraph">
<p><em>TDD is no silver bullet</em>. You still have to spend time thinking about good
design.  But what often happens is that people forget the "Refactor" in "Red,
Green, Refactor". The methodology allows you to throw together any old code to
get your tests to pass, but it <em>also</em> asks you to then spend some time
refactoring it to improve its design.</p>
</div>
<div class="paragraph">
<p>Often, however, the best ideas for how to refactor code don&#8217;t occur to you
straight away. They may occur to you days, weeks, even months after you
wrote a piece of code, when you&#8217;re working on something totally unrelated
and you happen to see some old code again with fresh eyes. But if you&#8217;re
halfway through something else, should you stop to refactor the old code?</p>
</div>
<div class="paragraph">
<p>The answer is that it depends.  In the case at the beginning of the chapter,
we haven&#8217;t even started writing our new code. We know we are in a working
state, so we can justify putting a skip on our new FT (to get back to fully
passing tests) and do a bit of refactoring straight away.</p>
</div>
<div class="paragraph">
<p>Later in the chapter we&#8217;ll spot other bits of code we want to alter.
In those cases, rather than taking the risk of refactoring an application
that&#8217;s not in a working state, we&#8217;ll make a note of the thing we want to
change on our scratchpad and wait until we&#8217;re back to a fully passing test
suite before refactoring.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_splitting_functional_tests_out_into_many_files">Splitting Functional Tests out into Many Files</h4>
<div class="paragraph">
<p>
We start putting each test into its own class, still in the same file:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests/tests.py (ch10l002)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">FunctionalTest</span>(StaticLiveServerTestCase):

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">setUpClass</span>(cls):
        [...]
    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">tearDownClass</span>(cls):
        [...]
    <span class="keyword">def</span> <span class="function">setUp</span>(<span class="predefined-constant">self</span>):
        [...]
    <span class="keyword">def</span> <span class="function">tearDown</span>(<span class="predefined-constant">self</span>):
        [...]
    <span class="keyword">def</span> <span class="function">check_for_row_in_list_table</span>(<span class="predefined-constant">self</span>, row_text):
        [...]


<span class="keyword">class</span> <span class="class">NewVisitorTest</span>(FunctionalTest):

    <span class="keyword">def</span> <span class="function">test_can_start_a_list_and_retrieve_it_later</span>(<span class="predefined-constant">self</span>):
        [...]



<span class="keyword">class</span> <span class="class">LayoutAndStylingTest</span>(FunctionalTest):

    <span class="keyword">def</span> <span class="function">test_layout_and_styling</span>(<span class="predefined-constant">self</span>):
        [...]



<span class="keyword">class</span> <span class="class">ItemValidationTest</span>(FunctionalTest):

    <span class="decorator">@skip</span>
    <span class="keyword">def</span> <span class="function">test_cannot_add_empty_list_items</span>(<span class="predefined-constant">self</span>):
        [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point we can rerun the FTs and see they all still work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Ran 3 tests in 11.577s

OK</pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s labouring it a little bit, and we could probably get away doing this
stuff in fewer steps, but, as I keep saying, practising the step-by-step method
on the easy cases makes it that much easier when we have a complex case.</p>
</div>
<div class="paragraph">
<p>Now we switch from a single tests file to using one for each class, and one
"base" file to contain the base class all the tests will inherit from.  We&#8217;ll
make four copies of <em>tests.py</em>, naming them appropriately, and then delete the
parts we don&#8217;t need from each:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git mv functional_tests/tests.py functional_tests/base.py</strong>
$ <strong>cp functional_tests/base.py functional_tests/test_simple_list_creation.py</strong>
$ <strong>cp functional_tests/base.py functional_tests/test_layout_and_styling.py</strong>
$ <strong>cp functional_tests/base.py functional_tests/test_list_item_validation.py</strong></pre>
</div>
</div>
<div class="paragraph">
<p>
<em>base.py</em> can be cut down to just the <code>FunctionalTest</code> class.  We leave the
helper method on the base class, because we suspect we&#8217;re about to reuse
it in our new FT:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests/base.py (ch10l003)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.contrib.staticfiles.testing</span> <span class="keyword">import</span> <span class="include">StaticLiveServerTestCase</span>
<span class="keyword">from</span> <span class="include">selenium</span> <span class="keyword">import</span> <span class="include">webdriver</span>
<span class="keyword">import</span> <span class="include">sys</span>

<span class="keyword">class</span> <span class="class">FunctionalTest</span>(StaticLiveServerTestCase):

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">setUpClass</span>(cls):
        [...]
    <span class="keyword">def</span> <span class="function">tearDownClass</span>(cls):
        [...]
    <span class="keyword">def</span> <span class="function">setUp</span>(<span class="predefined-constant">self</span>):
        [...]
    <span class="keyword">def</span> <span class="function">tearDown</span>(<span class="predefined-constant">self</span>):
        [...]
    <span class="keyword">def</span> <span class="function">check_for_row_in_list_table</span>(<span class="predefined-constant">self</span>, row_text):
        [...]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Keeping helper methods in a base <code>FunctionalTest</code> class is one useful way
of preventing duplication in FTs.  Later in the book (in
<a href="/book/chapter_21.html">[page-pattern-chapter]</a>) we&#8217;ll use the "Page pattern", which is related, but
prefers composition over inheritance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Our first FT is now in its own file, and should be just one class and one test
method:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests/test_simple_list_creation.py (ch10l004)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> .base <span class="keyword">import</span> <span class="include">FunctionalTest</span>
<span class="keyword">from</span> <span class="include">selenium</span> <span class="keyword">import</span> <span class="include">webdriver</span>
<span class="keyword">from</span> <span class="include">selenium.webdriver.common.keys</span> <span class="keyword">import</span> <span class="include">Keys</span>

<span class="keyword">class</span> <span class="class">NewVisitorTest</span>(FunctionalTest):

    <span class="keyword">def</span> <span class="function">test_can_start_a_list_and_retrieve_it_later</span>(<span class="predefined-constant">self</span>):
        [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>
I used a relative import (<code>from .base</code>). Some people like to use them a lot
in Django code (e.g., your views might import models using <code>from .models import
List</code>, instead of <code>from list.models</code>). Ultimately this is a
matter of personal preference.  I prefer to use relative imports only when I&#8217;m
super-super sure that the relative position of the thing I&#8217;m importing won&#8217;t
change.  That applies in this case because I know for sure all the tests will
sit next to <em>base.py</em>, which they inherit from.</p>
</div>
<div class="paragraph">
<p>

The layout and styling FT should now be one file and one class:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests/test_layout_and_styling.py (ch10l005)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> .base <span class="keyword">import</span> <span class="include">FunctionalTest</span>

<span class="keyword">class</span> <span class="class">LayoutAndStylingTest</span>(FunctionalTest):
        [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly our new validation test is in a file of its own too:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests/test_list_item_validation.py (ch10l006)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">unittest</span> <span class="keyword">import</span> <span class="include">skip</span>
<span class="keyword">from</span> .base <span class="keyword">import</span> <span class="include">FunctionalTest</span>

<span class="keyword">class</span> <span class="class">ItemValidationTest</span>(FunctionalTest):

    <span class="decorator">@skip</span>
    <span class="keyword">def</span> <span class="function">test_cannot_add_empty_list_items</span>(<span class="predefined-constant">self</span>):
        [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we can test everything worked by rerunning <code>manage.py test
functional_tests</code>, and checking once again that all three tests are run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Ran 3 tests in 11.577s

OK</pre>
</div>
</div>
<div class="paragraph">
<p>Now we can remove our skip:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests/test_list_item_validation.py (ch10l007)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">ItemValidationTest</span>(FunctionalTest):

    <span class="keyword">def</span> <span class="function">test_cannot_add_empty_list_items</span>(<span class="predefined-constant">self</span>):
        [...]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_a_single_test_file">Running a Single Test File</h4>
<div class="paragraph">
<p>As a side bonus, we&#8217;re now able to run an individual test file, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test functional_tests.test_list_item_validation</strong>
[...]
AssertionError: write me!</pre>
</div>
</div>
<div class="paragraph">
<p>Brilliant, no need to sit around waiting for all the FTs when we&#8217;re only
interested in a single one. Although we need to remember to run all of them
now and again, to check for regressions.  Later in the book we&#8217;ll see how
to give that task over to an automated Continuous Integration loop. For now
let&#8217;s commit!</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git status</strong>
$ <strong>git add functional_tests</strong>
$ <strong>git commit -m "Moved Fts into their own individual files"</strong></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fleshing_out_the_ft">Fleshing Out the FT</h4>
<div class="paragraph">
<p>Now let&#8217;s start implementing the test, or at least the beginning of it:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">functional_tests/test_list_item_validation.py (ch10l008)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">test_cannot_add_empty_list_items</span>(<span class="predefined-constant">self</span>):
    <span class="comment"># Edith goes to the home page and accidentally tries to submit</span>
    <span class="comment"># an empty list item. She hits Enter on the empty input box</span>
    <span class="predefined-constant">self</span>.browser.get(<span class="predefined-constant">self</span>.server_url)
    <span class="predefined-constant">self</span>.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_new_item</span><span class="delimiter">'</span></span>).send_keys(<span class="string"><span class="delimiter">'</span><span class="char">\n</span><span class="delimiter">'</span></span>)

    <span class="comment"># The home page refreshes, and there is an error message saying</span>
    <span class="comment"># that list items cannot be blank</span>
    error = <span class="predefined-constant">self</span>.browser.find_element_by_css_selector(<span class="string"><span class="delimiter">'</span><span class="content">.has-error</span><span class="delimiter">'</span></span>)  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-constant">self</span>.assertEqual(error.text, <span class="string"><span class="delimiter">"</span><span class="content">You can't have an empty list item</span><span class="delimiter">"</span></span>)

    <span class="comment"># She tries again with some text for the item, which now works</span>
    <span class="predefined-constant">self</span>.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_new_item</span><span class="delimiter">'</span></span>).send_keys(<span class="string"><span class="delimiter">'</span><span class="content">Buy milk</span><span class="char">\n</span><span class="delimiter">'</span></span>)
    <span class="predefined-constant">self</span>.check_for_row_in_list_table(<span class="string"><span class="delimiter">'</span><span class="content">1: Buy milk</span><span class="delimiter">'</span></span>)  <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="comment"># Perversely, she now decides to submit a second blank list item</span>
    <span class="predefined-constant">self</span>.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_new_item</span><span class="delimiter">'</span></span>).send_keys(<span class="string"><span class="delimiter">'</span><span class="char">\n</span><span class="delimiter">'</span></span>)

    <span class="comment"># She receives a similar warning on the list page</span>
    <span class="predefined-constant">self</span>.check_for_row_in_list_table(<span class="string"><span class="delimiter">'</span><span class="content">1: Buy milk</span><span class="delimiter">'</span></span>)
    error = <span class="predefined-constant">self</span>.browser.find_element_by_css_selector(<span class="string"><span class="delimiter">'</span><span class="content">.has-error</span><span class="delimiter">'</span></span>)
    <span class="predefined-constant">self</span>.assertEqual(error.text, <span class="string"><span class="delimiter">"</span><span class="content">You can't have an empty list item</span><span class="delimiter">"</span></span>)

    <span class="comment"># And she can correct it by filling some text in</span>
    <span class="predefined-constant">self</span>.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_new_item</span><span class="delimiter">'</span></span>).send_keys(<span class="string"><span class="delimiter">'</span><span class="content">Make tea</span><span class="char">\n</span><span class="delimiter">'</span></span>)
    <span class="predefined-constant">self</span>.check_for_row_in_list_table(<span class="string"><span class="delimiter">'</span><span class="content">1: Buy milk</span><span class="delimiter">'</span></span>)
    <span class="predefined-constant">self</span>.check_for_row_in_list_table(<span class="string"><span class="delimiter">'</span><span class="content">2: Make tea</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A couple of things to note about this test:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We specify we&#8217;re going to use a CSS class from Bootstrap called <code>.has-error</code> to mark our
error text.  We&#8217;ll see that Bootstrap has some useful styling for those</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>As predicted, we are reusing the <code>check_for_row_in_list_table</code> helper
function when we want to confirm that list item submission <em>does</em> work.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>
The technique of keeping helper methods in a parent class is meant to prevent
duplication across your functional test code.  The day we decide to change the
implementation of how our list table works, we want to make sure we only have
to change our FT code in one place, not in dozens of places across loads of
FTs&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>And we&#8217;re off!</p>
</div>
<div class="listingblock">
<div class="content">
<pre>selenium.common.exceptions.NoSuchElementException: Message: Unable to locate
element: {"method":"css selector","selector":".has-error"}</pre>
</div>
</div>
<div class="paragraph">
<p>I&#8217;ll let you do your own "first-cut FT" commit.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_model_layer_validation">Using Model-Layer Validation</h3>
<div class="paragraph">
<p>


There are two levels at which you can do validation in Django. One is
at the model level, and the other is higher up at the forms level.  I
like to use the lower level whenever possible, partially because I&#8217;m
a bit too fond of databases and database integrity rules, and partially
because it&#8217;s safer&#8212;&#8203;you can sometimes forget which form you use to
validate input, but you&#8217;re always going to use the same database.</p>
</div>
<div class="sect3">
<h4 id="_refactoring_unit_tests_into_several_files">Refactoring Unit Tests into Several Files</h4>
<div class="paragraph">
<p>


We&#8217;re going to want to add another test for our model, but before we
do so, it&#8217;s time to tidy up our unit tests in a similar way to the
functional tests.  A difference will be that, because the <code>lists</code>
app contains real application code as well as tests, we&#8217;ll separate
out the tests into their own folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>mkdir lists/tests</strong>
$ <strong>touch lists/tests/_\_init\_\_.py</strong>
$ <strong>git mv lists/tests.py lists/tests/test_all.py</strong>
$ <strong>git status</strong>
$ <strong>git add lists/tests</strong>
$ <strong>python3 manage.py test lists</strong>
[...]
Ran 10 tests in 0.034s

OK
$ <strong>git commit -m "Move unit tests into a folder with single file"</strong></pre>
</div>
</div>
<div class="paragraph">
<p>If you get a message saying "Ran 0 tests", you probably forgot to add the
dunderinit&#8212;&#8203;it needs to be there or else the tests folder isn&#8217;t a valid Python
package&#8230;&#8203;<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup></p>
</div>
<div class="paragraph">
<p>Now we turn <em>test_all.py</em> into two files, one called <em>test_views.py</em>, which
only contains view tests, and one called <em>test_models.py</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git mv lists/tests/test_all.py lists/tests/test_views.py</strong>
$ <strong>cp lists/tests/test_views.py lists/tests/test_models.py</strong></pre>
</div>
</div>
<div class="paragraph">
<p>We strip <em>test_models.py</em> down to being just the one test&#8212;&#8203;it means
it needs far fewer imports:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests/test_models.py (ch10l009)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.test</span> <span class="keyword">import</span> <span class="include">TestCase</span>
<span class="keyword">from</span> <span class="include">lists.models</span> <span class="keyword">import</span> <span class="include">Item</span>, <span class="include">List</span>


<span class="keyword">class</span> <span class="class">ListAndItemModelsTest</span>(TestCase):
        [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whereas <em>test_views.py</em>  just loses one class:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests/test_views.py (ch10l010)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="diff"><span class="line head"><span class="head">--- </span><span class="filename">a/lists/tests/test_views.py</span></span>
<span class="line head"><span class="head">+++ </span><span class="filename">b/lists/tests/test_views.py</span></span>
<span class="change"><span class="change">@@</span> -103,34 +104,3 <span class="change">@@</span></span> <span class="keyword">class</span> <span class="class">ListViewTest</span>(TestCase):
         <span class="predefined-constant">self</span>.assertNotContains(response, <span class="string"><span class="delimiter">'</span><span class="content">other list item 1</span><span class="delimiter">'</span></span>)
         <span class="predefined-constant">self</span>.assertNotContains(response, <span class="string"><span class="delimiter">'</span><span class="content">other list item 2</span><span class="delimiter">'</span></span>)

<span class="line delete"><span class="delete">-</span></span>
<span class="line delete"><span class="delete">-</span></span>
<span class="line delete"><span class="delete">-</span><span class="keyword">class</span> <span class="class">ListAndItemModelsTest</span>(TestCase):</span>
<span class="line delete"><span class="delete">-</span></span>
<span class="line delete"><span class="delete">-</span>    <span class="keyword">def</span> <span class="function">test_saving_and_retrieving_items</span>(<span class="predefined-constant">self</span>):</span>
<span class="line comment">[...]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We rerun the tests to check everything is still there:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test lists</strong>
[...]
Ran 10 tests in 0.040s

OK</pre>
</div>
</div>
<div class="paragraph">
<p>Great!</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git add lists/tests</strong>
$ <strong>git commit -m "Split out unit tests into two files"</strong></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Some people like to make their unit tests into a tests folder straight
away, as soon as they start a project, with the addition of another file,
<em>test_forms.py</em>. That&#8217;s a perfectly good idea; I just thought I&#8217;d wait until it
became necessary, to avoid doing too much housekeeping all in the first
chapter!
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_unit_testing_model_validation_and_the_self_assertraises_context_manager">Unit Testing Model Validation and the self.assertRaises Context Manager</h4>
<div class="paragraph">
<p>


Let&#8217;s add a new test method to <code>ListAndItemModelsTest</code>, which tries to create
a blank list item:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests/test_models.py (ch10l012-1)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.core.exceptions</span> <span class="keyword">import</span> <span class="include">ValidationError</span>
[...]

<span class="keyword">class</span> <span class="class">ListAndItemModelsTest</span>(TestCase):
    [...]

    <span class="keyword">def</span> <span class="function">test_cannot_save_empty_list_items</span>(<span class="predefined-constant">self</span>):
        list_ = List.objects.create()
        item = Item(list=list_, text=<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>)
        <span class="keyword">with</span> <span class="predefined-constant">self</span>.assertRaises(ValidationError):
            item.save()</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you&#8217;re new to Python, you may never have seen the <code>with</code> statement.
It&#8217;s used with what are called "context managers", which wrap a block of code,
usually with some kind of setup, cleanup, or error-handling code.  There&#8217;s a
good write-up in the
<a href="http://docs.python.org/release/2.5/whatsnew/pep-343.html">Python 2.5 release
notes</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is a new unit testing technique: when we want to check that doing
something will raise an error, we can use the <code>self.assertRaises</code> context
manager.  We could have used something like this instead:</p>
</div>
<div class="listingblock skipme">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">try</span>:
    item.save()
    <span class="predefined-constant">self</span>.fail(<span class="string"><span class="delimiter">'</span><span class="content">The save should have raised an exception</span><span class="delimiter">'</span></span>)
<span class="keyword">except</span> ValidationError:
    <span class="keyword">pass</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But the <code>with</code> formulation is neater.  Now, we can try running the test,
and see it fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    item.save()
AssertionError: ValidationError not raised</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_a_django_quirk_model_save_doesn_t_run_validation">A Django Quirk: Model Save Doesn&#8217;t Run Validation</h4>
<div class="paragraph">
<p>
And now we discover one of Django&#8217;s little quirks. <em>This test should already
pass</em>.  If you take a look at the
<a href="http://bit.ly/SuxPJO">docs for the
Django model fields</a>, you&#8217;ll see that <code>TextField</code> actually defaults to
<code>blank=False</code>, which means that it <em>should</em> disallow empty values.</p>
</div>
<div class="paragraph">
<p>So why is the test not failing?  Well, for
<a href="https://groups.google.com/forum/#!topic/django-developers/uIhzSwWHj4c">slightly
counterintuitive historical reasons</a>, Django models don&#8217;t run full validation on
save.  As we&#8217;ll see later, any constraints that are actually implemented in the
database will raise errors on save, but SQLite doesn&#8217;t support enforcing
emptiness constraints on text columns, and so our save method is letting this
invalid value through silently.</p>
</div>
<div class="paragraph">
<p>There&#8217;s a way of checking whether the constraint will happen at the database
level or not:  if it was at the database level, we would need a migration to
apply the constraint. But, Django knows that SQLite doesn&#8217;t support this type
of constraint, so if we try and run <code>makemigrations</code>, it will report there&#8217;s
nothing to do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py makemigrations</strong>
No changes detected</pre>
</div>
</div>
<div class="paragraph">
<p>Django does have a method to manually run full validation however, called
<code>full_clean</code>.  Let&#8217;s hack it in to see it work:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests/test_models.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">with</span> <span class="predefined-constant">self</span>.assertRaises(ValidationError):
        item.save()
        item.full_clean()</code></pre>
</div>
</div>
<div class="paragraph">
<p>That gets the test to pass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OK</pre>
</div>
</div>
<div class="paragraph">
<p>That taught us a little about Django validation, and the test is there to
warn us if we ever forget our requirement and set <code>blank=True</code> on the <code>text</code>
field (try it!).
</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_surfacing_model_validation_errors_in_the_view">Surfacing Model Validation Errors in the View</h3>
<div class="paragraph">
<p>

Let&#8217;s try and enforce our model validation in the views layer and bring it up
through into our templates, so the user can see them. Here&#8217;s how we can
optionally display an error in our HTML&#8212;&#8203;we check whether the template has
been passed an error variable, and if so, we display it next to the form:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/base.html (ch10l013)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">"</span><span class="content">POST</span><span class="delimiter">"</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">{% block form_action %}{% endblock %}</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">item_text</span><span class="delimiter">"</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">id_new_item</span><span class="delimiter">"</span></span>
           <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">form-control input-lg</span><span class="delimiter">"</span></span>
           <span class="attribute-name">placeholder</span>=<span class="string"><span class="delimiter">"</span><span class="content">Enter a to-do item</span><span class="delimiter">"</span></span>
    <span class="tag">/&gt;</span>
    {% csrf_token %}
    {% if error %}
        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">form-group has-error</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">help-block</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>{{ error }}<span class="tag">&lt;/span&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
    {% endif %}
<span class="tag">&lt;/form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Take a look at the <a href="http://getbootstrap.com/css/#forms">Bootstrap docs</a> for more
info on form controls.</p>
</div>
<div class="paragraph">
<p>Passing this error to the template is the job of the view function. Let&#8217;s take
a look at the unit tests in the <code>NewListTest</code> class.  I&#8217;m going to use two
slightly different error-handling patterns here.</p>
</div>
<div class="paragraph">
<p>In the first case, our URL and view for new lists will optionally render the
same template as the home page, but with the addition of an error message.
Here&#8217;s a unit test for that:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests/test_views.py (ch10l014)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">NewListTest</span>(TestCase):
    [...]

    <span class="keyword">def</span> <span class="function">test_validation_errors_are_sent_back_to_home_page_template</span>(<span class="predefined-constant">self</span>):
        response = <span class="predefined-constant">self</span>.client.post(<span class="string"><span class="delimiter">'</span><span class="content">/lists/new</span><span class="delimiter">'</span></span>, data={<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>})
        <span class="predefined-constant">self</span>.assertEqual(response.status_code, <span class="integer">200</span>)
        <span class="predefined-constant">self</span>.assertTemplateUsed(response, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>)
        expected_error = <span class="string"><span class="delimiter">"</span><span class="content">You can't have an empty list item</span><span class="delimiter">"</span></span>
        <span class="predefined-constant">self</span>.assertContains(response, expected_error)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we&#8217;re writing this test, we might get slightly offended by the <em>/lists/new</em>
URL, which we&#8217;re manually entering as a string. We&#8217;ve got a lot of URLs
hardcoded in our tests, in our views, and in our templates, which violates the
DRY principle.  I don&#8217;t mind a bit of duplication in tests, but we should
definitely be on the lookout for hardcoded URLs in our views and templates,
and make a note to refactor them out.  But we won&#8217;t do them straight away,
because right now our application is in a broken state. We want to get back
to a working state first.</p>
</div>
<div class="paragraph">
<p>Back to our test, which is failing because the view is currently returning a
302 redirect, rather than a "normal" 200 response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: 302 != 200</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s try calling <code>full_clean()</code> in the view:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">new_list</span>(request):
    list_ = List.objects.create()
    item = Item.objects.create(text=request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>], list=list_)
    item.full_clean()
    <span class="keyword">return</span> redirect(<span class="string"><span class="delimiter">'</span><span class="content">/lists/%d/</span><span class="delimiter">'</span></span> % (list_.id,))</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we&#8217;re looking at the view code, we find a good candidate for a hardcoded
URL to get rid of.  Let&#8217;s add that to our scratchpad:</p>
</div>
<div class="sidebarblock scratchpad">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>Remove hardcoded URLs from views.py</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Now the model validation raises an exception, which comes up through our view:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[...]
  File "/workspace/superlists/lists/views.py", line 11, in new_list
    item.full_clean()
[...]
django.core.exceptions.ValidationError: {'text': ['This field cannot be
blank.']}</pre>
</div>
</div>
<div class="paragraph">
<p>So we try our first approach:  using a <code>try/except</code> to detect errors. Obeying the
Testing Goat, we start with just the <code>try/except</code> and nothing else.  The tests
should tell us what to code next&#8230;&#8203;</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py (ch10l015)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.core.exceptions</span> <span class="keyword">import</span> <span class="include">ValidationError</span>
[...]

<span class="keyword">def</span> <span class="function">new_list</span>(request):
    list_ = List.objects.create()
    item = Item.objects.create(text=request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>], list=list_)
    <span class="keyword">try</span>:
        item.full_clean()
    <span class="keyword">except</span> ValidationError:
        <span class="keyword">pass</span>
    <span class="keyword">return</span> redirect(<span class="string"><span class="delimiter">'</span><span class="content">/lists/%d/</span><span class="delimiter">'</span></span> % (list_.id,))</code></pre>
</div>
</div>
<div class="paragraph">
<p>That gets us back to the 302 != 200:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: 302 != 200</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s return a rendered template then, which should take care of the template
check as well:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py (ch10l016)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">except</span> ValidationError:
        <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the tests now tell us to put the error message into the template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: False is not true : Couldn't find 'You can't have an empty list
item' in response</pre>
</div>
</div>
<div class="paragraph">
<p>We do that by passing a new template variable in:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py (ch10l017)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">except</span> ValidationError:
        error = <span class="string"><span class="delimiter">"</span><span class="content">You can't have an empty list item</span><span class="delimiter">"</span></span>
        <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>, {<span class="string"><span class="delimiter">"</span><span class="content">error</span><span class="delimiter">"</span></span>: error})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hmm, it looks like that didn&#8217;t quite work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AssertionError: False is not true : Couldn't find 'You can't have an empty list
item' in response</pre>
</div>
</div>
<div class="paragraph">
<p>A little print-based debug&#8230;&#8203;</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests/test_views.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">expected_error = <span class="string"><span class="delimiter">"</span><span class="content">You can't have an empty list item</span><span class="delimiter">"</span></span>
print(response.content.decode())
<span class="predefined-constant">self</span>.assertContains(response, expected_error)</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;will show us the cause: Django has
<a href="http://bit.ly/SuxUgF">HTML-escaped</a>
the apostrophe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[...]
&lt;span class="help-block"&gt;You can&amp;#39;t have an
empty list item&lt;/span&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>We could hack something like this into our test:</p>
</div>
<div class="listingblock skipme">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    expected_error = <span class="string"><span class="delimiter">"</span><span class="content">You can&amp;#39;t have an empty list item</span><span class="delimiter">"</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But using Django&#8217;s helper function is probably a better idea:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests/test_views.py (ch10l019)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.utils.html</span> <span class="keyword">import</span> <span class="include">escape</span>
[...]

        expected_error = escape(<span class="string"><span class="delimiter">"</span><span class="content">You can't have an empty list item</span><span class="delimiter">"</span></span>)
        <span class="predefined-constant">self</span>.assertContains(response, expected_error)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That passes!</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Ran 12 tests in 0.047s

OK</pre>
</div>
</div>
<div class="sect3">
<h4 id="_checking_invalid_input_isn_t_saved_to_the_database">Checking Invalid Input Isn&#8217;t Saved to the Database</h4>
<div class="paragraph">
<p>Before we go further though, did you notice a little logic error we&#8217;ve allowed
to creep into our implementation?  We&#8217;re currently creating an object, even
if validation fails:</p>
</div>
<div class="listingblock sourcecode currentcontents">
<div class="title">lists/views.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    item = Item.objects.create(text=request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>], list=list_)
    <span class="keyword">try</span>:
        item.full_clean()
    <span class="keyword">except</span> ValidationError:
        [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s add a new unit test to make sure that empty list items don&#8217;t get
saved:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests/test_views.py (ch10l020-1)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">NewListTest</span>(TestCase):
    [...]

    <span class="keyword">def</span> <span class="function">test_validation_errors_are_sent_back_to_home_page_template</span>(<span class="predefined-constant">self</span>):
        [...]

    <span class="keyword">def</span> <span class="function">test_invalid_list_items_arent_saved</span>(<span class="predefined-constant">self</span>):
        <span class="predefined-constant">self</span>.client.post(<span class="string"><span class="delimiter">'</span><span class="content">/lists/new</span><span class="delimiter">'</span></span>, data={<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>})
        <span class="predefined-constant">self</span>.assertEqual(List.objects.count(), <span class="integer">0</span>)
        <span class="predefined-constant">self</span>.assertEqual(Item.objects.count(), <span class="integer">0</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That gives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[...]
Traceback (most recent call last):
  File "/workspace/superlists/lists/tests/test_views.py", line 57, in
test_invalid_list_items_arent_saved
    self.assertEqual(List.objects.count(), 0)
AssertionError: 1 != 0</pre>
</div>
</div>
<div class="paragraph">
<p>We fix it like this:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py (ch10l020-2)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">new_list</span>(request):
    list_ = List.objects.create()
    item = Item(text=request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>], list=list_)
    <span class="keyword">try</span>:
        item.full_clean()
        item.save()
    <span class="keyword">except</span> ValidationError:
        list_.delete()
        error = <span class="string"><span class="delimiter">"</span><span class="content">You can't have an empty list item</span><span class="delimiter">"</span></span>
        <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">home.html</span><span class="delimiter">'</span></span>, {<span class="string"><span class="delimiter">"</span><span class="content">error</span><span class="delimiter">"</span></span>: error})
    <span class="keyword">return</span> redirect(<span class="string"><span class="delimiter">'</span><span class="content">/lists/%d/</span><span class="delimiter">'</span></span> % (list_.id,))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Do the FTs pass?</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test functional_tests.test_list_item_validation</strong>
[...]
  File "/workspace/superlists/functional_tests/test_list_item_validation.py",
line 26, in test_cannot_add_empty_list_items
[...]
selenium.common.exceptions.NoSuchElementException: Message: Unable to locate
element: {"method":"css selector","selector":".has-error"}</pre>
</div>
</div>
<div class="paragraph">
<p>Not quite, but they did get a little further.  Checking the <code>line 26</code>, we can
see that we&#8217;ve got past the first part of the test, and are now onto the second
check&#8212;&#8203;that submitting a second empty item also shows an error.</p>
</div>
<div class="paragraph">
<p>We&#8217;ve got some working code though, so let&#8217;s have a commit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git commit -am "Adjust new list view to do model validation"</strong></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_django_pattern_processing_post_requests_in_the_same_view_as_renders_the_form">Django Pattern: Processing POST Requests in the Same View as Renders the Form</h3>
<div class="paragraph">
<p>


This time we&#8217;ll use a slightly different approach, one that&#8217;s actually a very
common pattern in Django, which is to use the same view to process POST
requests as to render the form that they come from.  Whilst this doesn&#8217;t fit
the REST-ful URL model quite as well, it has the important advantage that the
same URL can display a form, and display any errors encountered in processing
the user&#8217;s input.</p>
</div>
<div class="paragraph">
<p>The current situation is that we have one view and URL for displaying a list,
and one view and URL for processing additions to that list.  We&#8217;re going to
combine them into one. So, in <em>list.html</em>, our form will have a different
target:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/list.html (ch10l020)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">{% block form_action %}/lists/{{ list.id }}/{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Incidentally, that&#8217;s another hardcoded URL.  Let&#8217;s add it to our to-do list,
and while we&#8217;re thinking about it, there&#8217;s one in <em>home.html</em> too:</p>
</div>
<div class="sidebarblock scratchpad">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>Remove hardcoded URLs from views.py</em></p>
</li>
<li>
<p><em>Remove hardcoded URL from forms in list.html and home.html</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>This will immediately break our original functional test, because the
<code>view_list</code> page doesn&#8217;t know how to process POST requests yet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test functional_tests</strong>
[...]
selenium.common.exceptions.NoSuchElementException: Message: Unable to locate
element: {"method":"css selector","selector":".has-error"}
[...]
AssertionError: '2: Use peacock feathers to make a fly' not found in ['1: Buy
peacock feathers']</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this section we&#8217;re performing a refactor at the application level.
We execute our application-level refactor by changing or adding unit tests, and
then adjusting our code. We use the functional tests to tell us when our
refactor is complete and things are back to working as before.  Have
another look at the diagram from the end of <a href="/book/chapter_04.html">[chapter-4]</a> if you need to get your
bearings.

</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_refactor_transferring_the_new_item_functionality_into_view_list">Refactor: Transferring the new_item Functionality into view_list</h4>
<div class="paragraph">
<p>
Let&#8217;s take all the old tests from <code>NewItemTest</code>, the ones that are about saving
POST requests to existing lists, and move them into <code>ListViewTest</code>. As we do
so, we also make them point at the base list URL, instead of <em>&#8230;&#8203;/add_item</em>:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests/test_views.py (ch10l021)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">ListViewTest</span>(TestCase):

    <span class="keyword">def</span> <span class="function">test_uses_list_template</span>(<span class="predefined-constant">self</span>):
        [...]

    <span class="keyword">def</span> <span class="function">test_passes_correct_list_to_template</span>(<span class="predefined-constant">self</span>):
        [...]

    <span class="keyword">def</span> <span class="function">test_displays_only_items_for_that_list</span>(<span class="predefined-constant">self</span>):
        [...]

    <span class="keyword">def</span> <span class="function">test_can_save_a_POST_request_to_an_existing_list</span>(<span class="predefined-constant">self</span>):
        other_list = List.objects.create()
        correct_list = List.objects.create()

        <span class="predefined-constant">self</span>.client.post(
            <span class="string"><span class="delimiter">'</span><span class="content">/lists/%d/</span><span class="delimiter">'</span></span> % (correct_list.id,),
            data={<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">A new item for an existing list</span><span class="delimiter">'</span></span>}
        )

        <span class="predefined-constant">self</span>.assertEqual(Item.objects.count(), <span class="integer">1</span>)
        new_item = Item.objects.first()
        <span class="predefined-constant">self</span>.assertEqual(new_item.text, <span class="string"><span class="delimiter">'</span><span class="content">A new item for an existing list</span><span class="delimiter">'</span></span>)
        <span class="predefined-constant">self</span>.assertEqual(new_item.list, correct_list)


    <span class="keyword">def</span> <span class="function">test_POST_redirects_to_list_view</span>(<span class="predefined-constant">self</span>):
        other_list = List.objects.create()
        correct_list = List.objects.create()

        response = <span class="predefined-constant">self</span>.client.post(
            <span class="string"><span class="delimiter">'</span><span class="content">/lists/%d/</span><span class="delimiter">'</span></span> % (correct_list.id,),
            data={<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">A new item for an existing list</span><span class="delimiter">'</span></span>}
        )
        <span class="predefined-constant">self</span>.assertRedirects(response, <span class="string"><span class="delimiter">'</span><span class="content">/lists/%d/</span><span class="delimiter">'</span></span> % (correct_list.id,))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>NewItemTest</code> class disappears completely.  I&#8217;ve also changed the
name of the redirect test to make it explicit that it only applies to POST
requests.</p>
</div>
<div class="paragraph">
<p>That gives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FAIL: test_POST_redirects_to_list_view (lists.tests.test_views.ListViewTest)
AssertionError: 200 != 302 : Response didn't redirect as expected: Response
code was 200 (expected 302)
[...]
FAIL: test_can_save_a_POST_request_to_an_existing_list
(lists.tests.test_views.ListViewTest)
AssertionError: 0 != 1</pre>
</div>
</div>
<div class="paragraph">
<p>We change the <code>view_list</code> function to handle two types of request:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py (ch10l022-1)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">view_list</span>(request, list_id):
    list_ = List.objects.get(id=list_id)
    <span class="keyword">if</span> request.method == <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>:
        Item.objects.create(text=request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>], list=list_)
        <span class="keyword">return</span> redirect(<span class="string"><span class="delimiter">'</span><span class="content">/lists/%d/</span><span class="delimiter">'</span></span> % (list_.id,))
    <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">list.html</span><span class="delimiter">'</span></span>, {<span class="string"><span class="delimiter">'</span><span class="content">list</span><span class="delimiter">'</span></span>: list_})</code></pre>
</div>
</div>
<div class="paragraph">
<p>That gets us passing tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Ran 13 tests in 0.047s

OK</pre>
</div>
</div>
<div class="paragraph">
<p>Now we can delete the <code>add_item</code> view, since it&#8217;s no longer needed&#8230;&#8203;oops, a
couple of unexpected failures:</p>
</div>
<div class="listingblock dofirst-ch10l022-2">
<div class="content">
<pre>[...]
AttributeError: 'module' object has no attribute 'add_item'
[...]
FAILED (errors=10)</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s because we&#8217;ve deleted the view, but it&#8217;s still being referred to in
<em>urls.py</em>.  We remove it from there:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/urls.py (ch10l023)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">urlpatterns = [
    url(<span class="string"><span class="modifier">r</span><span class="delimiter">'</span><span class="content">^new$</span><span class="delimiter">'</span></span>, views.new_list, name=<span class="string"><span class="delimiter">'</span><span class="content">new_list</span><span class="delimiter">'</span></span>),
    url(<span class="string"><span class="modifier">r</span><span class="delimiter">'</span><span class="content">^(</span><span class="content">\d</span><span class="content">+)/$</span><span class="delimiter">'</span></span>, views.view_list, name=<span class="string"><span class="delimiter">'</span><span class="content">view_list</span><span class="delimiter">'</span></span>),
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that gets us to the <code>OK</code>. Let&#8217;s try a full FT run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test</strong>
[...]

Ran 16 tests in 15.276s

FAILED (errors=1)</pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re back to the one failure in our new functional test. Our refactor of the
<code>add_item</code> functionality is complete. We should commit there:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git commit -am "Refactor list view to handle new item POSTs"</strong></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
So did I break the rule about never refactoring against failing tests?
In this case, it&#8217;s allowed, because the refactor is required to get our new
functionality to work.  You should definitely never refactor against failing
<em>unit</em> tests.  But in my book it&#8217;s OK for the FT for the current story you&#8217;re
working on to be failing. If you prefer a clean test run, you could add a
skip to the current FT.


</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_enforcing_model_validation_in_view_list">Enforcing Model Validation in view_list</h4>
<div class="paragraph">
<p>
We still want the addition of items to existing lists to be subject to our
model validation rules. Let&#8217;s write a new unit test for that; it&#8217;s very similar
to the one for the home page, with just a couple of tweaks:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests/test_views.py (ch10l024)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">ListViewTest</span>(TestCase):
    [...]

    <span class="keyword">def</span> <span class="function">test_validation_errors_end_up_on_lists_page</span>(<span class="predefined-constant">self</span>):
        list_ = List.objects.create()
        response = <span class="predefined-constant">self</span>.client.post(
            <span class="string"><span class="delimiter">'</span><span class="content">/lists/%d/</span><span class="delimiter">'</span></span> % (list_.id,),
            data={<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>}
        )
        <span class="predefined-constant">self</span>.assertEqual(response.status_code, <span class="integer">200</span>)
        <span class="predefined-constant">self</span>.assertTemplateUsed(response, <span class="string"><span class="delimiter">'</span><span class="content">list.html</span><span class="delimiter">'</span></span>)
        expected_error = escape(<span class="string"><span class="delimiter">"</span><span class="content">You can't have an empty list item</span><span class="delimiter">"</span></span>)
        <span class="predefined-constant">self</span>.assertContains(response, expected_error)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That should fail, because our view currently does not do any validation, and
just redirects for all POSTs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    self.assertEqual(response.status_code, 200)
AssertionError: 302 != 200</pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s an implementation:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py (ch10l025)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">view_list</span>(request, list_id):
    list_ = List.objects.get(id=list_id)
    error = <span class="predefined-constant">None</span>

    <span class="keyword">if</span> request.method == <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>:
        <span class="keyword">try</span>:
            item = Item(text=request.POST[<span class="string"><span class="delimiter">'</span><span class="content">item_text</span><span class="delimiter">'</span></span>], list=list_)
            item.full_clean()
            item.save()
            <span class="keyword">return</span> redirect(<span class="string"><span class="delimiter">'</span><span class="content">/lists/%d/</span><span class="delimiter">'</span></span> % (list_.id,))
        <span class="keyword">except</span> ValidationError:
            error = <span class="string"><span class="delimiter">"</span><span class="content">You can't have an empty list item</span><span class="delimiter">"</span></span>

    <span class="keyword">return</span> render(request, <span class="string"><span class="delimiter">'</span><span class="content">list.html</span><span class="delimiter">'</span></span>, {<span class="string"><span class="delimiter">'</span><span class="content">list</span><span class="delimiter">'</span></span>: list_, <span class="string"><span class="delimiter">'</span><span class="content">error</span><span class="delimiter">'</span></span>: error})</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s not deeply satisfying is it? There&#8217;s definitely some duplication of code
here, that <code>try/except</code> occurs twice in <em>views.py</em>, and in general things are
feeling clunky.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Ran 14 tests in 0.047s

OK</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s wait a bit before we do more refactoring though, because we know we&#8217;re
about to do some slightly different validation coding for duplicate items.
We&#8217;ll just add it to our scratchpad for now:</p>
</div>
<div class="sidebarblock scratchpad">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>Remove hardcoded URLs from views.py</em></p>
</li>
<li>
<p><em>Remove hardcoded URL from forms in list.html and home.html</em></p>
</li>
<li>
<p><em>Remove duplication of validation logic in views</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
One of the reasons that the "three strikes and refactor" rule exists is
that, if you wait until you have three use cases, each might be slightly
different, and it gives you a better view for what the common functionality is.
If you refactor too early, you may find that the third use case doesn&#8217;t quite
fit with your refactored code&#8230;&#8203;
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At least our functional tests are back to passing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test functional_tests</strong>
[...]
OK</pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re back to a working state, so we can take a look at some of the items on
our scratchpad.  This would be a good time for a commit. And possibly a
tea break.




</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git commit -am "enforce model validation in list view"</strong></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_refactor_removing_hardcoded_urls">Refactor: Removing Hardcoded URLs</h3>
<div class="paragraph">
<p>
Do you remember those <code>name=</code> parameters in <em>urls.py</em>? We just copied
them across from the default example Django gave us, and I&#8217;ve been giving
them some reasonably descriptive names. Now we find out what they&#8217;re for.</p>
</div>
<div class="listingblock sourcecode currentcontents">
<div class="title">lists/urls.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    url(<span class="string"><span class="modifier">r</span><span class="delimiter">'</span><span class="content">^new$</span><span class="delimiter">'</span></span>, views.new_list, name=<span class="string"><span class="delimiter">'</span><span class="content">new_list</span><span class="delimiter">'</span></span>),
    url(<span class="string"><span class="modifier">r</span><span class="delimiter">'</span><span class="content">^(</span><span class="content">\d</span><span class="content">+)/$</span><span class="delimiter">'</span></span>, views.view_list, name=<span class="string"><span class="delimiter">'</span><span class="content">view_list</span><span class="delimiter">'</span></span>),</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_the_url_template_tag">The {% url %} Template Tag</h4>
<div class="paragraph">
<p>We can replace the hardcoded URL in <em>home.html</em> with a Django template tag
which refers to the URL&#8217;s "name":</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/home.html (ch10l026-1)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">{% block form_action %}{% url 'new_list' %}{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We check that doesn&#8217;t break the unit tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test lists</strong>
OK</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s do the other template.  This one is more interesting, because we pass it
a parameter:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/list.html (ch10l026-2)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">{% block form_action %}{% url 'view_list' list.id %}{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check out the
<a href="https://docs.djangoproject.com/en/1.8/topics/http/urls/#reverse-resolution-of-urls">Django
docs on reverse URL resolution</a> for more info.</p>
</div>
<div class="paragraph">
<p>We run the tests again, and check they all pass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test lists</strong>
OK
$ <strong>python3 manage.py test functional_tests</strong>
OK</pre>
</div>
</div>
<div class="paragraph">
<p>Excellent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git commit -am "Refactor hard-coded URLs out of templates"</strong></pre>
</div>
</div>
<div class="sidebarblock scratchpad">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>Remove hardcoded URLs from views.py</em></p>
</li>
<li>
<p><em><span class="strikethrough line-through">Remove hardcoded URL from forms in list.html and home.html</span></em></p>
</li>
<li>
<p><em>Remove duplication of validation logic in views</em></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_get_absolute_url_for_redirects">Using get_absolute_url for Redirects</h4>
<div class="paragraph">
<p>
Now let&#8217;s tackle <em>views.py</em>. One way of doing it is just like in the
template, passing in the name of the URL and a positional argument:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py (ch10l026-3)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">new_list</span>(request):
    [...]
    <span class="keyword">return</span> redirect(<span class="string"><span class="delimiter">'</span><span class="content">view_list</span><span class="delimiter">'</span></span>, list_.id)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That would get the unit and functional tests passing, but the <code>redirect</code>
function can do even better magic than that!  In Django, because model objects
are often associated with a particular URL, you can define a special function
called <code>get_absolute_url</code> which says what page displays the item.  It&#8217;s useful
in this case, but it&#8217;s also useful in the Django admin (which I don&#8217;t cover in
the book, but you&#8217;ll soon discover for yourself): it will let you jump from
looking at an object in the admin view to looking at the object on the live
site. I&#8217;d always recommend defining a <code>get_absolute_url</code> for a model whenever
there is one that makes sense; it takes no time at all.</p>
</div>
<div class="paragraph">
<p>All it takes is a super-simple unit test in <em>test_models.py</em>:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests/test_models.py (ch10l026-4)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">def</span> <span class="function">test_get_absolute_url</span>(<span class="predefined-constant">self</span>):
        list_ = List.objects.create()
        <span class="predefined-constant">self</span>.assertEqual(list_.get_absolute_url(), <span class="string"><span class="delimiter">'</span><span class="content">/lists/%d/</span><span class="delimiter">'</span></span> % (list_.id,))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which gives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AttributeError: 'List' object has no attribute 'get_absolute_url'</pre>
</div>
</div>
<div class="paragraph">
<p>And the implementation is to use Django&#8217;s <code>reverse</code> function, which
essentially does the reverse of what Django normally does with <em>urls.py</em>
(see
<a href="https://docs.djangoproject.com/en/1.8/topics/http/urls/#reverse-resolution-of-urls">docs</a>):</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/models.py (ch10l026-5)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.core.urlresolvers</span> <span class="keyword">import</span> <span class="include">reverse</span>


<span class="keyword">class</span> <span class="class">List</span>(models.Model):

    <span class="keyword">def</span> <span class="function">get_absolute_url</span>(<span class="predefined-constant">self</span>):
        <span class="keyword">return</span> reverse(<span class="string"><span class="delimiter">'</span><span class="content">view_list</span><span class="delimiter">'</span></span>, args=[<span class="predefined-constant">self</span>.id])</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now we can use it in the view&#8212;&#8203;the <code>redirect</code> function just takes the
object we want to redirect to, and it uses <code>get_absolute_url</code> under the
hood automagically!</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py (ch10l026-6)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">new_list</span>(request):
    [...]
    <span class="keyword">return</span> redirect(list_)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s more info in the
<a href="https://docs.djangoproject.com/en/1.8/topics/http/shortcuts/#redirect">Django
docs</a>.  Quick check that the unit tests still pass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OK</pre>
</div>
</div>
<div class="paragraph">
<p>Then we do the same to <code>view_list</code>:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/views.py (ch10l026-7)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">view_list</span>(request, list_id):
    [...]

            item.save()
            <span class="keyword">return</span> redirect(list_)
        <span class="keyword">except</span> ValidationError:
            error = <span class="string"><span class="delimiter">"</span><span class="content">You can't have an empty list item</span><span class="delimiter">"</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And a full unit test and functional test run to assure ourselves that
everything still works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python3 manage.py test lists</strong>
OK
$ <strong>python3 manage.py test functional_tests</strong>
OK</pre>
</div>
</div>
<div class="paragraph">
<p>Cross off our to-dos:</p>
</div>
<div class="sidebarblock scratchpad">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em><span class="strikethrough line-through">Remove hardcoded URLs from views.py</span></em></p>
</li>
<li>
<p><em><span class="strikethrough line-through">Remove hardcoded URL from forms in list.html and home.html</span></em></p>
</li>
<li>
<p><em>Remove duplication of validation logic in views</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s do a commit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git commit -am "Use get_absolute_url on List model to DRY urls in views"</strong></pre>
</div>
</div>
<div class="paragraph">
<p>That final to-do item will be the subject of the next chapter&#8230;&#8203;

</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Tips on Organising Tests and Refactoring</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Use a tests folder</dt>
<dd>
<p>Just as you use multiple files to hold your application code, you should
split your tests out into multiple files.
+</p>
<div class="ulist">
<ul>
<li>
<p>Use a folder called <em>tests</em>, with a <em><em>init</em>.py</em>.</p>
</li>
<li>
<p>For functional tests, group them into tests for a particular feature or
user story.</p>
</li>
<li>
<p>For unit tests, you want a separate test file for each tested source code
file. For Django, that&#8217;s typically <em>test_models.py</em>, <em>test_views.py</em>, and
<em>test_forms.py</em>.</p>
</li>
<li>
<p>Have at least a placeholder test for <em>every</em> function and class.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Don&#8217;t forget the "Refactor" in "Red, Green, Refactor"</dt>
<dd>
<p>The whole point of having tests is to allow you to refactor your code!
Use them, and make your code as clean as you can.</p>
</dd>
<dt class="hdlist1">Don&#8217;t refactor against failing tests</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In general!</p>
</li>
<li>
<p>But the FT you&#8217;re currently working on doesn&#8217;t count.</p>
</li>
<li>
<p>You can occasionally put a skip on a test which is testing something you
haven&#8217;t written yet.</p>
</li>
<li>
<p>More commonly, make a note of the refactor you want to do, finish what
you&#8217;re working on, and do the refactor a little later, when you&#8217;re back
to a working state.</p>
</li>
<li>
<p>Don&#8217;t forget to remove any skips before you commit your code! You should
always review your diffs line by line to catch things like this.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. "Dunder" is shorthand for double-underscore, so "dunderinit" means <em><em>init</em>.py</em>.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-07-01 18:00:37 BST
</div>
</div>
<div class="comments" style="padding: 20px">
  <h3>Comments</h3>
  <div id="disqus_thread"></div>

  <script type="text/javascript">
var disqus_shortname = 'obeythetestinggoat';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
  </script>

  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
<html><head><script>   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)   })(window,document,'script','//www.google-analytics.com/analytics.js','ga');    ga('create', 'UA-40928035-1', 'obeythetestinggoat.com');   ga('send', 'pageview');  </script> 

</head></html></body>
</html>