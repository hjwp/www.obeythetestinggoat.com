<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>Building a REST API: JSON, Ajax, and mocking with JavaScript</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="buy_the_book" style="position: absolute; top: 0; right: 0; z-index:100">
  <a href="/pages/book.html">
    <img src="images/buy_the_book.svg" alt="buy the book ribbon">
  </a>
</div>
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="/book/praise.harry.html">Praise for <em>Test-Driven Development with Python</em></a></li>
<li><a href="/book/preface.html">Preface</a>
<ul class="sectlevel2">
<li><a href="/book/preface.html#_second_edition_release_history">Second Edition Release History:</a></li>
<li><a href="/book/preface.html#_why_i_wrote_a_book_about_test_driven_development">Why I Wrote a Book About Test-Driven Development</a></li>
<li><a href="/book/preface.html#_aims_of_this_book">Aims of This Book</a></li>
<li><a href="/book/preface.html#_outline">Outline</a></li>
<li><a href="/book/preface.html#_conventions_used_in_this_book">Conventions Used in This Book</a></li>
<li><a href="/book/preface.html#_using_code_examples">Using Code Examples</a></li>
<li><a href="/book/preface.html#_safari_books_online">Safari&#174; Books Online</a></li>
<li><a href="/book/preface.html#_contacting_o_reilly">Contacting O&#8217;Reilly</a></li>
</ul>
</li>
<li><a href="/book/pre-requisite-installations.html">Prerequisites and Assumptions</a>
<ul class="sectlevel2">
<li><a href="/book/pre-requisite-installations.html#_python_3_and_programming">Python 3 and Programming</a></li>
<li><a href="/book/pre-requisite-installations.html#_how_html_works">How HTML Works</a></li>
<li><a href="/book/pre-requisite-installations.html#_django">Django</a></li>
<li><a href="/book/pre-requisite-installations.html#_javascript">JavaScript</a></li>
<li><a href="/book/pre-requisite-installations.html#_required_software_installations">Required Software Installations</a></li>
<li><a href="/book/pre-requisite-installations.html#_setting_up_your_virtualenv">Setting up your virtualenv</a></li>
</ul>
</li>
<li><a href="/book/video_plug.html">Companion Video</a></li>
<li><a href="/book/acknowledgments.html">Acknowledgments</a></li>
<li><a href="/book/part1.harry.html">The Basics of TDD and Django</a>
<ul class="sectlevel1">
<li><a href="/book/chapter_01.html">1. Getting Django Set Up Using a Functional Test</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_01.html#_obey_the_testing_goat_do_nothing_until_you_have_a_test">1.1. Obey the Testing Goat! Do Nothing Until You Have a Test</a></li>
<li><a href="/book/chapter_01.html#_getting_django_up_and_running">1.2. Getting Django Up and Running</a></li>
<li><a href="/book/chapter_01.html#_starting_a_git_repository">1.3. Starting a Git Repository</a></li>
</ul>
</li>
<li><a href="/book/chapter_02.html">2. Extending Our Functional Test Using the unittest Module</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_02.html#_using_a_functional_test_to_scope_out_a_minimum_viable_app">2.1. Using a Functional Test to Scope Out a Minimum Viable App</a></li>
<li><a href="/book/chapter_02.html#_the_python_standard_library_s_unittest_module">2.2. The Python Standard Library&#8217;s unittest Module</a></li>
<li><a href="/book/chapter_02.html#_implicit_waits">2.3. Implicit waits</a></li>
<li><a href="/book/chapter_02.html#_commit">2.4. Commit</a></li>
</ul>
</li>
<li><a href="/book/chapter_03.html">3. Testing a Simple Home Page with Unit Tests</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_03.html#_our_first_django_app_and_our_first_unit_test">3.1. Our First Django App, and Our First Unit Test</a></li>
<li><a href="/book/chapter_03.html#_unit_tests_and_how_they_differ_from_functional_tests">3.2. Unit Tests, and How They Differ from Functional Tests</a></li>
<li><a href="/book/chapter_03.html#_unit_testing_in_django">3.3. Unit Testing in Django</a></li>
<li><a href="/book/chapter_03.html#_django_s_mvc_urls_and_view_functions">3.4. Django&#8217;s MVC, URLs, and View Functions</a></li>
<li><a href="/book/chapter_03.html#_at_last_we_actually_write_some_application_code">3.5. At Last! We Actually Write Some Application Code!</a></li>
<li><a href="/book/chapter_03.html#_urls_py">3.6. urls.py</a></li>
<li><a href="/book/chapter_03.html#_unit_testing_a_view">3.7. Unit Testing a View</a></li>
</ul>
</li>
<li><a href="/book/chapter_04.html">4. What Are We Doing with All These Tests?</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_04.html#_programming_is_like_pulling_a_bucket_of_water_up_from_a_well">4.1. Programming Is like Pulling a Bucket of Water up from a Well</a></li>
<li><a href="/book/chapter_04.html#_using_selenium_to_test_user_interactions">4.2. Using Selenium to Test User Interactions</a></li>
<li><a href="/book/chapter_04.html#_the_don_t_test_constants_rule_and_templates_to_the_rescue">4.3. The &#8220;Don&#8217;t Test Constants&#8221; Rule, and Templates to the Rescue</a></li>
<li><a href="/book/chapter_04.html#_on_refactoring">4.4. On Refactoring</a></li>
<li><a href="/book/chapter_04.html#_a_little_more_of_our_front_page">4.5. A Little More of Our Front Page</a></li>
<li><a href="/book/chapter_04.html#_recap_the_tdd_process">4.6. Recap: The TDD Process</a></li>
</ul>
</li>
<li><a href="/book/chapter_05.html">5. Saving User Input</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_05.html#_wiring_up_our_form_to_send_a_post_request">5.1. Wiring Up Our Form to Send a POST Request</a></li>
<li><a href="/book/chapter_05.html#_processing_a_post_request_on_the_server">5.2. Processing a POST Request on the Server</a></li>
<li><a href="/book/chapter_05.html#_passing_python_variables_to_be_rendered_in_the_template">5.3. Passing Python Variables to Be Rendered in the Template</a></li>
<li><a href="/book/chapter_05.html#_three_strikes_and_refactor">5.4. Three Strikes and Refactor</a></li>
<li><a href="/book/chapter_05.html#_the_django_orm_and_our_first_model">5.5. The Django ORM and Our First Model</a></li>
<li><a href="/book/chapter_05.html#_saving_the_post_to_the_database">5.6. Saving the POST to the Database</a></li>
<li><a href="/book/chapter_05.html#_redirect_after_a_post">5.7. Redirect After a POST</a></li>
<li><a href="/book/chapter_05.html#_rendering_items_in_the_template">5.8. Rendering Items in the Template</a></li>
<li><a href="/book/chapter_05.html#_creating_our_production_database_with_migrate">5.9. Creating Our Production Database with migrate</a></li>
</ul>
</li>
<li><a href="/book/chapter_06.html">6. Getting to the Minimum Viable Site</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_06.html#_ensuring_test_isolation_in_functional_tests">6.1. Ensuring Test Isolation in Functional Tests</a></li>
<li><a href="/book/chapter_06.html#_small_design_when_necessary">6.2. Small Design When Necessary</a></li>
<li><a href="/book/chapter_06.html#_implementing_the_new_design_using_tdd">6.3. Implementing the New Design Using TDD</a></li>
<li><a href="/book/chapter_06.html#_iterating_towards_the_new_design">6.4. Iterating Towards the New Design</a></li>
<li><a href="/book/chapter_06.html#_testing_views_templates_and_urls_together_with_the_django_test_client">6.5. Testing Views, Templates, and URLs Together with the Django Test Client</a></li>
<li><a href="/book/chapter_06.html#_another_url_and_view_for_adding_list_items">6.6. Another URL and View for Adding List Items</a></li>
<li><a href="/book/chapter_06.html#_adjusting_our_models">6.7. Adjusting Our Models</a></li>
<li><a href="/book/chapter_06.html#_each_list_should_have_its_own_url">6.8. Each List Should Have Its Own URL</a></li>
<li><a href="/book/chapter_06.html#_the_functional_tests_detect_a_regression">6.9. The functional tests detect a regression</a></li>
<li><a href="/book/chapter_06.html#_one_more_view_to_handle_adding_items_to_an_existing_list">6.10. One More View to Handle Adding Items to an Existing List</a></li>
<li><a href="/book/chapter_06.html#_a_final_refactor_using_url_includes">6.11. A Final Refactor Using URL includes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/book/part2.harry.html">Web Development Sine Qua Nons</a>
<ul class="sectlevel1">
<li><a href="/book/chapter_07.html">7. Prettification: Layout and Styling, and What to Test About It</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_07.html#_what_to_functionally_test_about_layout_and_style">7.1. What to Functionally Test About Layout and Style</a></li>
<li><a href="/book/chapter_07.html#_prettification_using_a_css_framework">7.2. Prettification: Using a CSS Framework</a></li>
<li><a href="/book/chapter_07.html#_django_template_inheritance">7.3. Django Template Inheritance</a></li>
<li><a href="/book/chapter_07.html#_integrating_bootstrap">7.4. Integrating Bootstrap</a></li>
<li><a href="/book/chapter_07.html#_static_files_in_django">7.5. Static Files in Django</a></li>
<li><a href="/book/chapter_07.html#_using_bootstrap_components_to_improve_the_look_of_the_site">7.6. Using Bootstrap Components to Improve the Look of the Site</a></li>
<li><a href="/book/chapter_07.html#_using_our_own_css">7.7. Using Our Own CSS</a></li>
<li><a href="/book/chapter_07.html#_what_we_glossed_over_collectstatic_and_other_static_directories">7.8. What We Glossed Over: collectstatic and Other Static Directories</a></li>
<li><a href="/book/chapter_13.html#_a_few_things_that_didn_t_make_it">7.9. A Few Things That Didn&#8217;t Make It</a></li>
</ul>
</li>
<li><a href="/book/chapter_08.html">8. Testing Deployment Using a Staging Site</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_08.html#_tdd_and_the_danger_areas_of_deployment">8.1. TDD and the Danger Areas of Deployment</a></li>
<li><a href="/book/chapter_08.html#_as_always_start_with_a_test">8.2. As Always, Start with a Test</a></li>
<li><a href="/book/chapter_08.html#_getting_a_domain_name">8.3. Getting a Domain Name</a></li>
<li><a href="/book/chapter_08.html#_manually_provisioning_a_server_to_host_our_site">8.4. Manually Provisioning a Server to Host Our Site</a></li>
<li><a href="/book/chapter_08.html#_deploying_our_code_manually">8.5. Deploying Our Code Manually</a></li>
<li><a href="/book/chapter_08.html#_getting_to_a_production_ready_deployment">8.6. Getting to a Production-Ready Deployment</a></li>
<li><a href="/book/chapter_08.html#_automating">8.7. Automating</a></li>
</ul>
</li>
<li><a href="/book/chapter_09.html">9. Automating Deployment with Fabric</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_09.html#_breakdown_of_a_fabric_script_for_our_deployment">9.1. Breakdown of a Fabric Script for Our Deployment</a></li>
<li><a href="/book/chapter_09.html#_trying_it_out">9.2. Trying It Out</a></li>
<li><a href="/book/chapter_09.html#_git_tag_the_release">9.3. Git Tag the Release</a></li>
<li><a href="/book/chapter_09.html#_further_reading">9.4. Further Reading</a></li>
</ul>
</li>
<li><a href="/book/chapter_10.html">10. Input Validation and Test Organisation</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_10.html#_validation_ft_preventing_blank_items">10.1. Validation FT: Preventing Blank Items</a></li>
<li><a href="/book/chapter_10.html#_using_model_layer_validation">10.2. Using Model-Layer Validation</a></li>
<li><a href="/book/chapter_10.html#_surfacing_model_validation_errors_in_the_view">10.3. Surfacing Model Validation Errors in the View</a></li>
<li><a href="/book/chapter_10.html#_django_pattern_processing_post_requests_in_the_same_view_as_renders_the_form">10.4. Django Pattern: Processing POST Requests in the Same View as Renders the Form</a></li>
<li><a href="/book/chapter_10.html#_refactor_removing_hardcoded_urls">10.5. Refactor: Removing Hardcoded URLs</a></li>
</ul>
</li>
<li><a href="/book/chapter_11.html">11. A Simple Form</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_11.html#_moving_validation_logic_into_a_form">11.1. Moving Validation Logic into a Form</a></li>
<li><a href="/book/chapter_11.html#_using_the_form_in_our_views">11.2. Using the Form in Our Views</a></li>
<li><a href="/book/chapter_11.html#_using_the_form_in_a_view_that_takes_post_requests">11.3. Using the Form in a View That Takes POST Requests</a></li>
<li><a href="/book/chapter_11.html#_using_the_form_in_the_other_view">11.4. Using the Form in the Other View</a></li>
<li><a href="/book/chapter_11.html#_using_the_form_s_own_save_method">11.5. Using the Form&#8217;s Own Save Method</a></li>
</ul>
</li>
<li><a href="/book/chapter_12.html">12. More Advanced Forms</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_12.html#_another_ft_for_duplicate_items">12.1. Another FT for Duplicate Items</a></li>
<li><a href="/book/chapter_12.html#_experimenting_with_duplicate_item_validation_at_the_views_layer">12.2. Experimenting with Duplicate Item Validation at the Views Layer</a></li>
<li><a href="/book/chapter_12.html#_a_more_complex_form_to_handle_uniqueness_validation">12.3. A More Complex Form to Handle Uniqueness Validation</a></li>
<li><a href="/book/chapter_12.html#_using_the_existing_list_item_form_in_the_list_view">12.4. Using the Existing List Item Form in the List View</a></li>
</ul>
</li>
<li><a href="/book/chapter_13.html">13. Dipping Our Toes, Very Tentatively, into JavaScript</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_13.html#_starting_with_an_ft">13.1. Starting with an FT</a></li>
<li><a href="/book/chapter_13.html#_setting_up_a_basic_javascript_test_runner">13.2. Setting Up a Basic JavaScript Test Runner</a></li>
<li><a href="/book/chapter_13.html#_using_jquery_and_the_fixtures_div">13.3. Using jQuery and the Fixtures Div</a></li>
<li><a href="/book/chapter_13.html#_building_a_javascript_unit_test_for_our_desired_functionality">13.4. Building a JavaScript Unit Test for Our Desired Functionality</a></li>
<li><a href="/book/chapter_13.html#_fixtures_execution_order_and_global_state_key_challenges_of_js_testing">13.5. Fixtures, execution order and global state: key challenges of js testing</a></li>
<li><a href="/book/chapter_13.html#_columbo_says_onload_boilerplate_and_namespacing">13.6. Columbo Says: Onload Boilerplate and Namespacing</a></li>
<li><a href="/book/chapter_13.html#_javascript_testing_in_the_tdd_cycle">13.7. Javascript Testing in the TDD Cycle</a></li>
<li><a href="#_a_few_things_that_didn_t_make_it_2">13.8. A Few Things That Didn&#8217;t Make It</a></li>
</ul>
</li>
<li><a href="/book/chapter_14.html">14. Deploying Our New Code</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_14.html#_staging_deploy">14.1. Staging Deploy</a></li>
<li><a href="/book/chapter_14.html#_live_deploy">14.2. Live Deploy</a></li>
<li><a href="/book/chapter_14.html#_what_to_do_if_you_see_a_database_error">14.3. What to Do If You See a Database Error</a></li>
<li><a href="/book/chapter_14.html#_wrap_up_git_tag_the_new_release">14.4. Wrap-Up: git tag the New Release</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/book/part3.harry.html">More Advanced Topics</a>
<ul class="sectlevel1">
<li><a href="/book/chapter_15.html">15. User Authentication, Spiking and De-Spiking</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_15.html#_passwordless_auth">15.1. Passwordless Auth</a></li>
<li><a href="/book/chapter_15.html#_exploratory_coding_aka_spiking">15.2. Exploratory Coding, aka "Spiking"</a></li>
<li><a href="/book/chapter_15.html#_de_spiking">15.3. De-spiking</a></li>
<li><a href="/book/chapter_15.html#_a_minimal_custom_user_model">15.4. A Minimal Custom User Model</a></li>
<li><a href="/book/chapter_15.html#_a_token_model_to_link_emails_with_a_unique_id">15.5. A Token model to link emails with a unique id</a></li>
<li><a href="/book/chapter_15.html#_old_content_we_might_want_to_re_use">15.6. Old content we might want to re-use</a></li>
</ul>
</li>
<li><a href="/book/chapter_16.html">16. Using mocks to test external dependencies (and elsewhere)</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_16.html#_before_we_start_getting_the_basic_plumbing_in">16.1. Before we start: getting the basic plumbing in</a></li>
<li><a href="/book/chapter_16.html#_mocking_manually_aka_monkey_patching">16.2. Mocking manually, aka monkey-patching</a></li>
<li><a href="/book/chapter_16.html#_the_python_mock_library">16.3. The Python Mock Library</a></li>
<li><a href="/book/chapter_16.html#_de_spiking_our_custom_authentication_backend">16.4. De-spiking Our Custom Authentication Backend</a></li>
<li><a href="/book/chapter_16.html#_using_mocks_to_test_our_own_code">16.5. Using mocks to test our own code</a></li>
<li><a href="/book/chapter_16.html#_the_moment_of_truth_will_the_ft_pass">16.6. The Moment of Truth:  Will the FT Pass?</a></li>
<li><a href="/book/chapter_16.html#_finishing_off_our_ft_testing_logout">16.7. Finishing Off Our FT, Testing Logout</a></li>
<li><a href="/book/chapter_16.html#_old_content_i_can_t_find_a_place_for">16.8. Old content I can&#8217;t find a place for</a></li>
</ul>
</li>
<li><a href="/book/chapter_17.html">17. Test Fixtures, and Server-Side Debugging</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_17.html#_skipping_the_login_process_by_pre_creating_a_session">17.1. Skipping the Login Process by Pre-creating a Session</a></li>
<li><a href="/book/chapter_17.html#_the_proof_is_in_the_pudding_using_staging_to_catch_final_bugs">17.2. The Proof Is in the Pudding: Using Staging to Catch Final Bugs</a></li>
<li><a href="/book/chapter_17.html#_setting_secret_environment_variables_on_the_server">17.3. Setting secret environment variables on the server</a></li>
<li><a href="/book/chapter_17.html#_adapting_our_ft_to_be_able_to_test_real_emails_via_pop3">17.4. Adapting our FT to be able to test real emails via POP3</a></li>
<li><a href="/book/chapter_17.html#_managing_the_test_database_on_staging">17.5. Managing the Test Database on Staging</a></li>
<li><a href="/book/chapter_17.html#_baking_in_our_logging_code">17.6. Baking In Our Logging Code</a></li>
<li><a href="/book/chapter_17.html#_wrap_up">17.7. Wrap-Up</a></li>
<li><a href="/book/chapter_17.html#_stuff_from_the_old_edition_that_we_might_want_to_save">17.8. Stuff from the old edition that we might want to save</a></li>
</ul>
</li>
<li><a href="/book/chapter_18.html">18. Finishing "My Lists": Outside-In TDD</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_18.html#_the_alternative_inside_out">18.1. The Alternative: "Inside Out"</a></li>
<li><a href="/book/chapter_18.html#_why_prefer_outside_in">18.2. Why Prefer "Outside-In"?</a></li>
<li><a href="/book/chapter_18.html#_the_ft_for_my_lists">18.3. The FT for "My Lists"</a></li>
<li><a href="/book/chapter_18.html#_the_outside_layer_presentation_and_templates">18.4. The Outside Layer: Presentation and Templates</a></li>
<li><a href="/book/chapter_18.html#_moving_down_one_layer_to_view_functions_the_controller">18.5. Moving Down One Layer to View Functions (the Controller)</a></li>
<li><a href="/book/chapter_18.html#_another_pass_outside_in">18.6. Another Pass, Outside-In</a></li>
<li><a href="/book/chapter_18.html#_the_next_requirement_from_the_views_layer_new_lists_should_record_owner">18.7. The Next "Requirement" from the Views Layer: New Lists Should Record Owner</a></li>
<li><a href="/book/chapter_18.html#_moving_down_to_the_model_layer">18.8. Moving Down to the Model Layer</a></li>
</ul>
</li>
<li><a href="/book/chapter_19.html">19. Test Isolation, and "Listening to Your Tests"</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_19.html#_revisiting_our_decision_point_the_views_layer_depends_on_unwritten_models_code">19.1. Revisiting Our Decision Point: The Views Layer Depends on Unwritten Models Code</a></li>
<li><a href="/book/chapter_19.html#_a_first_attempt_at_using_mocks_for_isolation">19.2. A First Attempt at Using Mocks for Isolation</a></li>
<li><a href="/book/chapter_19.html#_listen_to_your_tests_ugly_tests_signal_a_need_to_refactor">19.3. Listen to Your Tests: Ugly Tests Signal a Need to Refactor</a></li>
<li><a href="/book/chapter_19.html#_rewriting_our_tests_for_the_view_to_be_fully_isolated">19.4. Rewriting Our Tests for the View to Be Fully Isolated</a></li>
<li><a href="/book/chapter_19.html#_moving_down_to_the_forms_layer">19.5. Moving Down to the Forms Layer</a></li>
<li><a href="/book/chapter_19.html#_finally_moving_down_to_the_models_layer">19.6. Finally, Moving Down to the Models Layer</a></li>
<li><a href="/book/chapter_19.html#_the_moment_of_truth_and_the_risks_of_mocking">19.7. The Moment of Truth (and the Risks of Mocking)</a></li>
<li><a href="/book/chapter_19.html#_thinking_of_interactions_between_layers_as_contracts">19.8. Thinking of Interactions Between Layers as "Contracts"</a></li>
<li><a href="/book/chapter_19.html#_one_more_test">19.9. One More Test</a></li>
<li><a href="/book/chapter_19.html#_tidy_up_what_to_keep_from_our_integrated_test_suite">19.10. Tidy Up: What to Keep from Our Integrated Test Suite</a></li>
<li><a href="/book/chapter_19.html#_conclusions_when_to_write_isolated_versus_integrated_tests">19.11. Conclusions: When to Write Isolated Versus Integrated Tests</a></li>
</ul>
</li>
<li><a href="/book/chapter_20.html">20. Continuous Integration (CI)</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_20.html#_installing_jenkins">20.1. Installing Jenkins</a></li>
<li><a href="/book/chapter_20.html#_setting_up_our_project">20.2. Setting Up Our Project</a></li>
<li><a href="/book/chapter_20.html#_first_build">20.3. First Build!</a></li>
<li><a href="/book/chapter_20.html#_setting_up_a_virtual_display_so_the_fts_can_run_headless">20.4. Setting Up a Virtual Display so the FTs Can Run Headless</a></li>
<li><a href="/book/chapter_20.html#_taking_screenshots">20.5. Taking Screenshots</a></li>
<li><a href="/book/chapter_20.html#_a_common_selenium_problem_race_conditions">20.6. A Common Selenium Problem: Race Conditions</a></li>
<li><a href="/book/chapter_20.html#_running_our_qunit_javascript_tests_in_jenkins_with_phantomjs">20.7. Running Our QUnit JavaScript Tests in Jenkins with PhantomJS</a></li>
<li><a href="/book/chapter_20.html#_more_things_to_do_with_a_ci_server">20.8. More Things to Do with a CI Server</a></li>
<li><a href="/book/chapter_20.html#_notes_for_latest_jenkins">20.9. Notes for latest jenkins</a></li>
</ul>
</li>
<li><a href="/book/chapter_21.html">21. The Token Social Bit, the Page Pattern, and an Exercise for the Reader</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_21.html#_an_ft_with_multiple_users_and_addcleanup">21.1. An FT with Multiple Users, and addCleanup</a></li>
<li><a href="/book/chapter_21.html#_implementing_the_selenium_interact_wait_pattern">21.2. Implementing the Selenium Interact/Wait Pattern</a></li>
<li><a href="/book/chapter_21.html#_the_page_pattern">21.3. The Page Pattern</a></li>
<li><a href="/book/chapter_21.html#_extend_the_ft_to_a_second_user_and_the_my_lists_page">21.4. Extend the FT to a Second User, and the "My Lists" Page</a></li>
<li><a href="/book/chapter_21.html#_an_exercise_for_the_reader">21.5. An Exercise for the Reader</a></li>
</ul>
</li>
<li><a href="/book/chapter_22.html">22. Fast Tests, Slow Tests, and Hot Lava</a>
<ul class="sectlevel2">
<li><a href="/book/chapter_22.html#_thesis_unit_tests_are_superfast_and_good_besides_that">22.1. Thesis: Unit Tests Are Superfast and Good Besides That</a></li>
<li><a href="/book/chapter_22.html#_the_problems_with_pure_unit_tests">22.2. The Problems with "Pure" Unit Tests</a></li>
<li><a href="/book/chapter_22.html#_synthesis_what_do_we_want_from_our_tests_anyway">22.3. Synthesis: What Do We Want from Our Tests, Anyway?</a></li>
<li><a href="/book/chapter_22.html#_architectural_solutions">22.4. Architectural Solutions</a></li>
<li><a href="/book/chapter_22.html#_conclusion">22.5. Conclusion</a></li>
</ul>
</li>
<li><a href="/book/epilogue.html">23. Obey the Testing Goat!</a>
<ul class="sectlevel2">
<li><a href="/book/epilogue.html#_testing_is_hard">23.1. Testing Is Hard</a></li>
<li><a href="/book/epilogue.html#_remember_to_tip_the_bar_staff">23.2. Remember to Tip the Bar Staff</a></li>
<li><a href="/book/epilogue.html#_don_t_be_a_stranger">23.3. Don&#8217;t Be a Stranger!</a></li>
</ul>
</li>
<li><a href="/book/appendix_I_PythonAnywhere.html">Appendix A: PythonAnywhere</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_I_PythonAnywhere.html#_running_firefox_selenium_sessions_with_xvfb">A.1. Running Firefox Selenium Sessions with Xvfb</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_setting_up_django_as_a_pythonanywhere_web_app">A.2. Setting Up Django as a PythonAnywhere Web App</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_cleaning_up_tmp">A.3. Cleaning Up /tmp</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_screenshots">A.4. Screenshots</a></li>
<li><a href="/book/appendix_I_PythonAnywhere.html#_the_deployment_chapter">A.5. The Deployment Chapter</a></li>
</ul>
</li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html">Appendix B: Django Class-Based Views</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_class_based_generic_views">B.1. Class-Based Generic Views</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_the_home_page_as_a_formview">B.2. The Home Page as a FormView</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_using_form_valid_to_customise_a_createview">B.3. Using form_valid to Customise a CreateView</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_a_more_complex_view_to_handle_both_viewing_and_adding_to_a_list">B.4. A More Complex View to Handle Both Viewing and Adding to a List</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_compare_old_and_new">B.5. Compare Old and New</a></li>
<li><a href="/book/appendix_II_Django_Class-Based_Views.html#_best_practices_for_unit_testing_cbgvs">B.6. Best Practices for Unit Testing CBGVs?</a></li>
</ul>
</li>
<li><a href="/book/appendix_III_provisioning_with_ansible.html">Appendix C: Provisioning with Ansible</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_III_provisioning_with_ansible.html#_installing_system_packages_and_nginx">C.1. Installing System Packages and Nginx</a></li>
<li><a href="/book/appendix_III_provisioning_with_ansible.html#_configuring_gunicorn_and_using_handlers_to_restart_services">C.2. Configuring Gunicorn, and Using Handlers to Restart Services</a></li>
<li><a href="/book/appendix_III_provisioning_with_ansible.html#_what_to_do_next">C.3. What to Do Next</a></li>
</ul>
</li>
<li><a href="/book/appendix_IV_testing_migrations.html">Appendix D: Testing Database Migrations</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_IV_testing_migrations.html#_an_attempted_deploy_to_staging">D.1. An Attempted Deploy to Staging</a></li>
<li><a href="/book/appendix_IV_testing_migrations.html#_running_a_test_migration_locally">D.2. Running a Test Migration Locally</a></li>
<li><a href="/book/appendix_IV_testing_migrations.html#_inserting_a_data_migration">D.3. Inserting a Data Migration</a></li>
<li><a href="/book/appendix_IV_testing_migrations.html#_testing_the_new_migrations_together">D.4. Testing the New Migrations Together</a></li>
<li><a href="/book/appendix_IV_testing_migrations.html#_conclusions">D.5. Conclusions</a></li>
</ul>
</li>
<li><a href="/book/appendix_V_bdd_tools.html">Appendix E: Behaviour-Driven Development (BDD)</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_V_bdd_tools.html#_what_is_bdd">E.1. What is BDD?</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_basic_housekeeping">E.2. Basic Housekeeping</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_writing_an_ft_as_a_feature_using_gherkin_syntax">E.3. Writing an FT as a "Feature" using Gherkin Syntax</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_coding_the_step_functions">E.4. Coding the Step Functions</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_first_step_definition">E.5. First Step Definition</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_setup_and_teardown_equivalents_in_environment_py">E.6. setUp and tearDown Equivalents in environment.py</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_another_run">E.7. Another Run</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_capturing_parameters_in_steps">E.8. Capturing Parameters in Steps</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_comparing_the_inline_style_ft">E.9. Comparing the Inline-Style FT</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_bdd_encourages_structured_test_code">E.10. BDD Encourages Structured Test Code</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_the_page_pattern_as_an_alternative">E.11. The Page Pattern as an Alternative</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_bdd_might_be_less_expressive_than_inline_comments">E.12. BDD Might Be Less Expressive than Inline Comments</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_will_nonprogrammers_write_tests">E.13. Will Nonprogrammers Write Tests?</a></li>
<li><a href="/book/appendix_V_bdd_tools.html#_some_tentative_conclusions">E.14. Some Tentative Conclusions</a></li>
</ul>
</li>
<li><a href="/book/appendix_VI_rest_api.html">Appendix F: Building a REST API: JSON, Ajax, and mocking with JavaScript</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_VI_rest_api.html#_basic_piping">F.1. Basic piping</a></li>
<li><a href="/book/appendix_VI_rest_api.html#_actually_responding_something">F.2. Actually responding something</a></li>
<li><a href="/book/appendix_VI_rest_api.html#_adding_post">F.3. Adding POST</a></li>
<li><a href="/book/appendix_VI_rest_api.html#_testing_the_client_side_with_sinon_js">F.4. Testing the client-side with sinon.js</a></li>
<li><a href="/book/appendix_VI_rest_api.html#_wiring_it_all_up_in_the_template_to_check_it_all_works_so_far">F.5. Wiring it all up in the template to check it all works so far</a></li>
<li><a href="/book/appendix_VI_rest_api.html#_implementing_ajax_post">F.6. Implementing Ajax POST</a></li>
<li><a href="/book/appendix_VI_rest_api.html#_mocking_in_javascript">F.7. Mocking in JavaScript</a></li>
<li><a href="/book/appendix_VI_rest_api.html#_data_validation_an_exercise_for_the_reader">F.8. Data validation.  An exercise for the reader?</a></li>
</ul>
</li>
<li><a href="/book/appendix_VII_DjangoRestFramework.html">Appendix G: Django-Rest-Framework</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_VII_DjangoRestFramework.html#_serializers_well_modelserializers_really">G.1. Serializers (well, ModelSerializers really)</a></li>
<li><a href="/book/appendix_VII_DjangoRestFramework.html#_viewsets_well_modelviewsets_really_and_routers">G.2. Viewsets (well, ModelViewsets really) and routers</a></li>
<li><a href="/book/appendix_VII_DjangoRestFramework.html#_a_different_url_for_post_item">G.3. A different URL for POST item</a></li>
<li><a href="/book/appendix_VII_DjangoRestFramework.html#_adapting_the_client_side">G.4. Adapting the client side</a></li>
</ul>
</li>
<li><a href="/book/appendix_IX_cheat_sheet.html">Appendix H: Cheat Sheet</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_IX_cheat_sheet.html#_initial_project_setup">H.1. Initial Project Setup</a></li>
<li><a href="/book/appendix_IX_cheat_sheet.html#_the_basic_tdd_workflow">H.2. The Basic TDD Workflow</a></li>
<li><a href="/book/appendix_IX_cheat_sheet.html#_moving_beyond_dev_only_testing">H.3. Moving Beyond dev-only Testing</a></li>
<li><a href="/book/appendix_IX_cheat_sheet.html#_general_testing_best_practices">H.4. General Testing Best Practices</a></li>
<li><a href="/book/appendix_IX_cheat_sheet.html#_selenium_functional_testing_best_practices">H.5. Selenium/Functional Testing Best Practices</a></li>
<li><a href="/book/appendix_IX_cheat_sheet.html#_outside_in_test_isolation_versus_integrated_tests_and_mocking">H.6. Outside-In, Test Isolation Versus Integrated Tests, and Mocking</a></li>
</ul>
</li>
<li><a href="/book/appendix_X_what_to_do_next.html">Appendix I: What to Do Next</a>
<ul class="sectlevel2">
<li><a href="/book/appendix_X_what_to_do_next.html#_notifications_both_on_the_site_and_by_email">I.1. Notifications&#8212;&#8203;Both on the Site and by Email</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_switch_to_postgres">I.2. Switch to Postgres</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_run_your_tests_against_different_browsers">I.3. Run Your Tests Against Different Browsers</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_404_and_500_tests">I.4. 404 and 500 Tests</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_the_django_admin_site">I.5. The Django Admin Site</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_write_some_security_tests">I.6. Write Some Security Tests</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_test_for_graceful_degradation">I.7. Test for Graceful Degradation</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_caching_and_performance_testing">I.8. Caching and Performance Testing</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_javascript_mvc_frameworks">I.9. JavaScript MVC Frameworks</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_async_and_websockets">I.10. Async and Websockets</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_switch_to_using_py_test">I.11. Switch to Using py.test</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_check_out_coverage_py">I.12. Check out coverage.py</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_client_side_encryption">I.13. Client-Side Encryption</a></li>
<li><a href="/book/appendix_X_what_to_do_next.html#_your_suggestion_here">I.14. Your Suggestion Here</a></li>
</ul>
</li>
<li><a href="/book/bibliography.html">Appendix J: Bibliography</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="appendix-rest-api-backend">Appendix A: Building a REST API: JSON, Ajax, and mocking with JavaScript</h2>
<div class="sectionbody">
<div class="paragraph">
<p>

WARNING: Chapter under construction.  Apologies, it&#8217;s in pretty telegraphic style for now.</p>
</div>
<div class="paragraph">
<p>Plan:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All assumes an existing list</p>
</li>
<li>
<p>new URL structure /api/lists/{id}/</p>
</li>
<li>
<p>GET gives you details of a list (including all its items)</p>
</li>
<li>
<p>POST lets you add an item</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Code example start from chapter 21.</p>
</div>
<div class="sect2">
<h3 id="_basic_piping">Basic piping</h3>
<div class="paragraph">
<p>Start with a unit test that we can return a JSON response, status 200, from a URL</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">json</span>
<span class="keyword">from</span> <span class="include">django.test</span> <span class="keyword">import</span> <span class="include">TestCase</span>

<span class="keyword">from</span> <span class="include">lists.models</span> <span class="keyword">import</span> <span class="include">List</span>, <span class="include">Item</span>


<span class="keyword">class</span> <span class="class">APIGetListItemsTest</span>(TestCase):
    base_url = <span class="string"><span class="delimiter">'</span><span class="content">/api/lists/{}/</span><span class="delimiter">'</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="keyword">def</span> <span class="function">test_get_returns_json_200</span>(<span class="predefined-constant">self</span>):
        list_ = List.objects.create()
        response = <span class="predefined-constant">self</span>.client.get(<span class="predefined-constant">self</span>.base_url.format(list_.id))
        <span class="predefined-constant">self</span>.assertEqual(response.status_code, <span class="integer">200</span>)
        <span class="predefined-constant">self</span>.assertEqual(response[<span class="string"><span class="delimiter">'</span><span class="content">content-type</span><span class="delimiter">'</span></span>], <span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is a new pattern we&#8217;ll introduce for this chapter, it&#8217;ll help
us to remove duplication of hard-coded urls in this test.  We could
even have used a call to <code>reverse</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And we can get that together in 3 lines</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.http</span> <span class="keyword">import</span> <span class="include">HttpResponse</span>

<span class="keyword">def</span> <span class="function">list</span>(request, list_id):
    <span class="keyword">return</span> HttpResponse(content_type=<span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And wire up a couple of urls files:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">[...]
<span class="keyword">from</span> <span class="include">lists</span> <span class="keyword">import</span> <span class="include">api_urls</span>
<span class="keyword">from</span> <span class="include">lists</span> <span class="keyword">import</span> <span class="include">urls</span> <span class="keyword">as</span> list_urls

urlpatterns = [
    url(<span class="string"><span class="modifier">r</span><span class="delimiter">'</span><span class="content">^$</span><span class="delimiter">'</span></span>, list_views.home_page, name=<span class="string"><span class="delimiter">'</span><span class="content">home</span><span class="delimiter">'</span></span>),
    url(<span class="string"><span class="modifier">r</span><span class="delimiter">'</span><span class="content">^lists/</span><span class="delimiter">'</span></span>, include(list_urls)),
    url(<span class="string"><span class="modifier">r</span><span class="delimiter">'</span><span class="content">^accounts/</span><span class="delimiter">'</span></span>, include(accounts_urls)),
    url(<span class="string"><span class="modifier">r</span><span class="delimiter">'</span><span class="content">^api/</span><span class="delimiter">'</span></span>, include(api_urls)),
]</code></pre>
</div>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/api_urls.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">django.conf.urls</span> <span class="keyword">import</span> <span class="include">url</span>
<span class="keyword">from</span> <span class="include">lists</span> <span class="keyword">import</span> <span class="include">api</span>

urlpatterns = [
    url(<span class="string"><span class="modifier">r</span><span class="delimiter">'</span><span class="content">^lists/(</span><span class="content">\d</span><span class="content">+)/$</span><span class="delimiter">'</span></span>, api.list, name=<span class="string"><span class="delimiter">'</span><span class="content">api_list</span><span class="delimiter">'</span></span>),
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The tests should pass, and we have the basic piping together.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python manage.py test lists</strong>
Creating test database for alias 'default'...
..................................................
 ---------------------------------------------------------------------
Ran 50 tests in 0.177s

OK</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_actually_responding_something">Actually responding something</h3>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">def</span> <span class="function">test_get_returns_items_for_correct_list</span>(<span class="predefined-constant">self</span>):
        other_list = List.objects.create()
        Item.objects.create(list=other_list, text=<span class="string"><span class="delimiter">'</span><span class="content">item 1</span><span class="delimiter">'</span></span>)
        our_list = List.objects.create()
        item1 = Item.objects.create(list=our_list, text=<span class="string"><span class="delimiter">'</span><span class="content">item 1</span><span class="delimiter">'</span></span>)
        item2 = Item.objects.create(list=our_list, text=<span class="string"><span class="delimiter">'</span><span class="content">item 2</span><span class="delimiter">'</span></span>)
        response = <span class="predefined-constant">self</span>.client.get(<span class="predefined-constant">self</span>.base_url.format(our_list.id))
        <span class="predefined-constant">self</span>.assertEqual(
            json.loads(response.content.decode(<span class="string"><span class="delimiter">'</span><span class="content">utf8</span><span class="delimiter">'</span></span>)),  <i class="conum" data-value="1"></i><b>(1)</b>
            [
                {<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>: item1.id, <span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>: item1.text},
                {<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>: item2.id, <span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>: item2.text},
            ]
        )</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the main thing to notice about this test&#8201;&#8212;&#8201;we expect our
response to be in JSON format.  We use <code>json.loads()</code> because testing
python objects is easier than messing about with raw JSON strings.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And the implementation, conversely, uses <code>json.dumps()</code></p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">json</span>
<span class="keyword">from</span> <span class="include">django.http</span> <span class="keyword">import</span> <span class="include">HttpResponse</span>
<span class="keyword">from</span> <span class="include">lists.models</span> <span class="keyword">import</span> <span class="include">List</span>


<span class="keyword">def</span> <span class="function">list</span>(request, list_id):
    list_ = List.objects.get(id=list_id)
    item_dicts = [
        {<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>: item.id, <span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>: item.text}
        <span class="keyword">for</span> item <span class="keyword">in</span> list_.item_set.all()
    ]
    <span class="keyword">return</span> HttpResponse(
        json.dumps(item_dicts),
        content_type=<span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>
    )</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_post">Adding POST</h3>
<div class="paragraph">
<p>We&#8217;ll start with the "happy path":</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">def</span> <span class="function">test_POSTing_a_new_item</span>(<span class="predefined-constant">self</span>):
        list_ = List.objects.create()
        response = <span class="predefined-constant">self</span>.client.post(
            <span class="predefined-constant">self</span>.base_url.format(list_.id),
            {<span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">new item</span><span class="delimiter">'</span></span>},
        )
        <span class="predefined-constant">self</span>.assertEqual(response.status_code, <span class="integer">201</span>)
        new_item = list_.item_set.get()
        <span class="predefined-constant">self</span>.assertEqual(new_item.text, <span class="string"><span class="delimiter">'</span><span class="content">new item</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the implementation is similarly simple&#8201;&#8212;&#8201;basically
the same was what we do in our normal view, but we return
a 201 rather than a redirect:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">def</span> <span class="function">list</span>(request, list_id):
    list_ = List.objects.get(id=list_id)
    <span class="keyword">if</span> request.method == <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>:
        Item.objects.create(list=list_, text=request.POST[<span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>])
        <span class="keyword">return</span> HttpResponse(status=<span class="integer">201</span>)
    [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that should get us started.</p>
</div>
</div>
<div class="sect2">
<h3 id="_testing_the_client_side_with_sinon_js">Testing the client-side with sinon.js</h3>
<div class="paragraph">
<p>Don&#8217;t even <em>think</em> of doing Ajax testing without a mocking library.  Different test frameworks
and tools have their own, sinon is generic.  It also provides JavaScript mocks, as we&#8217;ll see&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><a href="http://sinonjs.org/" class="bare">http://sinonjs.org/</a></p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/tests/tests.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">  <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">qunit-fixture</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;form&gt;</span>
      <span class="tag">&lt;input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">has-error</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>Error text<span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;/form&gt;</span>
    <span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">id_list_table</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;/table&gt;</span>
  <span class="tag">&lt;/div&gt;</span>

  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">"</span><span class="content">../jquery-3.1.1.min.js</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">"</span><span class="content">../list.js</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">"</span><span class="content">qunit-2.0.1.js</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">"</span><span class="content">sinon-1.17.6.js</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>  <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="tag">&lt;script&gt;</span>
<span class="inline"><span class="comment">/* global sinon */</span>
<span class="keyword">var</span> server;
QUnit.testStart(<span class="keyword">function</span> () {
  server = sinon.fakeServer.create();  <i class="conum" data-value="3"></i><b>(3)</b>
});
QUnit.testDone(<span class="keyword">function</span> () {
  server.restore();  <i class="conum" data-value="3"></i><b>(3)</b>
});

QUnit.test(<span class="string"><span class="delimiter">"</span><span class="content">errors should be hidden on keypress</span><span class="delimiter">"</span></span>, <span class="keyword">function</span> (assert) {
[...]


QUnit.test(<span class="string"><span class="delimiter">"</span><span class="content">should get items by ajax on initialize</span><span class="delimiter">"</span></span>, <span class="keyword">function</span> (assert) {
  <span class="keyword">var</span> url = <span class="string"><span class="delimiter">'</span><span class="content">/getitems/</span><span class="delimiter">'</span></span>;
  window.Superlists.initialize(url);

  assert.equal(server.requests.length, <span class="integer">1</span>); <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="keyword">var</span> request = server.requests[<span class="integer">0</span>];
  assert.equal(request.url, url);
  assert.equal(request.method, <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>);
});</span>

  <span class="tag">&lt;/script&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We add a new item to the fixture div to represent our list table</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We import <em>sinon.js</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>testStart</code> and <code>testDone</code> are the QUnit equivalents of <code>setUp</code> and
<code>tearDown</code>.  We use them to tell sinon to start up its ajax testing
tool, the <code>fakeServer</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>That lets us make assertions about any ajax requests that were made
by our code.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And we can get that passing with this</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/lists.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="diff"><span class="line change"><span class="change">@@</span> -1,6 +1,10 <span class="change">@@</span></span>
 window.Superlists = {};
<span class="line delete"><span class="delete">-</span>window.Superlists.initialize = function () {</span>
<span class="line insert"><span class="insert">+</span>window.Superlists.initialize = function (<span class="eyecatcher">url</span>) {</span>
   $('input[name="text"]').on('keypress', function () {
     $('.has-error').hide();
   });
<span class="line insert"><span class="insert">+</span></span>
<span class="line insert"><span class="insert">+</span>  $.get(url);</span>
<span class="line insert"><span class="insert">+</span></span>
 };</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Took 35ms to run 5 tests. 5 passed, 0 failed.</pre>
</div>
</div>
<div class="paragraph">
<p>But what about the async part, where we deal with the response?</p>
</div>
<div class="sect3">
<h4 id="_sinon_and_testing_the_async_part_of_ajax">Sinon and testing the async part of Ajax</h4>
<div class="paragraph">
<p>This is a major reason to love sinon.  <code>server.respond()</code> allows us to exactly
control the flow of the async code.</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/tests/tests.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">QUnit.test("should fill in lists table from ajax response", function (assert) {
  var url = '/getitems/';
  var responseData = [
    {'id': 101, 'text': 'item 1 text'},
    {'id': 102, 'text': 'item 2 text'},
  ];
  server.respondWith('GET', url, [
    200, {"Content-Type": "application/json"}, JSON.stringify(responseData) <i class="conum" data-value="1"></i><b>(1)</b>
  ]);
  window.Superlists.initialize(url); <i class="conum" data-value="2"></i><b>(2)</b>

  server.respond(); <i class="conum" data-value="3"></i><b>(3)</b>

  var rows = $('#id_list_table tr');
  assert.equal(rows.length, 2);
  var row1 = $('#id_list_table tr:first-child td');
  console.log(row1);
  assert.equal(row1.text(), '1: item 1 text');
  var row2 = $('#id_list_table tr:last-child td');
  assert.equal(row2.text(), '2: item 2 text');
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We set up some response data for sinon to use, telling it what status code, headers,
and importantly what kind of response JSON we want to simulate coming from the
server.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Then we call the function under test</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Here&#8217;s the magic.  <em>Then</em> we can call <code>server.respond()</code>, whenever we like, and that
will kick off all the async part of the Ajax loop&#8201;&#8212;&#8201;all the callbacks we&#8217;d assigned
to deal with the response.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And then we can quietly check whether our Ajax callback has actually populated our table
with the new list rows&#8230;&#8203;</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We&#8217;re lucky because of the way jQuery registers its callbacks for Ajax when we use
    the <code>.done()</code> function.  If you want to switch to the more standard JavaScript Promise
    <code>.then()</code> callback, we get one more level of async.  QUnit does have a way of dealing with
    that.  Check out the docs for the <a href="http://api.qunitjs.com/async/">async</a> function.  Other test
    frameworks have something similar.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wiring_it_all_up_in_the_template_to_check_it_all_works_so_far">Wiring it all up in the template to check it all works so far</h3>
<div class="paragraph">
<p>We break it first, by removing the list table <code>{% for %}</code> loop from the
lists.html template.</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/list.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="diff"><span class="line change"><span class="change">@@</span> -6,9 +6,6 <span class="change">@@</span></span>

 {% block table %}
     &lt;table id="id_list_table" class="table"&gt;
<span class="line delete"><span class="delete">-</span>        {% for item in list.item_set.all %}</span>
<span class="line delete"><span class="delete">-</span>            &lt;tr&gt;&lt;td&gt;{{ forloop.counter }}: {{ item.text }}&lt;/td&gt;&lt;/tr&gt;</span>
<span class="line delete"><span class="delete">-</span>        {% endfor %}</span>
     &lt;/table&gt;

     {% if list.owner %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Yep, that breaks the FT</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python manage.py test functional_tests.test_simple_list_creation</strong>
[...]
  File "/workspace/functional_tests/test_simple_list_creation.py", line 35, in
test_can_start_a_list_and_retrieve_it_later
    self.check_for_row_in_list_table('1: Buy peacock feathers')
  File "/workspace/functional_tests/base.py", line 109, in
check_for_row_in_list_table
    self.assertIn(row_text, [row.text for row in rows])
AssertionError: '1: Buy peacock feathers' not found in []

FAILED (failures=1)</pre>
</div>
</div>
<div class="paragraph">
<p>We then add a block called <code>{% scripts %}</code> to the base template to allow us
to override it selectively in <em>list.html</em>:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/base.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">"</span><span class="content">/static/list.js</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>

    {% block scripts %}
      <span class="tag">&lt;script&gt;</span>
<span class="inline"><span class="predefined">$</span>(document).ready(<span class="keyword">function</span> () {
  window.Superlists.initialize();
});</span>
      <span class="tag">&lt;/script&gt;</span>
    {% endblock scripts %}

  <span class="tag">&lt;/body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And now in <em>list.html</em> we add a slightly different call to <code>initialize</code>, with
the correct url:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/list.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">{% block scripts %}
  <span class="tag">&lt;script&gt;</span>
<span class="inline"><span class="predefined">$</span>(document).ready(<span class="keyword">function</span> () {
  <span class="keyword">var</span> url = <span class="string"><span class="delimiter">"</span><span class="content">{% url 'api_list' list.id %}</span><span class="delimiter">"</span></span>;
  window.Superlists.initialize(url);
});</span>
  <span class="tag">&lt;/script&gt;</span>
{% endblock scripts %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And guess what? The test passes!</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python manage.py test functional_tests.test_simple_list_creation</strong>
[...]
.
 ---------------------------------------------------------------------
Ran 1 test in 11.730s

OK
Destroying test database for alias 'default'...</pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s a pretty good start!</p>
</div>
<div class="paragraph">
<p>Now if you run all the FTs you&#8217;ll see we&#8217;ve got some failures in
other FTs, so we&#8217;ll have to deal with them. Also, we&#8217;re using an old-fashioned
POST from the form, with page refresh, so we&#8217;re not at our trendy hipster
single-page app yet.  But we&#8217;ll get there!</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_ajax_post">Implementing Ajax POST</h3>
<div class="paragraph">
<p>First we give our list form an <code>id</code> so we can pick it up
in our JS:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/base.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="diff"><span class="line change"><span class="change">@@</span> -56,7 +56,7 <span class="change">@@</span></span>
           &lt;div class="text-center"&gt;
             &lt;h1&gt;{% block header_text %}{% endblock %}&lt;/h1&gt;
             {% block list_form %}
<span class="line delete"><span class="delete">-</span>              &lt;form method="POST" action="{% block form_action %}{% endblock %}"&gt;</span>
<span class="line insert"><span class="insert">+</span>              &lt;form <span class="eyecatcher">id="id_item_form" </span>method="POST" action="{% block form_action %}{% endblock %}"&gt;</span>
                 {{ form.text }}
                 {% csrf_token %}
                 {% if form.errors %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next tweak the fixture in our js test:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/tests/tests.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="diff"><span class="line change"><span class="change">@@</span> -9,8 +9,9 <span class="change">@@</span></span>
 &lt;body&gt;
   &lt;div id="qunit"&gt;&lt;/div&gt;
   &lt;div id="qunit-fixture"&gt;
<span class="line delete"><span class="delete">-</span>    &lt;form&gt;</span>
<span class="line insert"><span class="insert">+</span>    &lt;form<span class="eyecatcher"> id="id_item_form"</span>&gt;</span>
       &lt;input name="text" /&gt;
<span class="line insert"><span class="insert">+</span>      &lt;input type="hidden" name="csrfmiddlewaretoken" value="tokey" /&gt;</span>
       &lt;div class="has-error"&gt;Error text&lt;/div&gt;
     &lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here&#8217;s our test:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/tests/tests.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">QUnit.test(<span class="string"><span class="delimiter">"</span><span class="content">should intercept form submit and do ajax post</span><span class="delimiter">"</span></span>, <span class="keyword">function</span> (assert) {
  <span class="keyword">var</span> url = <span class="string"><span class="delimiter">'</span><span class="content">/listitemsapi/</span><span class="delimiter">'</span></span>;
  window.Superlists.initialize(url);

  <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#id_item_form input[name="text"]</span><span class="delimiter">'</span></span>).val(<span class="string"><span class="delimiter">'</span><span class="content">user input</span><span class="delimiter">'</span></span>);  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#id_item_form input[name="csrfmiddlewaretoken"]</span><span class="delimiter">'</span></span>).val(<span class="string"><span class="delimiter">'</span><span class="content">tokeney</span><span class="delimiter">'</span></span>);  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#id_item_form</span><span class="delimiter">'</span></span>).submit();  <i class="conum" data-value="1"></i><b>(1)</b>

  assert.equal(server.requests.length, <span class="integer">2</span>);  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="keyword">var</span> request = server.requests[<span class="integer">1</span>];
  assert.equal(request.url, url);
  assert.equal(request.method, <span class="string"><span class="delimiter">"</span><span class="content">POST</span><span class="delimiter">"</span></span>);
  assert.equal(
    request.requestBody,
    <span class="string"><span class="delimiter">'</span><span class="content">text=user+input&amp;csrfmiddlewaretoken=tokeney</span><span class="delimiter">'</span></span>  <i class="conum" data-value="3"></i><b>(3)</b>
  );
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We simulate the user filling in the form and hitting submit.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We now expect that there should be a second Ajax request (the
first one is the GET for the list items table).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We check our POST <code>requestBody</code>.  As you can see, it&#8217;s
URL-encoded, which isn&#8217;t the most value to test, but it&#8217;s still just about
readable.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And here&#8217;s how we implement it:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/list.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">    [...]
      <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#id_list_table</span><span class="delimiter">'</span></span>).html(rows);
    });

    <span class="keyword">var</span> form = <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#id_item_form</span><span class="delimiter">'</span></span>);
    form.on(<span class="string"><span class="delimiter">'</span><span class="content">submit</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(event) {
      event.preventDefault();
      <span class="predefined">$</span>.post(url, {
        <span class="key"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>: form.find(<span class="string"><span class="delimiter">'</span><span class="content">input[name="text"]</span><span class="delimiter">'</span></span>).val(),
        <span class="key"><span class="delimiter">'</span><span class="content">csrfmiddlewaretoken</span><span class="delimiter">'</span></span>: form.find(<span class="string"><span class="delimiter">'</span><span class="content">input[name="csrfmiddlewaretoken"]</span><span class="delimiter">'</span></span>).val(),
      });
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p>That get our JS tests passing but it breaks our FTs, because, although we&#8217;re
doing our POST ok, we&#8217;re not updating the page after the POST to show the new
list item:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  File "/workspace/superlists/functional_tests/base.py", line 109, in check_for_row_in_list_table
    self.assertIn(row_text, [row.text for row in rows])
AssertionError: '2: Use peacock feathers to make a fly' not found in ['1: Buy peacock feathers']</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mocking_in_javascript">Mocking in JavaScript</h3>
<div class="paragraph">
<p>We want our client-side to update the table of items after the Ajax POST completes.
Essentially it&#8217;ll do the same work as we do as soon as the page loads, retrieving
the current list of items from the server, and filling in the item table.</p>
</div>
<div class="paragraph">
<p>Sounds like a helper function is in order!</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/list.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">window.Superlists = {};

window.Superlists.<span class="function">updateItems</span> = <span class="keyword">function</span> (url) {
  <span class="predefined">$</span>.get(url).done(<span class="keyword">function</span> (response) {
    <span class="keyword">var</span> rows = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="integer">0</span>; i&lt;response.length; i++) {
      <span class="keyword">var</span> item = response[i];
      rows += <span class="string"><span class="delimiter">'</span><span class="content">\n</span><span class="content">&lt;tr&gt;&lt;td&gt;</span><span class="delimiter">'</span></span> + (i+<span class="integer">1</span>) + <span class="string"><span class="delimiter">'</span><span class="content">: </span><span class="delimiter">'</span></span> + item.text + <span class="string"><span class="delimiter">'</span><span class="content">&lt;/td&gt;&lt;/tr&gt;</span><span class="delimiter">'</span></span>;
    }
    <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#id_list_table</span><span class="delimiter">'</span></span>).html(rows);
  });
};

window.Superlists.<span class="function">initialize</span> = <span class="keyword">function</span> (url) {
  <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">input[name="text"]</span><span class="delimiter">'</span></span>).on(<span class="string"><span class="delimiter">'</span><span class="content">keypress</span><span class="delimiter">'</span></span>, <span class="keyword">function</span> () {
    <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">.has-error</span><span class="delimiter">'</span></span>).hide();
  });

  <span class="keyword">if</span> (url) {
    window.Superlists.updateItems(url);

    <span class="keyword">var</span> form = <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#id_item_form</span><span class="delimiter">'</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>That was just a refactor, we check the JS tests all still pass:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Took 46ms to run 11 tests. 11 passed, 0 failed.</pre>
</div>
</div>
<div class="paragraph">
<p>Now how to test that our Ajax POST calls <code>updateItems</code> on POST success?  We
don&#8217;t want to dumbly duplicate the code that simulates a server response
and checks the items table manually&#8230;&#8203;   How about a Mock?</p>
</div>
<div class="paragraph">
<p>First we set up a thing called a "sandbox".  It will keep track of all
the mocks we create, and make sure to un-monkeypatch all the things that
have been mocked after each test.</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/tests/tests.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">var server, sandbox;
QUnit.testStart(function () {
  server = sinon.fakeServer.create();
  sandbox = sinon.sandbox.create();
});
QUnit.testDone(function () {
  server.restore();
  sandbox.restore(); <i class="conum" data-value="1"></i><b>(1)</b>
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This <code>.restore()</code> is the important part, that undoes all the
mocking we&#8217;ve done in each test.</td>
</tr>
</table>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/tests/tests.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">QUnit.test("should call updateItems after successful post", function (assert) {
  var url = '/listitemsapi/';
  window.Superlists.initialize(url); <i class="conum" data-value="1"></i><b>(1)</b>
  var response = [
    201,
    {"Content-Type": "application/json"},
    JSON.stringify({}),
  ];
  server.respondWith('POST', url, response); <i class="conum" data-value="1"></i><b>(1)</b>
  $('#id_item_form input[name="text"]').val('user input');
  $('#id_item_form input[name="csrfmiddlewaretoken"]').val('tokeney');
  $('#id_item_form').submit();

  sandbox.spy(window.Superlists, 'updateItems');  <i class="conum" data-value="2"></i><b>(2)</b>
  server.respond();  <i class="conum" data-value="2"></i><b>(2)</b>

  assert.equal(
    window.Superlists.updateItems.lastCall.args,  <i class="conum" data-value="3"></i><b>(3)</b>
    url
  );
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>First important thing to notice:  We only set up our server response
<em>after</em> we do the initialize.  We want this to be the response to the
POST request that happens on form submit, not the response to the
initial GET request (remember our lesson from chapter 13?  On of the most
challenging things about JS testing is controlling the order of execution)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Similarly, we only start mocking our helper function <em>after</em> we know the
first call for the initial GET has already happened.  The <code>sandbox.spy</code> call
is what does the job that <code>patch</code> does in Python tests.  It replaces the given
object with a mock version.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>our <code>updateItems</code> function has now grown some mocky extra attributes, like
<code>lastCall</code> and <code>lastCall.args</code>, which are like the Python mock&#8217;s <code>call_args</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To get it passing, we first make a deliberate mistake, to check our tests really
do test what we think they do:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/lists.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">      <span class="predefined">$</span>.post(url, {
        <span class="key"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>: form.find(<span class="string"><span class="delimiter">'</span><span class="content">input[name="text"]</span><span class="delimiter">'</span></span>).val(),
        <span class="key"><span class="delimiter">'</span><span class="content">csrfmiddlewaretoken</span><span class="delimiter">'</span></span>: form.find(<span class="string"><span class="delimiter">'</span><span class="content">input[name="csrfmiddlewaretoken"]</span><span class="delimiter">'</span></span>).val(),
      }).done(<span class="keyword">function</span> () {
        window.Superlists.updateItems();
      });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Yep, we&#8217;re almost there but not quite:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Test failed: should call updateItems after successful post
    Failed assertion: expected: /listitemsapi/, but was:
file:///workspace/superlists/lists/static/tests/tests.html:120:15</pre>
</div>
</div>
<div class="paragraph">
<p>And we fix it thusly:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/lists.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">      }).done(<span class="keyword">function</span> () {
        window.Superlists.updateItems(url);
      });</code></pre>
</div>
</div>
<div class="paragraph">
<p>And our FT passes!  or at least one of them does, the others have problems,
we&#8217;ll come back to them later</p>
</div>
<div class="paragraph">
<p>First, I&#8217;m not happy until we&#8217;ve seen through this refactor, and made
our unit tests match the code a little more:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/tests/tests.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="diff"><span class="change"><span class="change">@@</span> -50,9 +50,19 <span class="change">@@</span></span> QUnit.testDone(function () {
 });


<span class="line delete"><span class="delete">-</span>QUnit.test("should <span class="eyecatcher">get items by ajax</span> on initialize", function (assert) {</span>
<span class="line insert"><span class="insert">+</span>QUnit.test("should <span class="eyecatcher">call updateItems</span> on initialize", function (assert) {</span>
   var url = '/getitems/';
<span class="line insert"><span class="insert">+</span>  sandbox.spy(window.Superlists, 'updateItems');</span>
   window.Superlists.initialize(url);
<span class="line insert"><span class="insert">+</span>  assert.equal(</span>
<span class="line insert"><span class="insert">+</span>    window.Superlists.updateItems.lastCall.args,</span>
<span class="line insert"><span class="insert">+</span>    url</span>
<span class="line insert"><span class="insert">+</span>  );</span>
<span class="line insert"><span class="insert">+</span>});</span>
<span class="line insert"><span class="insert">+</span></span>
<span class="line insert"><span class="insert">+</span>QUnit.test("updateItems should get correct url by ajax", function (assert) {</span>
<span class="line insert"><span class="insert">+</span>  var url = '/getitems/';</span>
<span class="line insert"><span class="insert">+</span>  window.Superlists.updateItems(url);</span>

   assert.equal(server.requests.length, 1);
   var request = server.requests[0];
<span class="change"><span class="change">@@</span> -60,7 +70,7 <span class="change">@@</span></span> QUnit.test("should get items by ajax on initialize", function (assert) {
   assert.equal(request.method, 'GET');
 });

<span class="line delete"><span class="delete">-</span>QUnit.test("should fill in lists table from ajax response", function (assert) {</span>
<span class="line insert"><span class="insert">+</span>QUnit.test("<span class="eyecatcher">updateItems </span>should fill in lists table from ajax response", function (assert) {</span>
   var url = '/getitems/';
   var responseData = [
     {'id': 101, 'text': 'item 1 text'},
<span class="change"><span class="change">@@</span> -69,7 +79,7 <span class="change">@@</span></span> QUnit.test("should fill in lists table from ajax response", function (assert) {
   server.respondWith('GET', url, [
     200, {"Content-Type": "application/json"}, JSON.stringify(responseData)
   ]);
<span class="line delete"><span class="delete">-</span>  window.Superlists.<span class="eyecatcher">initialize</span>(url);</span>
<span class="line insert"><span class="insert">+</span>  window.Superlists.<span class="eyecatcher">updateItems</span>(url);</span>

   server.respond();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_data_validation_an_exercise_for_the_reader">Data validation.  An exercise for the reader?</h3>
<div class="paragraph">
<p>IF you do a full test run, you should find two FTs are failing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ *python manage.py test *
[...]
ERROR: test_cannot_add_empty_list_items
(functional_tests.test_list_item_validation.ItemValidationTest)
[...]
ERROR: test_cannot_add_duplicate_items
(functional_tests.test_list_item_validation.ItemValidationTest)</pre>
</div>
</div>
<div class="paragraph">
<p>I won&#8217;t spell this all out for you, but here&#8217;s at least the unit
tests you&#8217;ll need:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/tests/test_api.py</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">def</span> <span class="function">post_empty_input</span>(<span class="predefined-constant">self</span>):
        list_ = List.objects.create()
        <span class="keyword">return</span> <span class="predefined-constant">self</span>.client.post(
            <span class="predefined-constant">self</span>.base_url.format(list_.id),
            data={<span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>}
        )


    <span class="keyword">def</span> <span class="function">test_for_invalid_input_nothing_saved_to_db</span>(<span class="predefined-constant">self</span>):
        <span class="predefined-constant">self</span>.post_empty_input()
        <span class="predefined-constant">self</span>.assertEqual(Item.objects.count(), <span class="integer">0</span>)


    <span class="keyword">def</span> <span class="function">test_for_invalid_input_returns_error_code</span>(<span class="predefined-constant">self</span>):
        response = <span class="predefined-constant">self</span>.post_empty_input()
        <span class="predefined-constant">self</span>.assertEqual(response.status_code, <span class="integer">400</span>)
        <span class="predefined-constant">self</span>.assertEqual(
            json.loads(response.content.decode(<span class="string"><span class="delimiter">'</span><span class="content">utf8</span><span class="delimiter">'</span></span>)),
            {<span class="string"><span class="delimiter">'</span><span class="content">error</span><span class="delimiter">'</span></span>: EMPTY_ITEM_ERROR}
        )


    <span class="keyword">def</span> <span class="function">test_duplicate_items_error</span>(<span class="predefined-constant">self</span>):
        list_ = List.objects.create()
        <span class="predefined-constant">self</span>.client.post(<span class="predefined-constant">self</span>.base_url.format(list_.id), data={<span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">thing</span><span class="delimiter">'</span></span>})
        response = <span class="predefined-constant">self</span>.client.post(<span class="predefined-constant">self</span>.base_url.format(list_.id), data={<span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">thing</span><span class="delimiter">'</span></span>})
        <span class="predefined-constant">self</span>.assertEqual(response.status_code, <span class="integer">400</span>)
        <span class="predefined-constant">self</span>.assertEqual(
            json.loads(response.content.decode(<span class="string"><span class="delimiter">'</span><span class="content">utf8</span><span class="delimiter">'</span></span>)),
            {<span class="string"><span class="delimiter">'</span><span class="content">error</span><span class="delimiter">'</span></span>: DUPLICATE_ITEM_ERROR}
        )</code></pre>
</div>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/static/tests/tests.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">QUnit.test(<span class="string"><span class="delimiter">"</span><span class="content">should display errors on post failure</span><span class="delimiter">"</span></span>, function (<span class="keyword">assert</span>) {
  var url = <span class="string"><span class="delimiter">'</span><span class="content">/listitemsapi/</span><span class="delimiter">'</span></span>;
  window.Superlists.initialize(url);
  server.respondWith(<span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>, url, [
    <span class="integer">400</span>,
    {<span class="string"><span class="delimiter">"</span><span class="content">Content-Type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">application/json</span><span class="delimiter">"</span></span>},
    JSON.stringify({<span class="string"><span class="delimiter">'</span><span class="content">error</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">something is amiss</span><span class="delimiter">'</span></span>})
  ]);
  <span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">.has-error</span><span class="delimiter">'</span></span>).hide();

  <span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#id_item_form</span><span class="delimiter">'</span></span>).submit();
  server.respond();

  <span class="keyword">assert</span>.equal(<span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">.has-error</span><span class="delimiter">'</span></span>).is(<span class="string"><span class="delimiter">'</span><span class="content">:visible</span><span class="delimiter">'</span></span>), true);
  <span class="keyword">assert</span>.equal(<span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">.has-error .help-block</span><span class="delimiter">'</span></span>).text(), <span class="string"><span class="delimiter">'</span><span class="content">something is amiss</span><span class="delimiter">'</span></span>);
});

QUnit.test(<span class="string"><span class="delimiter">"</span><span class="content">should hide errors on post success</span><span class="delimiter">"</span></span>, function (<span class="keyword">assert</span>) {
    [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you&#8217;ll want some modifications to <em>base.html</em> to make it compatible with
both displaying Django errors (which the home page still uses for now) and
errors from JavaScript:</p>
</div>
<div class="listingblock sourcecode">
<div class="title">lists/templates/base.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="diff"><span class="line change"><span class="change">@@</span> -12,6 +12,7 <span class="change">@@</span></span>

   &lt;body&gt;
     &lt;div class="container"&gt;
<span class="line insert"><span class="insert">+</span></span>
       &lt;nav class="navbar navbar-default" role="navigation"&gt;
         &lt;div class="container-fluid"&gt;
           &lt;a class="navbar-brand" href="/"&gt;Superlists&lt;/a&gt;
<span class="line change"><span class="change">@@</span> -55,17 +56,21 <span class="change">@@</span></span>
         &lt;div class="col-md-6 col-md-offset-3 jumbotron"&gt;
           &lt;div class="text-center"&gt;
             &lt;h1&gt;{% block header_text %}{% endblock %}&lt;/h1&gt;
<span class="line insert"><span class="insert">+</span></span>
             {% block list_form %}
             &lt;form id="id_item_form" method="POST" action="{% block form_action %}{% endblock %}"&gt;
               {{ form.text }}
               {% csrf_token %}
<span class="line delete"><span class="delete">-</span>                {% if form.errors %}</span>
               &lt;div class="form-group has-error"&gt;
<span class="line delete"><span class="delete">-</span>                    &lt;div class="help-block"&gt;{{ form.text.errors }}&lt;/div&gt;</span>
<span class="line delete"><span class="delete">-</span>                  &lt;/div&gt;</span>
<span class="line insert"><span class="insert">+</span>                &lt;div class="help-block"&gt;</span>
<span class="line insert"><span class="insert">+</span>                  {% if form.errors %}</span>
<span class="line insert"><span class="insert">+</span>                    {{ form.text.errors }}</span>
                   {% endif %}
<span class="line insert"><span class="insert">+</span>                &lt;/div&gt;</span>
<span class="line insert"><span class="insert">+</span>              &lt;/div&gt;</span>
             &lt;/form&gt;
             {% endblock %}
<span class="line insert"><span class="insert">+</span></span>
           &lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need a hint, check out the repo</p>
</div>
<div class="paragraph">
<p>But I would never suggest building a REST API in Django without checking out
Django-Rest-Framework.  Which is the topix of the next appendix!  Read on,
Macduff.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">REST API tips</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dedupe ursl</dt>
<dd>
<p>in test</p>
</dd>
<dt class="hdlist1">Don&#8217;t work with raw json strings</dt>
<dd>
<p>json.loads and json.dumps are your friend.</p>
</dd>
<dt class="hdlist1">Always use an ajax mocking library for your js tests</dt>
<dd>
<p>sinon is fine.  Jasmine has its own, as does Angular.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-11-26 19:59:17 GMT
</div>
</div>
<div class="comments" style="padding: 20px">
  <h3>Comments</h3>
  <div id="disqus_thread"></div>

  <script type="text/javascript">
var disqus_shortname = 'obeythetestinggoat';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
  </script>

  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
<html><head><script>   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)   })(window,document,'script','//www.google-analytics.com/analytics.js','ga');    ga('create', 'UA-40928035-1', 'obeythetestinggoat.com');   ga('send', 'pageview');  </script>
</head></html></body>
</html>