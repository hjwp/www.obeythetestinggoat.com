<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Behaviour-Driven Development (BDD)</title>
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./pygments-default.css">
<script>var httpRequest = new XMLHttpRequest();
httpRequest.onreadystatechange = function() {
  if (httpRequest.readyState === XMLHttpRequest.DONE) {
    if (httpRequest.status === 200) {
      document.getElementById('header').innerHTML += httpRequest.responseText;
      var subheaders = document.getElementsByClassName('sectlevel2');
      var section;
      for (var i=0; i<subheaders.length; i++) {
        section = subheaders[i];
        if (section.innerHTML.indexOf(window.location.pathname) === -1) {
          section.style.display = 'none';
        } else {
          section.scrollIntoView && section.scrollIntoView();
        }
      }

    }
  }
};
httpRequest.open('GET', 'toc.html');
httpRequest.send();

</script></head>
<body class="article toc2 toc-left">
<div id="buy_the_book" style="position: absolute; top: 0; right: 0; z-index:100">
  <a href="/pages/book.html">
    <img src="images/buy_the_book.svg" alt="buy the book ribbon">
  </a>
</div>
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="appendix_bdd">Appendix D: Behaviour-Driven Development (BDD)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now I haven&#8217;t used BDD "in anger," so I can&#8217;t claim any sort of expertise, but I
really like what I have seen of it, and I thought that you deserved at least a
whirlwind tour.  In this appendix, we&#8217;ll take some of the tests we wrote in a
"normal" FT, and convert them to using BDD tools.</p>
</div>
<div class="sect2">
<h3 id="_what_is_bdd">What Is BDD?</h3>
<div class="paragraph">
<p>BDD, <em>strictly</em> speaking, is a methodology rather than a toolset&#8212;&#8203;it&#8217;s the
approach of testing your application by testing the behaviour that we expect it
to display to a user (the
<a href="https://en.wikipedia.org/wiki/Behavior-driven_development">Wikipedia entry</a>
has quite a good overview). So, in some ways, the Selenium-based FTs that I&#8217;ve
shown in the rest of the book <em>could</em> be called BDD.</p>
</div>
<div class="paragraph">
<p>But
the term has become closely associated with a particular set of tools for
doing BDD, most importantly the
<a href="https://github.com/cucumber/cucumber/wiki/Gherkin">Gherkin syntax</a>, which is a
human-readable DSL for writing functional (or acceptance) tests. Gherkin
originally came out of the Ruby world, where it&#8217;s associated with a test runner
called <a href="http://cukes.info/">Cucumber</a>.</p>
</div>
<div class="paragraph">
<p>In
the Python world, we have a couple of equivalent test running tools,
<a href="http://lettuce.it/">Lettuce</a> and <a href="http://pythonhosted.org/behave/">Behave</a>.
Of these, only Behave was compatible with Python 3 at the time of writing, so
that&#8217;s what we&#8217;ll use. We&#8217;ll also use a plugin called
<a href="https://pythonhosted.org/behave-django/">behave-django</a>.</p>
</div>
<div class="sidebarblock pagebreak-before">
<div class="content">
<div class="title">Getting the Code for These Examples</div>
<div class="paragraph">
<p>I&#8217;m
going to use the example from <a href="/book/chapter_22_outside_in.html">[chapter_22_outside_in]</a>.
We have a basic to-do lists site, and we want to add a new feature:
logged-in users should be able to view the lists they&#8217;ve authored in one place.
Up until this point, all lists are effectively anonymous.</p>
</div>
<div class="paragraph">
<p>If you&#8217;ve been following along with the book, I&#8217;m going to assume you can skip
back to the code for that point.  If you want to pull it from my repo, the
place to go is the
<a href="https://github.com/hjwp/book-example/tree/chapter_17">chapter_17 branch</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_basic_housekeeping">Basic Housekeeping</h3>
<div class="paragraph">
<p>We
make a directory for our BDD "features," add a <em>steps</em> directory (we&#8217;ll find
out what these are shortly!), and placeholder for our first feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>mkdir -p features/steps</strong>
$ <strong>touch features/my_lists.feature</strong>
$ <strong>touch features/steps/my_lists.py</strong>
$ <strong>tree features</strong>
features
&#9500;&#9472;&#9472; my_lists.feature
&#9492;&#9472;&#9472; steps
    &#9492;&#9472;&#9472; my_lists.py</pre>
</div>
</div>
<div class="paragraph">
<p>We install <code>behave-django</code>, and add it to <em>settings.py</em>:</p>
</div>
<div class="listingblock dofirst-ch35l000">
<div class="content">
<pre>$ <strong>pip install behave-django</strong></pre>
</div>
</div>
<div class="exampleblock sourcecode">
<div class="title">superlists/settings.py</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="diff"><span></span><span class="tok-gd">--- a/superlists/settings.py</span>
<span class="tok-gi">+++ b/superlists/settings.py</span>
<span class="tok-gu">@@ -40,6 +40,7 @@ INSTALLED_APPS = [</span>
<span class="tok-w"> </span>    'lists',
<span class="tok-w"> </span>    'accounts',
<span class="tok-w"> </span>    'functional_tests',
<span class="tok-gi">+    'behave_django',</span>
<span class="tok-w"> </span>]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And then run <code>python manage.py behave</code> as a sanity check:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python manage.py behave</strong>
Creating test database for alias 'default'...
0 features passed, 0 failed, 0 skipped
0 scenarios passed, 0 failed, 0 skipped
0 steps passed, 0 failed, 0 skipped, 0 undefined
Took 0m0.000s
Destroying test database for alias 'default'...</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_writing_an_ft_as_a_feature_using_gherkin_syntax">Writing an FT as a "Feature" Using Gherkin Syntax</h3>
<div class="paragraph">
<p>Up
until now, we&#8217;ve been writing our FTs using human-readable comments
that describe the new feature in terms of a user story, interspersed
with the Selenium code required to execute each step in the story.</p>
</div>
<div class="paragraph">
<p>BDD enforces a distinction between those two&#8212;&#8203;we write our human-readable
story using a human-readable (if occasionally somewhat awkward) syntax
called "Gherkin", and that is called the "Feature".  Later, we&#8217;ll map
each line of Gherkin to a function that contains the Selenium code necessary
to implement that "step."</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what a Feature for our new "My lists" page could look like:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">features/my_lists.feature</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="gherkin"><span></span><span class="tok-k">Feature:</span><span class="tok-nf"> My Lists</span>
<span class="tok-nf">    As a logged-in user</span>
<span class="tok-nf">    I want to be able to see all my lists in one page</span>
<span class="tok-nf">    So that I can find them all after I've written them</span>

<span class="tok-nf">    </span><span class="tok-k">Scenario:</span><span class="tok-nf"> Create two lists and see them on the My Lists page</span>

<span class="tok-k">        Given </span><span class="tok-nf">I am a logged-in user</span>

<span class="tok-nf">        </span><span class="tok-k">When </span><span class="tok-nf">I create a list with first item "</span><span class="tok-s">Reticulate Splines</span><span class="tok-nf">"</span>
<span class="tok-nf">            </span><span class="tok-k">And </span><span class="tok-nf">I add an item "</span><span class="tok-s">Immanentize Eschaton</span><span class="tok-nf">"</span>
<span class="tok-nf">            </span><span class="tok-k">And </span><span class="tok-nf">I create a list with first item "</span><span class="tok-s">Buy milk</span><span class="tok-nf">"</span>

<span class="tok-nf">        </span><span class="tok-k">Then </span><span class="tok-nf">I will see a link to "</span><span class="tok-s">My lists</span><span class="tok-nf">"</span>

<span class="tok-nf">        </span><span class="tok-k">When </span><span class="tok-nf">I click the link to "</span><span class="tok-s">My lists</span><span class="tok-nf">"</span>
<span class="tok-nf">        </span><span class="tok-k">Then </span><span class="tok-nf">I will see a link to "</span><span class="tok-s">Reticulate Splines</span><span class="tok-nf">"</span>
<span class="tok-nf">        </span><span class="tok-k">And </span><span class="tok-nf">I will see a link to "</span><span class="tok-s">Buy milk</span><span class="tok-nf">"</span>

<span class="tok-nf">        </span><span class="tok-k">When </span><span class="tok-nf">I click the link to "</span><span class="tok-s">Reticulate Splines</span><span class="tok-nf">"</span>
<span class="tok-nf">        </span><span class="tok-k">Then </span><span class="tok-nf">I will be on the "</span><span class="tok-s">Reticulate Splines</span><span class="tok-nf">" list page</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3 pagebreak-before">
<h4 id="_as_a_i_want_toso_that">As-a /I want to/So that</h4>
<div class="paragraph">
<p>At the top you&#8217;ll notice the As-a/I want to/So that clause.  This is
optional, and it has no executable counterpart&#8212;&#8203;it&#8217;s just a slightly
formalised way of capturing the "who and why?" aspects of a user story,
gently encouraging the team to think about the justifications for each
feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="_givenwhenthen">Given/When/Then</h4>
<div class="paragraph">
<p>Given/When/Then is the real core of a BDD test.  This trilobite formulation
matches the setup/exercise/assert pattern we&#8217;ve seen in our unit tests, and
it represents the setup and assumptions phase, an exercise/action phase, and
a subsequent assertion/observation phase.  There&#8217;s more info on the
<a href="https://github.com/cucumber/cucumber/wiki/Given-When-Then">Cucumber wiki</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_not_always_a_perfect_fit">Not Always a Perfect Fit!</h4>
<div class="paragraph">
<p>As you can see, it&#8217;s not always easy to shoe-horn a user story into exactly
three steps!  We can use the <code>And</code> clause to expand on a step, and I&#8217;ve
added multiple <code>When</code> steps and subsequent <code>Then</code>'s to illustrate further
aspects of our "My lists" page.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_coding_the_step_functions">Coding the Step Functions</h3>
<div class="paragraph">
<p>We
now build the counterpart to our Gherkin-syntax feature, which are the
"step" functions that will actually implement them in code.</p>
</div>
<div class="sect3 pagebreak-before">
<h4 id="_generating_placeholder_steps">Generating Placeholder Steps</h4>
<div class="paragraph">
<p>When we run <code>behave</code>, it helpfully tells us about all the steps we need to
implement:</p>
</div>
<div class="listingblock small-code">
<div class="content">
<pre>$ <strong>python manage.py behave</strong>
Feature: My Lists # features/my_lists.feature:1
  As a logged-in user
  I want to be able to see all my lists in one page
  So that I can find them all after I've written them
  Scenario: Create two lists and see them on the My Lists page  #
features/my_lists.feature:6
    Given I am a logged-in user                                 # None
    Given I am a logged-in user                                 # None
    When I create a list with first item "Reticulate Splines"   # None
    And I add an item "Immanentize Eschaton"                    # None
    And I create a list with first item "Buy milk"              # None
    Then I will see a link to "My lists"                        # None
    When I click the link to "My lists"                         # None
    Then I will see a link to "Reticulate Splines"              # None
    And I will see a link to "Buy milk"                         # None
    When I click the link to "Reticulate Splines"               # None
    Then I will be on the "Reticulate Splines" list page        # None


Failing scenarios:
  features/my_lists.feature:6  Create two lists and see them on the My Lists
page


0 features passed, 1 failed, 0 skipped
0 scenarios passed, 1 failed, 0 skipped
0 steps passed, 0 failed, 0 skipped, 10 undefined
Took 0m0.000s

You can implement step definitions for undefined steps with these snippets:

@given(u'I am a logged-in user')
def step_impl(context):
    raise NotImplementedError(u'STEP: Given I am a logged-in user')

@when(u'I create a list with first item "Reticulate Splines"')
def step_impl(context):
[...]</pre>
</div>
</div>
<div class="paragraph">
<p>And you&#8217;ll notice all this output is nicely coloured, as shown in
<a href="#behave-output">Behave with coloured console ouptut</a>.</p>
</div>
<div id="behave-output" class="imageblock">
<div class="content">
<img src="images/twp2_ae01.png" alt="Colourful console output">
</div>
<div class="title">Figure 1. Behave with coloured console ouptut</div>
</div>
<div class="paragraph">
<p>It&#8217;s encouraging us to copy and paste these snippets, and use them as
starting points to build our steps.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_first_step_definition">First Step Definition</h3>
<div class="paragraph">
<p>Here&#8217;s a first stab at making a step for our "Given I am a logged-in user"
step. I started by stealing the code for <code>self.create_pre_authenticated_session</code>
from <em>functional_tests/test_my_lists.py</em>, and adapting it slightly (removing
the server-side version, for example, although it would be easy to re-add
later).</p>
</div>
<div class="exampleblock sourcecode small-code">
<div class="title">features/steps/my_lists.py</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-kn">from</span> <span class="tok-nn">behave</span> <span class="tok-kn">import</span> <span class="tok-n">given</span><span class="tok-p">,</span> <span class="tok-n">when</span><span class="tok-p">,</span> <span class="tok-n">then</span>
<span class="tok-kn">from</span> <span class="tok-nn">functional_tests.management.commands.create_session</span> <span class="tok-kn">import</span> \
    <span class="tok-n">create_pre_authenticated_session</span>
<span class="tok-kn">from</span> <span class="tok-nn">django.conf</span> <span class="tok-kn">import</span> <span class="tok-n">settings</span>


<span class="tok-nd">@given</span><span class="tok-p">(</span><span class="tok-s1">'I am a logged-in user'</span><span class="tok-p">)</span>
<span class="tok-k">def</span> <span class="tok-nf">given_i_am_logged_in</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">):</span>
    <span class="tok-n">session_key</span> <span class="tok-o">=</span> <span class="tok-n">create_pre_authenticated_session</span><span class="tok-p">(</span><span class="tok-n">email</span><span class="tok-o">=</span><span class="tok-s1">'edith@example.com'</span><span class="tok-p">)</span>
    <span class="tok-c1">## to set a cookie we need to first visit the domain.</span>
    <span class="tok-c1">## 404 pages load the quickest!</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">get_url</span><span class="tok-p">(</span><span class="tok-s2">"/404_no_such_url/"</span><span class="tok-p">))</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">add_cookie</span><span class="tok-p">(</span><span class="tok-nb">dict</span><span class="tok-p">(</span>
        <span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-n">settings</span><span class="tok-o">.</span><span class="tok-n">SESSION_COOKIE_NAME</span><span class="tok-p">,</span>
        <span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-n">session_key</span><span class="tok-p">,</span>
        <span class="tok-n">path</span><span class="tok-o">=</span><span class="tok-s1">'/'</span><span class="tok-p">,</span>
    <span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <em>context</em> variable needs a little explaining&#8212;it&#8217;s a sort of global
variable, in the sense that it&#8217;s passed to each step that&#8217;s executed, and it
can be used to store information that we need to share between steps. Here
we&#8217;ve assumed we&#8217;ll be storing a browser object on it, and the <code>server_url</code>.
We end up using it a lot like we used <code>self</code> when we were writing <code>unittest</code>
FTs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setup_and_teardown_equivalents_in_environment_py">setUp and tearDown Equivalents in environment.py</h3>
<div class="paragraph">
<p>Steps can make changes to state in the <code>context</code>, but the place to do
preliminary set-up, the equivalent of <code>setUp</code>, is in a file called
<em>environment.py</em>:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">features/environment.py</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-kn">from</span> <span class="tok-nn">selenium</span> <span class="tok-kn">import</span> <span class="tok-n">webdriver</span>

<span class="tok-k">def</span> <span class="tok-nf">before_all</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">):</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span> <span class="tok-o">=</span> <span class="tok-n">webdriver</span><span class="tok-o">.</span><span class="tok-n">Firefox</span><span class="tok-p">()</span>

<span class="tok-k">def</span> <span class="tok-nf">after_all</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">):</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">quit</span><span class="tok-p">()</span>

<span class="tok-k">def</span> <span class="tok-nf">before_feature</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">,</span> <span class="tok-n">feature</span><span class="tok-p">):</span>
    <span class="tok-k">pass</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_another_run">Another Run</h3>
<div class="paragraph">
<p>As a sanity check, we can do another run, to see if the new step works and
that we really can start a browser:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python manage.py behave</strong>
[...]
1 step passed, 0 failed, 0 skipped, 9 undefined</pre>
</div>
</div>
<div class="paragraph">
<p>The usual reams of output, but we can see that it seems to have made it through
the first step; let&#8217;s define the rest of them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_capturing_parameters_in_steps">Capturing Parameters in Steps</h3>
<div class="paragraph">
<p>We&#8217;ll
see how Behave allows you to capture parameters from step descriptions.
Our next step says:</p>
</div>
<div class="exampleblock sourcecode currentcontents">
<div class="title">features/my_lists.feature</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="gherkin"><span></span><span class="tok-nf">    </span><span class="tok-k">When </span><span class="tok-nf">I create a list with first item "</span><span class="tok-s">Reticulate Splines</span><span class="tok-nf">"</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And the autogenerated step definition looked like this:</p>
</div>
<div class="exampleblock sourcecode small-code skipme">
<div class="title">features/steps/my_lists.py</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-nd">@given</span><span class="tok-p">(</span><span class="tok-s1">'I create a list with first item "Reticulate Splines"'</span><span class="tok-p">)</span>
<span class="tok-k">def</span> <span class="tok-nf">step_impl</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">):</span>
    <span class="tok-k">raise</span> <span class="tok-ne">NotImplementedError</span><span class="tok-p">(</span>
        <span class="tok-sa">u</span><span class="tok-s1">'STEP: When I create a list with first item "Reticulate Splines"'</span>
    <span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We want to be able to create lists with arbitrary first items, so it would be
nice to somehow capture whatever is between those quotes, and pass them in as
an argument to a more generic function.  That&#8217;s a common requirement in BDD,
and Behave has a nice syntax for it, reminiscent of the new-style Python string
formatting syntax:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">features/steps/my_lists.py (ch35l006)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-p">[</span><span class="tok-o">...</span><span class="tok-p">]</span>

<span class="tok-nd">@when</span><span class="tok-p">(</span><span class="tok-s1">'I create a list with first item "</span><span class="tok-si">{first_item_text}</span><span class="tok-s1">"'</span><span class="tok-p">)</span>
<span class="tok-k">def</span> <span class="tok-nf">create_a_list</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">,</span> <span class="tok-n">first_item_text</span><span class="tok-p">):</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">get_url</span><span class="tok-p">(</span><span class="tok-s1">'/'</span><span class="tok-p">))</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element</span><span class="tok-p">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-n">ID</span><span class="tok-p">,</span> <span class="tok-s1">'id_text'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">send_keys</span><span class="tok-p">(</span><span class="tok-n">first_item_text</span><span class="tok-p">)</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element</span><span class="tok-p">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-n">ID</span><span class="tok-p">,</span> <span class="tok-s1">'id_text'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">send_keys</span><span class="tok-p">(</span><span class="tok-n">Keys</span><span class="tok-o">.</span><span class="tok-n">ENTER</span><span class="tok-p">)</span>
    <span class="tok-n">wait_for_list_item</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">,</span> <span class="tok-n">first_item_text</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Neat, huh?</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Capturing parameters for steps is one of the most powerful features
    of the BDD syntax.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As usual with Selenium tests, we will need an explicit wait.  Let&#8217;s re-use
our <code>@wait</code> decorator from <em>base.py</em>:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">features/steps/my_lists.py (ch35l007)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-kn">from</span> <span class="tok-nn">functional_tests.base</span> <span class="tok-kn">import</span> <span class="tok-n">wait</span>
<span class="tok-p">[</span><span class="tok-o">...</span><span class="tok-p">]</span>


<span class="tok-nd">@wait</span>
<span class="tok-k">def</span> <span class="tok-nf">wait_for_list_item</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">,</span> <span class="tok-n">item_text</span><span class="tok-p">):</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">test</span><span class="tok-o">.</span><span class="tok-n">assertIn</span><span class="tok-p">(</span>
        <span class="tok-n">item_text</span><span class="tok-p">,</span>
        <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element_by_css_selector</span><span class="tok-p">(</span><span class="tok-s1">'#id_list_table'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">text</span>
    <span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Similarly, we can add to an existing list, and see or click on links:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">features/steps/my_lists.py (ch35l008)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-kn">from</span> <span class="tok-nn">selenium.webdriver.common.keys</span> <span class="tok-kn">import</span> <span class="tok-n">Keys</span>
<span class="tok-p">[</span><span class="tok-o">...</span><span class="tok-p">]</span>


<span class="tok-nd">@when</span><span class="tok-p">(</span><span class="tok-s1">'I add an item "</span><span class="tok-si">{item_text}</span><span class="tok-s1">"'</span><span class="tok-p">)</span>
<span class="tok-k">def</span> <span class="tok-nf">add_an_item</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">,</span> <span class="tok-n">item_text</span><span class="tok-p">):</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element</span><span class="tok-p">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-n">ID</span><span class="tok-p">,</span> <span class="tok-s1">'id_text'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">send_keys</span><span class="tok-p">(</span><span class="tok-n">item_text</span><span class="tok-p">)</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element</span><span class="tok-p">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-n">ID</span><span class="tok-p">,</span> <span class="tok-s1">'id_text'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">send_keys</span><span class="tok-p">(</span><span class="tok-n">Keys</span><span class="tok-o">.</span><span class="tok-n">ENTER</span><span class="tok-p">)</span>
    <span class="tok-n">wait_for_list_item</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">,</span> <span class="tok-n">item_text</span><span class="tok-p">)</span>


<span class="tok-nd">@then</span><span class="tok-p">(</span><span class="tok-s1">'I will see a link to "</span><span class="tok-si">{link_text}</span><span class="tok-s1">"'</span><span class="tok-p">)</span>
<span class="tok-nd">@wait</span>
<span class="tok-k">def</span> <span class="tok-nf">see_a_link</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">,</span> <span class="tok-n">link_text</span><span class="tok-p">):</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element_by_link_text</span><span class="tok-p">(</span><span class="tok-n">link_text</span><span class="tok-p">)</span>


<span class="tok-nd">@when</span><span class="tok-p">(</span><span class="tok-s1">'I click the link to "</span><span class="tok-si">{link_text}</span><span class="tok-s1">"'</span><span class="tok-p">)</span>
<span class="tok-k">def</span> <span class="tok-nf">click_link</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">,</span> <span class="tok-n">link_text</span><span class="tok-p">):</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element_by_link_text</span><span class="tok-p">(</span><span class="tok-n">link_text</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">click</span><span class="tok-p">()</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice we can even use our <code>@wait</code> decorator on steps themselves.</p>
</div>
<div class="paragraph">
<p>And finally the slightly more complex step that says I am on the
page for a particular list:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">features/steps/my_lists.py (ch35l009)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-nd">@then</span><span class="tok-p">(</span><span class="tok-s1">'I will be on the "</span><span class="tok-si">{first_item_text}</span><span class="tok-s1">" list page'</span><span class="tok-p">)</span>
<span class="tok-nd">@wait</span>
<span class="tok-k">def</span> <span class="tok-nf">on_list_page</span><span class="tok-p">(</span><span class="tok-n">context</span><span class="tok-p">,</span> <span class="tok-n">first_item_text</span><span class="tok-p">):</span>
    <span class="tok-n">first_row</span> <span class="tok-o">=</span> <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element_by_css_selector</span><span class="tok-p">(</span>
        <span class="tok-s1">'#id_list_table tr:first-child'</span>
    <span class="tok-p">)</span>
    <span class="tok-n">expected_row_text</span> <span class="tok-o">=</span> <span class="tok-s1">'1: '</span> <span class="tok-o">+</span> <span class="tok-n">first_item_text</span>
    <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-n">test</span><span class="tok-o">.</span><span class="tok-n">assertEqual</span><span class="tok-p">(</span><span class="tok-n">first_row</span><span class="tok-o">.</span><span class="tok-n">text</span><span class="tok-p">,</span> <span class="tok-n">expected_row_text</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph pagebreak-before">
<p>Now we can run it and see our first expected failure:</p>
</div>
<div class="listingblock small-code">
<div class="content">
<pre>$ <strong>python manage.py behave</strong>

Feature: My Lists # features/my_lists.feature:1
  As a logged-in user
  I want to be able to see all my lists in one page
  So that I can find them all after I've written them
  Scenario: Create two lists and see them on the My Lists page  #
features/my_lists.feature:6
    Given I am a logged-in user                                 #
features/steps/my_lists.py:19
    When I create a list with first item "Reticulate Splines"   #
features/steps/my_lists.py:31
    And I add an item "Immanentize Eschaton"                    #
features/steps/my_lists.py:39
    And I create a list with first item "Buy milk"              #
features/steps/my_lists.py:31
    Then I will see a link to "My lists"                        #
functional_tests/base.py:12
      Traceback (most recent call last):
[...]
        File "features/steps/my_lists.py", line 49, in see_a_link
          context.browser.find_element_by_link_text(link_text)
[...]
      selenium.common.exceptions.NoSuchElementException: Message: Unable to
locate element: My lists

[...]

Failing scenarios:
  features/my_lists.feature:6  Create two lists and see them on the My Lists
page

0 features passed, 1 failed, 0 skipped
0 scenarios passed, 1 failed, 0 skipped
4 steps passed, 1 failed, 5 skipped, 0 undefined</pre>
</div>
</div>
<div class="paragraph">
<p>You can see how the output really gives you a sense of how far through the
"story" of the test we got: we manage to create our two lists successfully, but
the "My lists" link does not appear.</p>
</div>
</div>
<div class="sect2">
<h3 id="_comparing_the_inline_style_ft">Comparing the Inline-Style FT</h3>
<div class="paragraph">
<p>I&#8217;m
not going to run through the implementation of the feature, but you can
see how the test will drive development just as well as the inline-style FT
would have.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at it, for comparison:</p>
</div>
<div class="exampleblock sourcecode skipme">
<div class="title">functional_tests/test_my_lists.py</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">def</span> <span class="tok-nf">test_logged_in_users_lists_are_saved_as_my_lists</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
    <span class="tok-c1"># Edith is a logged-in user</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">create_pre_authenticated_session</span><span class="tok-p">(</span><span class="tok-s1">'edith@example.com'</span><span class="tok-p">)</span>

    <span class="tok-c1"># She goes to the home page and starts a list</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">live_server_url</span><span class="tok-p">)</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">add_list_item</span><span class="tok-p">(</span><span class="tok-s1">'Reticulate splines'</span><span class="tok-p">)</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">add_list_item</span><span class="tok-p">(</span><span class="tok-s1">'Immanentize eschaton'</span><span class="tok-p">)</span>
    <span class="tok-n">first_list_url</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">current_url</span>

    <span class="tok-c1"># She notices a "My lists" link, for the first time.</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element_by_link_text</span><span class="tok-p">(</span><span class="tok-s1">'My lists'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">click</span><span class="tok-p">()</span>

    <span class="tok-c1"># She sees that her list is in there, named according to its</span>
    <span class="tok-c1"># first list item</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wait_for</span><span class="tok-p">(</span>
        <span class="tok-k">lambda</span><span class="tok-p">:</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element_by_link_text</span><span class="tok-p">(</span><span class="tok-s1">'Reticulate splines'</span><span class="tok-p">)</span>
    <span class="tok-p">)</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element_by_link_text</span><span class="tok-p">(</span><span class="tok-s1">'Reticulate splines'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">click</span><span class="tok-p">()</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wait_for</span><span class="tok-p">(</span>
        <span class="tok-k">lambda</span><span class="tok-p">:</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">assertEqual</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">current_url</span><span class="tok-p">,</span> <span class="tok-n">first_list_url</span><span class="tok-p">)</span>
    <span class="tok-p">)</span>

    <span class="tok-c1"># She decides to start another list, just to see</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">live_server_url</span><span class="tok-p">)</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">add_list_item</span><span class="tok-p">(</span><span class="tok-s1">'Click cows'</span><span class="tok-p">)</span>
    <span class="tok-n">second_list_url</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">current_url</span>

    <span class="tok-c1"># Under "my lists", her new list appears</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element_by_link_text</span><span class="tok-p">(</span><span class="tok-s1">'My lists'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">click</span><span class="tok-p">()</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wait_for</span><span class="tok-p">(</span>
        <span class="tok-k">lambda</span><span class="tok-p">:</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element_by_link_text</span><span class="tok-p">(</span><span class="tok-s1">'Click cows'</span><span class="tok-p">)</span>
    <span class="tok-p">)</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element_by_link_text</span><span class="tok-p">(</span><span class="tok-s1">'Click cows'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">click</span><span class="tok-p">()</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wait_for</span><span class="tok-p">(</span>
        <span class="tok-k">lambda</span><span class="tok-p">:</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">assertEqual</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">current_url</span><span class="tok-p">,</span> <span class="tok-n">second_list_url</span><span class="tok-p">)</span>
    <span class="tok-p">)</span>

    <span class="tok-c1"># She logs out.  The "My lists" option disappears</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element_by_link_text</span><span class="tok-p">(</span><span class="tok-s1">'Log out'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">click</span><span class="tok-p">()</span>
    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wait_for</span><span class="tok-p">(</span><span class="tok-k">lambda</span><span class="tok-p">:</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">assertEqual</span><span class="tok-p">(</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_elements_by_link_text</span><span class="tok-p">(</span><span class="tok-s1">'My lists'</span><span class="tok-p">),</span>
        <span class="tok-p">[]</span>
    <span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s not entirely an apples-to-apples comparison, but we can look at the
number of lines of code in <a href="#table-code-compare">Lines of code comparison</a>.</p>
</div>
<table id="table-code-compare" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Lines of code comparison</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">BDD</th>
<th class="tableblock halign-left valign-top">Standard FT</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feature file: 20 (3 optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">test function body: 45</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Steps file: 56 lines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">helper functions: 23</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The comparison isn&#8217;t perfect, but you might say that the feature file and the
body of a "standard FT" test function are equivalent in that they present the
main "story" of a test, while the steps and helper functions represent the
"hidden" implementation details.  If you add them up, the total numbers are
pretty similar, but notice that they&#8217;re spread out differently: the BDD tests
have made the story more concise, and pushed more work out into the hidden
implementation details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bdd_encourages_structured_test_code">BDD Encourages Structured Test Code</h3>
<div class="paragraph">
<p>This
is the real appeal, for me: the BDD tool has <em>forced</em> us to structure our
test code.  In the inline-style FT, we&#8217;re free to use as many lines as we want
to implement a step, as described by its comment line.  It&#8217;s very hard to
resist the urge to just copy-and-paste code from elsewhere, or just from
earlier on in the test.   You can see that, by this point in the book, I&#8217;ve
built just a couple of helper functions (like <code>get_item_input_box</code>).</p>
</div>
<div class="paragraph">
<p>In contrast, the BDD syntax has immediately forced me to have a separate
function for each step, so I&#8217;ve already built some very reusable code to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Start a new list</p>
</li>
<li>
<p>Add an item to an existing list</p>
</li>
<li>
<p>Click on a link with particular text</p>
</li>
<li>
<p>Assert that I&#8217;m looking at a particular list&#8217;s page</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>BDD really encourages you to write test code that seems to match well with
the business domain, and to use a layer of abstraction between the story of
your FT and its implementation in code.</p>
</div>
<div class="paragraph">
<p>The ultimate expression of this is that, theoretically, if you wanted to
change programming languages, you could keep all your features in Gherkin
syntax exactly as they are, and throw away the Python steps and replace them
with steps implemented in another language.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_page_pattern_as_an_alternative">The Page Pattern as an Alternative</h3>
<div class="paragraph">
<p>In
<a href="/book/chapter_page_pattern.html">[chapter_page_pattern]</a> of the book, I present an example of the "Page
pattern", which is an object-oriented approach to structuring your Selenium
tests.  Here&#8217;s a reminder of what it looks like:</p>
</div>
<div class="exampleblock sourcecode skipme">
<div class="title">functional_tests/test_sharing.py</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-kn">from</span> <span class="tok-nn">.my_lists_page</span> <span class="tok-kn">import</span> <span class="tok-n">MyListsPage</span>
<span class="tok-p">[</span><span class="tok-o">...</span><span class="tok-p">]</span>

<span class="tok-k">class</span> <span class="tok-nc">SharingTest</span><span class="tok-p">(</span><span class="tok-n">FunctionalTest</span><span class="tok-p">):</span>

    <span class="tok-k">def</span> <span class="tok-nf">test_can_share_a_list_with_another_user</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-c1"># [...]</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">live_server_url</span><span class="tok-p">)</span>
        <span class="tok-n">list_page</span> <span class="tok-o">=</span> <span class="tok-n">ListPage</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">add_list_item</span><span class="tok-p">(</span><span class="tok-s1">'Get help'</span><span class="tok-p">)</span>

        <span class="tok-c1"># She notices a "Share this list" option</span>
        <span class="tok-n">share_box</span> <span class="tok-o">=</span> <span class="tok-n">list_page</span><span class="tok-o">.</span><span class="tok-n">get_share_box</span><span class="tok-p">()</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">assertEqual</span><span class="tok-p">(</span>
            <span class="tok-n">share_box</span><span class="tok-o">.</span><span class="tok-n">get_attribute</span><span class="tok-p">(</span><span class="tok-s1">'placeholder'</span><span class="tok-p">),</span>
            <span class="tok-s1">'your-friend@example.com'</span>
        <span class="tok-p">)</span>

        <span class="tok-c1"># She shares her list.</span>
        <span class="tok-c1"># The page updates to say that it's shared with Oniciferous:</span>
        <span class="tok-n">list_page</span><span class="tok-o">.</span><span class="tok-n">share_list_with</span><span class="tok-p">(</span><span class="tok-s1">'oniciferous@example.com'</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And the <code>Page</code> class looks like this:</p>
</div>
<div class="exampleblock sourcecode small-code skipme">
<div class="title">functional_tests/lists_pages.py</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">class</span> <span class="tok-nc">ListPage</span><span class="tok-p">(</span><span class="tok-nb">object</span><span class="tok-p">):</span>

    <span class="tok-k">def</span> <span class="tok-fm">__init__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">test</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">test</span> <span class="tok-o">=</span> <span class="tok-n">test</span>


    <span class="tok-k">def</span> <span class="tok-nf">get_table_rows</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">test</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_elements_by_css_selector</span><span class="tok-p">(</span><span class="tok-s1">'#id_list_table tr'</span><span class="tok-p">)</span>


    <span class="tok-nd">@wait</span>
    <span class="tok-k">def</span> <span class="tok-nf">wait_for_row_in_list_table</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">item_text</span><span class="tok-p">,</span> <span class="tok-n">item_number</span><span class="tok-p">):</span>
        <span class="tok-n">row_text</span> <span class="tok-o">=</span> <span class="tok-s1">'</span><span class="tok-si">{}</span><span class="tok-s1">: </span><span class="tok-si">{}</span><span class="tok-s1">'</span><span class="tok-o">.</span><span class="tok-n">format</span><span class="tok-p">(</span><span class="tok-n">item_number</span><span class="tok-p">,</span> <span class="tok-n">item_text</span><span class="tok-p">)</span>
        <span class="tok-n">rows</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">get_table_rows</span><span class="tok-p">()</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">test</span><span class="tok-o">.</span><span class="tok-n">assertIn</span><span class="tok-p">(</span><span class="tok-n">row_text</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-n">row</span><span class="tok-o">.</span><span class="tok-n">text</span> <span class="tok-k">for</span> <span class="tok-n">row</span> <span class="tok-ow">in</span> <span class="tok-n">rows</span><span class="tok-p">])</span>


    <span class="tok-k">def</span> <span class="tok-nf">get_item_input_box</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">test</span><span class="tok-o">.</span><span class="tok-n">browser</span><span class="tok-o">.</span><span class="tok-n">find_element</span><span class="tok-p">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-n">ID</span><span class="tok-p">,</span> <span class="tok-s1">'id_text'</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>So it&#8217;s definitely possible to implement a similar layer of abstraction,
and a sort of DSL, in inline-style FTs, whether it&#8217;s by using the Page
pattern or whatever structure you prefer&#8212;&#8203;but now it&#8217;s a matter of
self-discipline, rather than having a framework that pushes you towards
it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In fact, you can actually use the Page pattern with BDD as well, as
    a resource for your steps to use when navigating the pages of your site.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_bdd_might_be_less_expressive_than_inline_comments">BDD Might Be Less Expressive than Inline Comments</h3>
<div class="paragraph">
<p>On
the other hand, I can also see potential for the Gherkin syntax to
feel somewhat restrictive.  Compare how expressive and readable the
inline-style comments are, with the slightly awkward BDD feature:</p>
</div>
<div class="exampleblock sourcecode skipme">
<div class="title">functional_tests/test_my_lists.py</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span>    <span class="tok-c1"># Edith is a logged-in user</span>
    <span class="tok-c1"># She goes to the home page and starts a list</span>
    <span class="tok-c1"># She notices a "My lists" link, for the first time.</span>
    <span class="tok-c1"># She sees that her list is in there, named according to its</span>
    <span class="tok-c1"># first list item</span>
    <span class="tok-c1"># She decides to start another list, just to see</span>
    <span class="tok-c1"># Under "my lists", her new list appears</span>
    <span class="tok-c1"># She logs out.  The "My lists" option disappears</span>
<span class="tok-p">[</span><span class="tok-o">...</span><span class="tok-p">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s much more readable and natural than our slightly forced Given/Then/When
incantations, and, in a way, might encourage more user-centric thinking. (There
is a syntax in Gherkin for including "comments" in a feature file, which would
mitigate this somewhat, but I gather that it&#8217;s not widely used.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_will_nonprogrammers_write_tests">Will Nonprogrammers Write Tests?</h3>
<div class="paragraph">
<p>I
haven&#8217;t touched on one of the original promises of BDD, which is that
nonprogrammers&#8212;&#8203;business or client representatives perhaps&#8212;&#8203;might actually
write the Gherkin syntax.  I&#8217;m quite skeptical about whether this would
actually work in the real world, but I don&#8217;t think that detracts from the other
potential benefits of BDD.</p>
</div>
</div>
<div class="sect2">
<h3 id="_some_tentative_conclusions">Some Tentative Conclusions</h3>
<div class="paragraph">
<p>I&#8217;ve only dipped my toes into the BDD world, so I&#8217;m hesitant to draw any firm
conclusions. I find the "forced" structuring of FTs into steps very appealing
though&#8212;&#8203;in that it looks like it has the potential to encourage a lot of reuse in your
FT code, and that it neatly separates concerns between describing the story
and implementing it, and that it forces us to think about things in terms of
the business domain, rather than in terms of "what we need to do with
Selenium."</p>
</div>
<div class="paragraph">
<p>But there&#8217;s no free lunch. The Gherkin syntax is restrictive, compared to
the total freedom offered by inline FT comments.</p>
</div>
<div class="paragraph">
<p>I also would like to see how BDD scales once you have not just one or two
features, and four or five steps, but several dozen features and hundreds of
lines of steps code.</p>
</div>
<div class="paragraph">
<p>Overall, I would say it&#8217;s definitely worth investigating, and I will probably
use BDD for my next personal project.</p>
</div>
<div class="paragraph">
<p>My thanks to Daniel Pope, Rachel Willmer, and Jared Contrascere for their
feedback on this chapter.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">BDD Conclusions</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Encourages structured, reusable test code</dt>
<dd>
<p>By separating concerns, breaking your FTs out into the human-readable,
Gherkin syntax "feature" file and a separate implementation of steps
functions, BDD has the potential to encourage more reusable and manageable
test code.</p>
</dd>
<dt class="hdlist1">It may come at the expense of readability</dt>
<dd>
<p>The Gherkin syntax, for all its attempt to be human-readable, is ultimately
a constraint on human language, and so it may not capture nuance and
intention as well as inline comments do.</p>
</dd>
<dt class="hdlist1">Try it! I will</dt>
<dd>
<p>As I keep saying, I haven&#8217;t used BDD on a real project, so you should take
my words with a heavy pinch of salt, but I&#8217;d like to give it a hearty
endorsement.  I&#8217;m going to try it out on the next project I can, and I&#8217;d
encourage you to do so as well.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
License: Creative Commons <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/legalcode">CC-BY-NC-ND</a>. Last updated: 2024-08-02 11:53:14 +0100
</div>
</div>
<div class="comments" style="padding: 20px">
  <h3>Comments</h3>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.identifier = 'appendix_bdd';
    };
    
    (function() {
        var d = document, s = d.createElement('script');
        s.src = '//obeythetestinggoat.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

<html><head><script>   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)   })(window,document,'script','//www.google-analytics.com/analytics.js','ga');    ga('create', 'UA-40928035-1', 'obeythetestinggoat.com');   ga('send', 'pageview');  </script>
</head></html></body>
</html>